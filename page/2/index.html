<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Millionchan">
<meta name="twitter:card" content="summary"><title>Hexo</title><link ref="canonical" href="http://yoursite.com/page/2/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Hexo</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/09/05/Machine%20Learning%20for%20Semiconductors/">Machine Learning for Semiconductors</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-09-05</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-10-10</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h3 id="1-问题提出">
          <a href="#1-问题提出" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-问题提出" class="headerlink" title="1.问题提出"></a>1.问题提出</h3>
      <p>在半导体材料科学和半导体制造这两个领域，已经积累了大量的数据，需要解决无数的相关问题。如果这些数据能够得到有效分析，将极大地有助于发现新的半导体材料，加速半导体制造的发展。因此，我们需要更有效的方法来处理这些数据和问题，而不是传统的研究方法。</p>

        <h3 id="2-ML算法模式及选择">
          <a href="#2-ML算法模式及选择" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-ML算法模式及选择" class="headerlink" title="2. ML算法模式及选择"></a>2. ML算法模式及选择</h3>
      <p>这些方法大致可以分为三种类型：监督学习、无监督学习、强化学习。</p>
<ul>
<li>监督学习<br>监督学习需要训练数据中的每一个样本都有明确的特征和标签，并且期望学习一个能够将标签和特征联系起来的模型，所以这个模型可以给其他合理的样本贴标签。</li>
<li>无监督学习<br>无监督学习的训练数据不需要标签，无监督学习的目的一般是对输入数据进行聚类或降维。</li>
<li>强化学习<br>强化学习可以从零开始获得模型，不需要数据。在学习的过程中，程序尝试访问结果，然后更新策略，尝试获得更好的结果，然后再次尝试，循环直到结果足够好。</li>
<li>模型选择<br>对于半导体的 ML 任务，大多数任务是分类、预测某些材料特性、预测器件或制造的性能等且材料科学和半导体制造领域有大量数据。因此，ML 在该领域的大多数应用都在监督学习的范围内。
        <h3 id="3-数据准备">
          <a href="#3-数据准备" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-数据准备" class="headerlink" title="3.数据准备"></a>3.数据准备</h3>
      </li>
<li>数据要求<ul>
<li>适合训练目标模型，如果原始数据不适合，则需要进行一些转换</li>
<li>足以代表背后的规则和训练一个好的模型</li>
<li>尽可能准确地给出隐藏的统计分布</li>
</ul>
</li>
<li>根据 ML 中使用的特征，用于描述样本的特征可以分为三类<ul>
<li>原子构型-类型+位置</li>
<li>原子信息-原子序数、电负性…</li>
<li>材料特性-晶格常数、空间群、吸收光谱…
        <h3 id="4-ML模型">
          <a href="#4-ML模型" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-ML模型" class="headerlink" title="4.ML模型"></a>4.ML模型</h3>
      </li>
</ul>
</li>
<li>支持向量机SVM<br>SVM已被用于预测一种材料是半导体还是金属，或者一种半导体的间隙是直接的还是间接的，或其他属性 </li>
<li>核岭回归KRR<br>它隐式地将初始特征转换为新的高维特征空间。这将带来两个好处：更强的表达能力，以及在原始特征空间中的非线性拟合效果只是在新特征空间中的线性拟合。<br>由于KRR方法需要一个N × N矩阵，其中 N 是样本点的数量，它更适用于小系统或小样本的问题，如有机材料。</li>
<li>决策树DT和随机森林RF<br>DT 和 RF 算法都广泛应用于半导体材料和制造的许多问题，例如预测间隙，其他材料属性、晶圆检测，技术优化，制造故障检测</li>
<li>深度神经网络DNN<br>DNN 可以自动提取样本或输入数据的隐藏、深层特征。<br>DNN 和 ANN 已被用于许多研究中。关于半导体，研究人员将它们应用于形成能预测、间隙、其他材料特性、材料加工优化、制造技术优化, 晶圆检测, 制造故障检测等</li>
<li>线性拟合法<br>线性拟合方法已被用于预测间隙、磁性能，以提高晶圆质量，提高制造良率等。</li>
<li>Boost算法<br>可以提高某种学习模型的训练效果</li>
<li>主动学习<br>允许在将学习模型应用于预测时对其进行改进。因此它已被应用于处理一些在训练前难以收集到足够合适数据的问题，如机器学习力场（MLFF）</li>
<li>其他算法<br>如遗传算法（GA），朴素贝耶斯（NB），迁移学习（TL）等
        <h3 id="5-半导体材料科学的学习过程">
          <a href="#5-半导体材料科学的学习过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-半导体材料科学的学习过程" class="headerlink" title="5.半导体材料科学的学习过程"></a>5.半导体材料科学的学习过程</h3>
      </li>
<li>取样<br>没有免费的午餐定理表示：如果训练集与测试集无关，任何模型都不能比在测试集中随机猜测更好。</li>
<li>特征工程<br>描述符是否能够表达对研究目标很重要的特定特征是非常重要的。这是另一个决定机器学习结果好坏的核心因素。</li>
<li>训练和预测<br>平衡过拟合和欠拟合：扩大训练数据外，调整超参数
        <h3 id="6-半导体机器学习的现状">
          <a href="#6-半导体机器学习的现状" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-半导体机器学习的现状" class="headerlink" title="6.半导体机器学习的现状"></a>6.半导体机器学习的现状</h3>
      </li>
<li>新材料发现</li>
<li>性能预测</li>
<li>半导体制造</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/">pytorch学习</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-08-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-08-31</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h3 id="1-Tensorboard">
          <a href="#1-Tensorboard" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Tensorboard" class="headerlink" title="1. Tensorboard"></a>1. Tensorboard</h3>
      <ul>
<li><p>TensorBoard是TensorFlow自带的一个强大的可视化工具，也是一个Web应用程序套件。</p>
</li>
<li><p>可视化的主要功能</p>
<ul>
<li><p>Scalars:展示训练过程中的准确率、损失值、权重/偏置的变化情况。</p>
  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line">writer=SummaryWriter(<span class="string">'logs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#y=x</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    writer.add_scalar(<span class="string">'y=x'</span>,i,i)</span><br><span class="line"></span><br><span class="line">writer.close()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">运行后会生成logs文件夹</span></span><br><span class="line"><span class="string">terminal中输入tensorboard --logdir=logs可通过http://localhost:6006/ 打开查看，其中logdir=事件文件所在文件夹名</span></span><br><span class="line"><span class="string">为防止与其他端口冲突，可自行指定端口tensorboard --logdir=logs --port=6007</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></div></figure>
<p>  若出现重叠的情况，可将logs文件夹下的文件删除，重新运行；或每次都创建新的子文件夹SuummaryWriter(“新文件夹”)<br>  <img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/%E9%87%8D%E5%8F%A0.png" alt><br>  <img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/%E9%87%8D%E5%8F%A0.png" alt><br>  <img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/%E9%87%8D%E5%8F%A0.png" alt></p>
</li>
<li><p>利用numpy.array()，对PIL图片进行转换</p>
  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">image_path=<span class="string">'data/train/ants_image/0013035.jpg'</span></span><br><span class="line">img_PIL=Image.open(image_path)</span><br><span class="line">img_array=np.array(img_PIL)</span><br><span class="line"><span class="comment">#从PIL到numpy，需要在add_image()中指定shape中每一个数字/维表示的含义</span></span><br><span class="line">writer.add_image(<span class="string">'test'</span>,img_array,<span class="number">1</span>,dataformats=<span class="string">'HWC'</span>)</span><br></pre></td></tr></table></div></figure></li>
<li><p>add_image<br>add_image(tag, img_tensor, global_step=None, walltime=None, dataformats=’CHW’)</p>
<ul>
<li>tag (string): 数据名称</li>
<li>img_tensor (类型 torch.Tensor 或 numpy.array): 图像数据</li>
<li>global_step (int, optional): 记录这是第几个子图 后面解释这个参数</li>
<li>walltime (float, optional): 记录发生的时间，默认为 time.time()</li>
<li>dataformats (string, optional): 图像数据的格式，默认为 ‘CHW’，即 Channel x Height x Width，还可以是 ‘CHW’、‘HWC’ 或 ‘HW’ 等<br></li>
</ul>
</li>
</ul>
</li>
</ul>

        <h3 id="2-Transforms">
          <a href="#2-Transforms" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Transforms" class="headerlink" title="2. Transforms"></a>2. Transforms</h3>
      <ul>
<li>python的用法-&gt;tensor数据类型<ul>
<li>通过transforms.ToTensor去看两个问题<ul>
<li>transforms该如何使用<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/transforms%E4%BD%BF%E7%94%A8.png" alt><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tensor_trans=transforms.ToTensor()</span><br><span class="line">tensor_img=tensor_trans(img)</span><br></pre></td></tr></table></div></figure></li>
<li>为什么需要Tensor数据类型</li>
</ul>
</li>
</ul>
</li>
<li>常见的Transforms<ul>
<li>call  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        print(<span class="string">'__call__'</span>+<span class="string">"Hello"</span>+name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        print(<span class="string">'hello'</span>+name)</span><br><span class="line"></span><br><span class="line">person=Person()</span><br><span class="line">person(<span class="string">'zhangsan'</span>)<span class="comment">#定义call可以直接用类+参数</span></span><br><span class="line">person.hello(<span class="string">'lisi'</span>)<span class="comment">#需要用点来调用方法</span></span><br></pre></td></tr></table></div></figure></li>
<li>ToTensor()  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"></span><br><span class="line">writer=SummaryWriter(<span class="string">'logs'</span>)</span><br><span class="line">img=Image.open(<span class="string">'images/QQ图片201802031008421.jpg'</span>)</span><br><span class="line">print(img)</span><br><span class="line"></span><br><span class="line">trans_totensor=transforms.ToTensor()</span><br><span class="line">img_tensor=trans_totensor(img)</span><br><span class="line"></span><br><span class="line">writer.add_image(<span class="string">'ToTensor'</span>,img_tensor)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure></li>
<li>归一化函数Normalize()<ul>
<li>归一化要把需要处理的数据经过处理后（通过某种算法）限制在你需要的一定范围内，为了后面数据处理的方便，以及保证程序运行时收敛加快。</li>
<li>输入为tensor的数据类型  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output[channel] = (input[channel] - mean[channel]) / std[channel]</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Normalize</span></span><br><span class="line"><span class="string">output[channel] = (input[channel] - mean[channel]) / std[channel]</span></span><br><span class="line"><span class="string">如下数据均值方差为[0.5,0.5,0.5],[0.5,0.5,0.5]，则output=(input-0.5)/0.5=2*input-1</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">print(img_tensor[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>])<span class="comment">#第一层第一行第一列</span></span><br><span class="line">trans_norm=transforms.Normalize([<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>],[<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>])<span class="comment">#均值、方差</span></span><br><span class="line">img_norm=trans_norm(img_tensor)</span><br><span class="line">print(img_norm[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">writer.add_image(<span class="string">'Normalize'</span>,img_norm,<span class="number">1</span>)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure>
  <img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/normalize_tensor_output.png" alt><br>  <img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/normalize_output.png" alt></li>
</ul>
</li>
<li>Resize()<ul>
<li>用于对PIL图像的预处理，可用resize函数进行缩放</li>
<li>open-cv的读取图像格式为numpy，而pytorch中的resize方法需要Image格式，因此需要转换</li>
<li>输入为PIL image  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Resize</span></span><br><span class="line">print((img.size))</span><br><span class="line">trans_resize=transforms.Resize((<span class="number">512</span>,<span class="number">512</span>))</span><br><span class="line"><span class="comment">#img PIL -&gt;resize -&gt;img_resize PIL</span></span><br><span class="line">img_resize=trans_resize(img)</span><br><span class="line"><span class="comment">#img_resize PIL -&gt;totensor -&gt;img_resize tensor</span></span><br><span class="line">img_resize=trans_totensor(img_resize)</span><br><span class="line">writer.add_image(<span class="string">'Resize'</span>,img_resize,<span class="number">0</span>)</span><br><span class="line">print(img_resize)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>Compose()<ul>
<li>串联多个图片变换的操作</li>
<li>Compose()中的参数需要是一个列表，python中，列表的表示形式为[数据1，数据2，…]。在Compose中，数据需要是transforms类型，所以得到，Compose([transforms参数1,transforms参数2,…])  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Compose - resize</span></span><br><span class="line">trans_resize_2=transforms.Resize(<span class="number">512</span>)</span><br><span class="line"><span class="comment">#PIL -&gt; PIL -&gt; tensor</span></span><br><span class="line"><span class="comment">#后面参数的输入应与前一参数的输出类型保持一致</span></span><br><span class="line">trans_compose=transforms.Compose([trans_resize_2,trans_totensor])</span><br><span class="line">img_resize_2=trans_compose(img)</span><br><span class="line">writer.add_image(<span class="string">'Resize'</span>,img_resize_2,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>RandomCrop()随机裁剪  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RandomCrop</span></span><br><span class="line"><span class="comment">#用512截取图片的一部分</span></span><br><span class="line">trans_random=transforms.RandomCrop(<span class="number">512</span>)</span><br><span class="line"><span class="comment">#指定长和宽</span></span><br><span class="line"><span class="comment"># trans_random2=transforms.RandomCrop((512,1000))</span></span><br><span class="line">trans_compose_2=transforms.Compose([trans_random,trans_totensor])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    img_crop=trans_compose_2(img)</span><br><span class="line">    writer.add_image(<span class="string">'RandomCrop'</span>,img_crop,i)</span><br><span class="line"></span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>使用方法总结<ul>
<li>关注输入、输出类型</li>
<li>多看官方文档ctrl+鼠标左键</li>
<li>关注方法需要什么参数ctrl+p</li>
<li>不知道返回值的时候<ul>
<li>print</li>
<li>print(type())</li>
<li>debug</li>
<li>百度<br></li>
</ul>
</li>
</ul>
</li>
</ul>

        <h3 id="3-torchvision中的数据集使用">
          <a href="#3-torchvision中的数据集使用" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-torchvision中的数据集使用" class="headerlink" title="3.torchvision中的数据集使用"></a>3.torchvision中的数据集使用</h3>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line">dataset_transform = torchvision.transforms.Compose([</span><br><span class="line">    torchvision.transforms.ToTensor()<span class="comment">#pytorch需要tensor类型的图片</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># root:数据集村放在什么位置，./dataset会在程序所在文件夹创建dataset文件夹，并保存数据</span></span><br><span class="line"><span class="comment"># 训练集和测试集</span></span><br><span class="line">train_set = torchvision.datasets.CIFAR10(root=<span class="string">'./dataset'</span>, transform=dataset_transform, train=<span class="literal">True</span>, download=<span class="literal">True</span>)</span><br><span class="line">test_set = torchvision.datasets.CIFAR10(root=<span class="string">'./dataset'</span>, transform=dataset_transform, train=<span class="literal">False</span>, download=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">print(test_set[<span class="number">0</span>])</span><br><span class="line">print(test_set.classes)</span><br><span class="line">img, target = test_set[<span class="number">0</span>]</span><br><span class="line">print(img)</span><br><span class="line">print(target)</span><br><span class="line">print(test_set.classes[target])</span><br><span class="line"><span class="comment">#img.show()</span></span><br><span class="line"></span><br><span class="line">writer = SummaryWriter(<span class="string">'p10'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    img,target=test_set[i]</span><br><span class="line">    writer.add_image(<span class="string">'test_set'</span>,img,i)</span><br><span class="line">writer.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#terminal</span></span><br><span class="line"><span class="comment">#tensorboard --logdir=p10</span></span><br></pre></td></tr></table></div></figure>
<p><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/cifar10_img_target.png" alt><br>target=3对应为猫<br><br></p>

        <h3 id="4-DataLoader的使用">
          <a href="#4-DataLoader的使用" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-DataLoader的使用" class="headerlink" title="4.DataLoader的使用"></a>4.DataLoader的使用</h3>
      <ul>
<li>常见参数<ul>
<li>很多参数有默认值，dataset没有</li>
<li>dataset:告诉程序数据集在什么地方</li>
<li>batch_size:每批要加载的样本数</li>
<li>shuffle:是否打乱，默认设为false，我们一般喜欢设置为true</li>
<li>num_workers:用于数据加载的子进程数。默认为0意味着数据将在主进程中加载</li>
<li>drop_last:设置为true如果数据集大小不能被批大小整除，则删除最后一个不完整的批，false则不删除</li>
</ul>
</li>
<li>代码  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="comment">#准备的测试数据集</span></span><br><span class="line">test_data=torchvision.datasets.CIFAR10(root=<span class="string">'./dataset'</span>,train=<span class="literal">False</span>,transform=torchvision.transforms.ToTensor())</span><br><span class="line"></span><br><span class="line">test_loader=DataLoader(dataset=test_data,batch_size=<span class="number">4</span>,shuffle=<span class="literal">True</span>,num_workers=<span class="number">0</span>,drop_last=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试数据集中第一张图片及target</span></span><br><span class="line">img,target=test_data[<span class="number">0</span>]</span><br><span class="line"><span class="comment">#图片大小</span></span><br><span class="line">print(img.shape)</span><br><span class="line">print(target)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">output:</span></span><br><span class="line"><span class="string">torch.Size([3, 32, 32])#三通道（每个像素点都有3个值表示，RGB图片即为三通道图片），32*32的图片</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">writer=SummaryWriter(<span class="string">'dataloader'</span>)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">    step=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> test_loader:</span><br><span class="line">        imgs,targets=data</span><br><span class="line">        <span class="comment"># print(imgs.shape)</span></span><br><span class="line">        <span class="comment"># print(targets)</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        output</span></span><br><span class="line"><span class="string">        torch.Size([4, 3, 32, 32])#4表示4张图片，batch_size=4</span></span><br><span class="line"><span class="string">        tensor([2, 4, 9, 8])</span></span><br><span class="line"><span class="string">        torch.Size([4, 3, 32, 32])</span></span><br><span class="line"><span class="string">        tensor([4, 1, 2, 6])</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        writer.add_images(<span class="string">'Epoch:&#123;&#125;'</span>.format(epoch),imgs,step)</span><br><span class="line">        step=step+<span class="number">1</span></span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure>
<br>

</li>
</ul>

        <h3 id="5-神经网络">
          <a href="#5-神经网络" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-神经网络" class="headerlink" title="5.神经网络"></a>5.神经网络</h3>
      <ul>
<li>神经网络的基本骨架-nn.Module的使用  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,input)</span>:</span></span><br><span class="line">        output=input+<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">tudui=Tudui()</span><br><span class="line">x=torch.tensor(<span class="number">1.0</span>)</span><br><span class="line">output=tudui(x)</span><br><span class="line">print(output)<span class="comment">#2.</span></span><br></pre></td></tr></table></div></figure>
<img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/nn_forward.png" alt><br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/nn_forward%E6%B5%81%E7%A8%8B.png" alt><br></li>
<li>卷积操作<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/%E5%8D%B7%E7%A7%AF.png" alt><br>padding填充默认填充0<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/%E5%8D%B7%E7%A7%AF_padding%3D1.png" alt>  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="comment">#输入图像（5*5）</span></span><br><span class="line">input=torch.tensor([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>],</span><br><span class="line">                    [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>],</span><br><span class="line">                    [<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],</span><br><span class="line">                    [<span class="number">5</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">                    [<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line"><span class="comment">#卷积核（3*3）</span></span><br><span class="line">kernel=torch.tensor([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>],</span><br><span class="line">                    [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],</span><br><span class="line">                    [<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>]])</span><br><span class="line"></span><br><span class="line">input=torch.reshape(input,(<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">5</span>))<span class="comment">#1batch_size,1通道(平面）,5*5</span></span><br><span class="line">kernel=torch.reshape(kernel,(<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>))<span class="comment">#四维的，所以输出也是四维的</span></span><br><span class="line"></span><br><span class="line">print(input.shape)</span><br><span class="line">print(kernel.shape)</span><br><span class="line"></span><br><span class="line">output=F.conv2d(input,kernel,stride=<span class="number">1</span>)<span class="comment">#二维卷积</span></span><br><span class="line">print(output)</span><br><span class="line"></span><br><span class="line">output2=F.conv2d(input,kernel,stride=<span class="number">2</span>)</span><br><span class="line">print(output2)</span><br><span class="line"></span><br><span class="line">output3=F.conv2d(input,kernel,stride=<span class="number">1</span>,padding=<span class="number">1</span>)<span class="comment">#padding=1填充</span></span><br><span class="line">print(output3)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">output</span></span><br><span class="line"><span class="string">torch.Size([1, 1, 5, 5])</span></span><br><span class="line"><span class="string">torch.Size([1, 1, 3, 3])</span></span><br><span class="line"><span class="string">tensor([[[[10, 12, 12],</span></span><br><span class="line"><span class="string">        [18, 16, 16],</span></span><br><span class="line"><span class="string">        [13,  9,  3]]]])</span></span><br><span class="line"><span class="string">tensor([[[[10, 12],</span></span><br><span class="line"><span class="string">        [13,  3]]]])</span></span><br><span class="line"><span class="string">tensor([[[[ 1,  3,  4, 10,  8],</span></span><br><span class="line"><span class="string">        [ 5, 10, 12, 12,  6],</span></span><br><span class="line"><span class="string">        [ 7, 18, 16, 16,  8],</span></span><br><span class="line"><span class="string">        [11, 13,  9,  3,  4],</span></span><br><span class="line"><span class="string">        [14, 13,  9,  7,  4]]]])</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></div></figure></li>
<li>神经网络-卷积层<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/%E5%8D%B7%E7%A7%AF_out_channel%3D2.png" alt><br>input_channel=1（只有一层）,output_channel=2（有两层输出）,所以有两个卷积核（不一定完全相同）  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Conv2d</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line">dataset=torchvision.datasets.CIFAR10(<span class="string">"../dataset"</span>,train=<span class="literal">False</span>,transform=torchvision.transforms.ToTensor(),</span><br><span class="line">                                    download=<span class="literal">True</span>)</span><br><span class="line">dataloader=DataLoader(dataset,batch_size=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        <span class="comment"># input_channel=3(彩色图片channel为3,output_channel=6,kernel_size=3）</span></span><br><span class="line">        self.conv1=Conv2d(in_channels=<span class="number">3</span>,out_channels=<span class="number">6</span>,kernel_size=<span class="number">3</span>,stride=<span class="number">1</span>,padding=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span><span class="comment">#x为输出</span></span><br><span class="line">        x=self.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化网络</span></span><br><span class="line">tudui=Tudui()</span><br><span class="line">print(tudui)</span><br><span class="line"></span><br><span class="line">writer=SummaryWriter(<span class="string">'../logs'</span>)</span><br><span class="line"></span><br><span class="line">step=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">    imgs,targets=data</span><br><span class="line">    output=tudui(imgs)</span><br><span class="line">    print(imgs.shape)</span><br><span class="line">    print(output.shape)</span><br><span class="line">    <span class="comment">#torch.Size([16, 3, 32, 32])</span></span><br><span class="line">    writer.add_images(<span class="string">'input'</span>,imgs,step)</span><br><span class="line">    <span class="comment">#torch.Size([16, 6, 30, 30]) -&gt; [xxx,3,30,30]</span></span><br><span class="line">    output=torch.reshape(output,(<span class="number">-1</span>,<span class="number">3</span>,<span class="number">30</span>,<span class="number">30</span>))<span class="comment">#不知道多少写-1，系统会自己计算</span></span><br><span class="line">    writer.add_images(<span class="string">'output'</span>,output,step)</span><br><span class="line">    step+=<span class="number">1</span></span><br></pre></td></tr></table></div></figure></li>
<li>神经网络-最大池化的使用<br>ceil_model=true则保留，false不保留（不满足3*3的不保留），一般设置为false<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/max_pooling.png" alt>  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#降维，训练的更快</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> MaxPool2d</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line">dataset=torchvision.datasets.CIFAR10(<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,download=<span class="literal">True</span>,</span><br><span class="line">                                    transform=torchvision.transforms.ToTensor())</span><br><span class="line">dataloader=DataLoader(dataset,batch_size=<span class="number">64</span>)</span><br><span class="line"><span class="comment"># input=torch.tensor([[1,2,0,3,1],</span></span><br><span class="line"><span class="comment">#                     [0,1,2,3,1],</span></span><br><span class="line"><span class="comment">#                     [1,2,1,0,0],</span></span><br><span class="line"><span class="comment">#                     [5,2,3,1,1],</span></span><br><span class="line"><span class="comment">#                     [2,1,0,1,1]],dtype=torch.float32)#变为浮点型</span></span><br><span class="line"><span class="comment"># input=torch.reshape(input,(-1,1,5,5))</span></span><br><span class="line"><span class="comment"># print(input.shape)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.maxpool1=MaxPool2d(kernel_size=<span class="number">3</span>,ceil_mode=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,input)</span>:</span></span><br><span class="line">        output=self.maxpool1(input)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">tudui=Tudui()</span><br><span class="line"><span class="comment"># output=tudui(input)</span></span><br><span class="line"><span class="comment"># print(output)</span></span><br><span class="line"></span><br><span class="line">writer=SummaryWriter(<span class="string">'../logs_maxpool'</span>)</span><br><span class="line">step=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">    imgs,targets=data</span><br><span class="line">    writer.add_images(<span class="string">'input'</span>,imgs,step)</span><br><span class="line">    output=tudui(imgs)</span><br><span class="line">    writer.add_images(<span class="string">'output'</span>,output,step)</span><br><span class="line">    step+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure></li>
<li>神经网络-非线性激活<br>增加非线性的激活函数实际上是给模型增加非线性的表达能力或者因素，有了非线性函数，模型的表达能力就会更强，整个模型就像活了一样，而不是像机器只会做单一的线性操作。没有激活函数的神经网络实际上是线性可加的，那么多线性层其实可以归为一层，只具有线性的神经网络表达能力极其有限。<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/relu.png" alt><br>inplace=true则替换，false则不替换。<br>一般建议inplace取false，（默认为false）保留原始数据，防止数据丢失。<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/relu_inplace.png" alt>  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> ReLU, Sigmoid</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line">input=torch.tensor([[<span class="number">1</span>,<span class="number">-0.5</span>],</span><br><span class="line">                    [<span class="number">-1</span>,<span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line">input=torch.reshape(input,(<span class="number">-1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">print(input.shape)</span><br><span class="line"></span><br><span class="line">dataset=torchvision.datasets.CIFAR10(<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,download=<span class="literal">True</span>,</span><br><span class="line">                                    transform=torchvision.transforms.ToTensor())</span><br><span class="line">dataloader=DataLoader(dataset,batch_size=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.relu=ReLU()</span><br><span class="line">        self.sigmoid=Sigmoid()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,input)</span>:</span></span><br><span class="line">        <span class="comment">#output=self.relu(input)</span></span><br><span class="line">        output=self.sigmoid(input)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">tudui=Tudui()</span><br><span class="line"><span class="comment"># output=tudui(input)</span></span><br><span class="line"><span class="comment"># print(output)</span></span><br><span class="line"></span><br><span class="line">writer=SummaryWriter(<span class="string">'../logs_relu'</span>)</span><br><span class="line">step=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">    imgs,targets=data</span><br><span class="line">    output=tudui(imgs)</span><br><span class="line">    writer.add_images(<span class="string">'input'</span>,imgs,global_step=step)</span><br><span class="line">    writer.add_images(<span class="string">'output'</span>,output,step)</span><br><span class="line">    step+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure></li>
<li>神经网络-线性层及其他层介绍  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Linear</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line">dataset=torchvision.datasets.CIFAR10(<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,download=<span class="literal">True</span>,transform=torchvision.transforms.ToTensor())</span><br><span class="line">dataloader=DataLoader(dataset,batch_size=<span class="number">64</span>,drop_last=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.linear1=Linear(<span class="number">196608</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,input)</span>:</span></span><br><span class="line">        output=self.linear1(input)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line">tudui=Tudui()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">    imgs,targets=data</span><br><span class="line">    print(imgs.shape)</span><br><span class="line">    <span class="comment"># output:torch.Size([64, 3, 32, 32])</span></span><br><span class="line">    <span class="comment">#output=torch.reshape(imgs,(1,1,1,-1))#四个维度等于input元素数即可，其中一项写-1会自动给你补齐</span></span><br><span class="line">    output=torch.flatten(imgs)<span class="comment">#摊平，展成一行</span></span><br><span class="line">    <span class="comment">#output:torch.Size([196608])</span></span><br><span class="line">    print(output.shape)</span><br><span class="line">    <span class="comment"># output:torch.Size([1, 1, 1, 196608])</span></span><br><span class="line">    output=tudui(output)</span><br><span class="line">    print(output.shape)</span><br></pre></td></tr></table></div></figure></li>
<li>神经网络-搭建小实战和Sequential的使用<br>cifar10 model structure<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/cifar10_model_structure.png" alt>  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cifar10模型</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Conv2d, MaxPool2d, Flatten, Linear, Sequential</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()<span class="comment">#父类初始化</span></span><br><span class="line">        <span class="comment">#与下述代码功能等同</span></span><br><span class="line">        <span class="comment"># self.conv1=Conv2d(3,32,5,padding=2)#如图所示input3，output32，kernel5，padding分析得出</span></span><br><span class="line">        <span class="comment"># self.maxpool1=MaxPool2d(2)#如图maxpooling2*2kernel</span></span><br><span class="line">        <span class="comment"># self.conv2=Conv2d(32,32,5,padding=2)</span></span><br><span class="line">        <span class="comment"># self.maxpool2=MaxPool2d(2)</span></span><br><span class="line">        <span class="comment"># self.conv3=Conv2d(32,64,5,padding=2)</span></span><br><span class="line">        <span class="comment"># self.maxpool3=MaxPool2d(2)</span></span><br><span class="line">        <span class="comment"># self.flatten=Flatten()</span></span><br><span class="line">        <span class="comment"># self.linear1=Linear(1024,64)#如图</span></span><br><span class="line">        <span class="comment"># self.linear2=Linear(64,10)</span></span><br><span class="line"></span><br><span class="line">        self.model1=Sequential(</span><br><span class="line">            Conv2d(<span class="number">3</span>,<span class="number">32</span>,<span class="number">5</span>,padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Flatten(),</span><br><span class="line">            Linear(<span class="number">1024</span>, <span class="number">64</span>),</span><br><span class="line">            Linear(<span class="number">64</span>, <span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        <span class="comment"># x=self.conv1(x)</span></span><br><span class="line">        <span class="comment"># x=self.maxpool1(x)</span></span><br><span class="line">        <span class="comment"># x=self.conv2(x)</span></span><br><span class="line">        <span class="comment"># x=self.maxpool2(x)</span></span><br><span class="line">        <span class="comment"># x=self.conv3(x)</span></span><br><span class="line">        <span class="comment"># x=self.maxpool3(x)</span></span><br><span class="line">        <span class="comment"># x=self.flatten(x)</span></span><br><span class="line">        <span class="comment"># x=self.linear1(x)</span></span><br><span class="line">        <span class="comment"># x=self.linear2(x)</span></span><br><span class="line">        x=self.model1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">tudui=Tudui()<span class="comment">#实例化网络</span></span><br><span class="line">print(tudui)</span><br><span class="line">input=torch.ones(<span class="number">64</span>,<span class="number">3</span>,<span class="number">32</span>,<span class="number">32</span>)</span><br><span class="line">output=tudui(input)</span><br><span class="line">print(output.shape)</span><br><span class="line"></span><br><span class="line">writer=SummaryWriter(<span class="string">'../logs_seq'</span>)</span><br><span class="line">writer.add_graph(tudui,input)<span class="comment">#计算图</span></span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure>
<img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/%E8%AE%A1%E7%AE%97%E5%9B%BE.png" alt></li>
<li>损失函数与反向传播<ul>
<li>计算实际输出和目标之间的差距</li>
<li>为我们更新输出提供一定的依据（反向传播）<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> L1Loss</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">inputs=torch.tensor([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],dtype=torch.float32)</span><br><span class="line">targets=torch.tensor([<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>],dtype=torch.float32)</span><br><span class="line"></span><br><span class="line">inputs=torch.reshape(inputs,(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">targets=torch.reshape(targets,(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">loss=L1Loss()</span><br><span class="line">result=loss(inputs,targets)</span><br><span class="line"></span><br><span class="line">loss_mse=nn.MSELoss()</span><br><span class="line">result_mse=loss_mse(inputs,targets)</span><br><span class="line"></span><br><span class="line">print(result)</span><br><span class="line">print(result_mse)</span><br><span class="line"></span><br><span class="line">x=torch.tensor([<span class="number">0.1</span>,<span class="number">0.2</span>,<span class="number">0.3</span>])</span><br><span class="line">y=torch.tensor([<span class="number">1</span>])</span><br><span class="line">x=torch.reshape(x,(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">loss_cross=nn.CrossEntropyLoss()</span><br><span class="line">result_cross=loss_cross(x,y)</span><br><span class="line">print(result_cross)</span><br></pre></td></tr></table></div></figure>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Sequential, Conv2d, MaxPool2d, Flatten, Linear</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line">dataset=torchvision.datasets.CIFAR10(<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,download=<span class="literal">True</span>,</span><br><span class="line">                                    transform=torchvision.transforms.ToTensor())</span><br><span class="line">dataloader=DataLoader(dataset,batch_size=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.model1=Sequential(</span><br><span class="line">            Conv2d(<span class="number">3</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Flatten(),</span><br><span class="line">            Linear(<span class="number">1024</span>, <span class="number">64</span>),</span><br><span class="line">            Linear(<span class="number">64</span>, <span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x=self.model1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">loss=nn.CrossEntropyLoss()</span><br><span class="line">tudui=Tudui()</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">    imgs,targets=data</span><br><span class="line">    output=tudui(imgs)</span><br><span class="line">    <span class="comment"># print(output)</span></span><br><span class="line">    <span class="comment"># print(targets)</span></span><br><span class="line">    result_loss=loss(output,targets)</span><br><span class="line">    print(result_loss)<span class="comment">#得到神经网络的输出和真实值的误差</span></span><br><span class="line">    result_loss.backward()</span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>优化器  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> Sequential, Conv2d, MaxPool2d, Flatten, Linear</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line">dataset=torchvision.datasets.CIFAR10(<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,download=<span class="literal">True</span>,</span><br><span class="line">                                    transform=torchvision.transforms.ToTensor())</span><br><span class="line">dataloader=DataLoader(dataset,batch_size=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.model1=Sequential(</span><br><span class="line">            Conv2d(<span class="number">3</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">32</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Conv2d(<span class="number">32</span>, <span class="number">64</span>, <span class="number">5</span>, padding=<span class="number">2</span>),</span><br><span class="line">            MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            Flatten(),</span><br><span class="line">            Linear(<span class="number">1024</span>, <span class="number">64</span>),</span><br><span class="line">            Linear(<span class="number">64</span>, <span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x=self.model1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">loss=nn.CrossEntropyLoss()</span><br><span class="line">tudui=Tudui()</span><br><span class="line"><span class="comment">#学习速率太小训练的慢，太大模型不稳定，一开始用比较大的，后来用比较小的</span></span><br><span class="line">optim=torch.optim.SGD(tudui.parameters(),lr=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">20</span>):<span class="comment">#epoch一轮一轮的意思</span></span><br><span class="line">    running_loss=<span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">        imgs,targets=data</span><br><span class="line">        output=tudui(imgs)</span><br><span class="line">        <span class="comment"># print(output)</span></span><br><span class="line">        <span class="comment"># print(targets)</span></span><br><span class="line">        result_loss=loss(output,targets)</span><br><span class="line">        optim.zero_grad()<span class="comment">#每个参数梯度清零</span></span><br><span class="line">        result_loss.backward()</span><br><span class="line">        optim.step()<span class="comment">#对每个参数调优，会跳到34行</span></span><br><span class="line">        running_loss=result_loss+result_loss<span class="comment">#所有数据整体的loss</span></span><br><span class="line">    print(running_loss)</span><br></pre></td></tr></table></div></figure></li>
<li>现有网络模型的使用及修改<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/vgg16_pretrained%3Dtrue.png" alt>  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dataset:ImageNet</span></span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># train_data=torchvision.datasets.ImageNet('../data_image_net',split='train',download=True,</span></span><br><span class="line"><span class="comment">#                                         transform=torchvision.transforms.ToTensor())</span></span><br><span class="line"></span><br><span class="line">vgg16_false=torchvision.models.vgg16(pretrainde=<span class="literal">False</span>)</span><br><span class="line">vgg16_true=torchvision.models.vgg16(pretrainde=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print('ok')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vgg16_true.add_module('add_linear',nn.Linear(1000,10))</span></span><br><span class="line">vgg16_true.classifier.add_module(<span class="string">'add_linear'</span>,nn.Linear(<span class="number">1000</span>,<span class="number">10</span>))</span><br><span class="line">print(vgg16_true)</span><br><span class="line"></span><br><span class="line">print(vgg16_false)</span><br><span class="line">vgg16_false.classifier[<span class="number">6</span>]=nn.Linear(<span class="number">4096</span>,<span class="number">10</span>)<span class="comment">#修改</span></span><br><span class="line">print(vgg16_false)</span><br></pre></td></tr></table></div></figure>
vgg16_add_module<br><img src="/2022/08/24/pytorch%E5%AD%A6%E4%B9%A0/vgg16_add_module.png" alt></li>
<li>网络模型的保存与读取<ul>
<li>模型的保存  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">vgg16=torchvision.models.vgg16(pretrained=<span class="literal">False</span>)</span><br><span class="line"><span class="comment">#保存方式1模型结构+模型参数</span></span><br><span class="line">torch.save(vgg16,<span class="string">'vgg16_method1.pth'</span>)<span class="comment">#.pth常用的后缀模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#保存方式2模型参数（官方推荐的保存方式）</span></span><br><span class="line">torch.save(vgg16.state_dict(),<span class="string">'vgg16_method2.pth'</span>)<span class="comment">#vgg16状态保存成字典格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#陷阱</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.conv1=nn.Conv2d(<span class="number">3</span>,<span class="number">64</span>,kernel_size=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x=self.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">tudui=Tudui()</span><br><span class="line">torch.save(tudui,<span class="string">'tudui_method1.pth'</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>模型的加载  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式1 -&gt;保存方式1，加载模型</span></span><br><span class="line"><span class="comment"># model=torch.load('vgg16_method1.pth')</span></span><br><span class="line"><span class="comment"># print(model)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2加载模型</span></span><br><span class="line">vgg16=torchvision.models.vgg16(pretrained=<span class="literal">False</span>)<span class="comment">#预训练设置为false</span></span><br><span class="line">vgg16.load_state_dict(torch.load(<span class="string">'vgg16_method2.pth'</span>))</span><br><span class="line"><span class="comment">#model=torch.load('vgg16_method2.pth')</span></span><br><span class="line">print(vgg16)</span><br><span class="line"></span><br><span class="line"><span class="comment">#陷阱1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.conv1=nn.Conv2d(<span class="number">3</span>,<span class="number">64</span>,kernel_size=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x=self.conv1(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">model=torch.load(<span class="string">'tudui_method1.pth'</span>)</span><br><span class="line">print(model)</span><br></pre></td></tr></table></div></figure>
  <br>

</li>
</ul>
</li>
</ul>

        <h3 id="6-完整的模型训练套路">
          <a href="#6-完整的模型训练套路" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-完整的模型训练套路" class="headerlink" title="6.完整的模型训练套路"></a>6.完整的模型训练套路</h3>
      <ul>
<li>准备数据集dataset</li>
<li>加载数据集dataloader</li>
<li>创建网络模型、损失函数、优化器</li>
<li>设置训练中的参数</li>
<li>设置训练轮数epoch</li>
<li>开始训练tudui.train()(此行代码意义不大)</li>
<li>优化器优化</li>
<li>开始测试tudui.eval() with torch.no_grad()</li>
<li>保存模型<br>以cifar10数据集为例  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#准备数据集</span></span><br><span class="line">train_data=torchvision.datasets.CIFAR10(root=<span class="string">'../dataset'</span>,train=<span class="literal">True</span>,transform=torchvision.transforms.ToTensor(),</span><br><span class="line">                                        download=<span class="literal">True</span>)</span><br><span class="line">test_data=torchvision.datasets.CIFAR10(root=<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,transform=torchvision.transforms.ToTensor(),</span><br><span class="line">                                    download=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#length长度</span></span><br><span class="line">train_data_size=len(train_data)</span><br><span class="line">test_data_size=len(test_data)</span><br><span class="line"><span class="comment">#如果train_data_size=10，训练数据集的长度为：10</span></span><br><span class="line"><span class="comment">#ctrl+d可以复制当前行</span></span><br><span class="line">print(<span class="string">'训练数据集长度为：&#123;&#125;'</span>.format(train_data_size))</span><br><span class="line">print(<span class="string">'测试数据集长度为：&#123;&#125;'</span>.format(test_data_size))</span><br><span class="line"></span><br><span class="line"><span class="comment">#利用dataloader来加载数据集</span></span><br><span class="line">train_dataloader=DataLoader(dataset=train_data,batch_size=<span class="number">64</span>)</span><br><span class="line">test_dataloader=DataLoader(dataset=test_data,batch_size=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># #搭建神经网络，见model.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建网络模型</span></span><br><span class="line">tudui=Tudui()</span><br><span class="line"></span><br><span class="line"><span class="comment">#损失函数</span></span><br><span class="line">loss_fn=nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line"><span class="comment">#优化器</span></span><br><span class="line"><span class="comment">#learning_rate=0.01</span></span><br><span class="line"><span class="comment">#1e-2=1*10^(-2)=1/100=0.01</span></span><br><span class="line">learning_rate=<span class="number">1e-2</span></span><br><span class="line">optimizer=torch.optim.SGD(tudui.parameters(),lr=learning_rate)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置训练网络的一些参数</span></span><br><span class="line">total_train_step=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#记录测试的次数</span></span><br><span class="line">total_test_step=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#训练次数</span></span><br><span class="line">epoch=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加tensorboard</span></span><br><span class="line">writer=SummaryWriter(<span class="string">'../logs_train'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(epoch):</span><br><span class="line">    print(<span class="string">'------第&#123;&#125;轮训练开始------'</span>.format(i+<span class="number">1</span>))</span><br><span class="line">    <span class="comment">#训练开始</span></span><br><span class="line">    tudui.train()</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> train_dataloader:</span><br><span class="line">        imgs,targets=data</span><br><span class="line">        outputs=tudui(imgs)</span><br><span class="line">        loss=loss_fn(outputs,targets)</span><br><span class="line">        <span class="comment">#优化器优化模型</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        total_train_step+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> total_train_step%<span class="number">100</span>==<span class="number">0</span>:</span><br><span class="line">            print(<span class="string">'训练次数：&#123;&#125;,Loss:&#123;&#125;'</span>.format(total_train_step,loss.item()))</span><br><span class="line">            writer.add_scalar(<span class="string">'train_loss'</span>,loss.item(),total_train_step)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#判断模型是否训练好：每次训练完之后在测试数据集上跑一遍，以测试数据集的损失或正确率来评估模型是否训练好</span></span><br><span class="line">    <span class="comment">#测试步骤开始</span></span><br><span class="line">    tudui.eval()</span><br><span class="line">    total_test_loss=<span class="number">0</span></span><br><span class="line">    total_accuracy=<span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():<span class="comment">#没有梯度调优，便于测试</span></span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> test_dataloader:</span><br><span class="line">            imgs,targets=data</span><br><span class="line">            outputs=tudui(imgs)</span><br><span class="line">            loss=loss_fn(outputs,targets)</span><br><span class="line">            total_test_loss+=loss.item()</span><br><span class="line">            accuracy=(outputs.argmax(<span class="number">1</span>)==targets).sum()</span><br><span class="line">            total_accuracy+=accuracy</span><br><span class="line">    print(<span class="string">'整体测试集上的Loss:&#123;&#125;'</span>.format(total_test_loss))</span><br><span class="line">    print(<span class="string">'整体测试集上的正确率：&#123;&#125;'</span>.format(total_accuracy/test_data_size))</span><br><span class="line">    writer.add_scalar(<span class="string">'test_loss'</span>,total_test_loss,total_test_step)</span><br><span class="line">    writer.add_scalar(<span class="string">'test_accuracy'</span>,total_accuracy/test_data_size,total_test_step)</span><br><span class="line">    total_test_step+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    torch.save(tudui,<span class="string">'tudui_&#123;&#125;.pth'</span>.format(i))</span><br><span class="line">    <span class="comment">#torch.save(tudui,'tudui_&#123;&#125;.pth'.format(i))#方式二</span></span><br><span class="line">    print(<span class="string">'模型已保存'</span>)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">a=torch.tensor(<span class="number">5</span>)</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment">#item()会把tensor数据类型转换成真实的数字</span></span><br><span class="line">print(a.item())</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test2</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">outputs=torch.tensor([[<span class="number">0.1</span>,<span class="number">0.2</span>],</span><br><span class="line">                    [<span class="number">0.05</span>,<span class="number">0.4</span>]])</span><br><span class="line">print(outputs.argmax(<span class="number">1</span>))<span class="comment">#为1的时候横向看 0.2和0.4最大，所以结果为1，1</span></span><br><span class="line">print(outputs.argmax(<span class="number">0</span>))<span class="comment">#为0的时候纵向看 0.1和0.4最大，所以结果为0，1</span></span><br><span class="line">preds=outputs.argmax(<span class="number">1</span>)</span><br><span class="line">targets=torch.tensor([<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line">print((preds==targets).sum())<span class="comment">#相等返回true，不相等返回false</span></span><br></pre></td></tr></table></div></figure>
  <br>

</li>
</ul>

        <h3 id="7-利用GPU训练">
          <a href="#7-利用GPU训练" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-利用GPU训练" class="headerlink" title="7.利用GPU训练"></a>7.利用GPU训练</h3>
      <p>若没有GPU，可访问Google colab<br>方式一</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="comment">#准备数据集</span></span><br><span class="line">train_data=torchvision.datasets.CIFAR10(root=<span class="string">'../dataset'</span>,train=<span class="literal">True</span>,transform=torchvision.transforms.ToTensor(),</span><br><span class="line">                                        download=<span class="literal">True</span>)</span><br><span class="line">test_data=torchvision.datasets.CIFAR10(root=<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,transform=torchvision.transforms.ToTensor(),</span><br><span class="line">                                       download=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#length长度</span></span><br><span class="line">train_data_size=len(train_data)</span><br><span class="line">test_data_size=len(test_data)</span><br><span class="line"><span class="comment">#如果train_data_size=10，训练数据集的长度为：10</span></span><br><span class="line"><span class="comment">#ctrl+d可以复制当前行</span></span><br><span class="line">print(<span class="string">'训练数据集长度为：&#123;&#125;'</span>.format(train_data_size))</span><br><span class="line">print(<span class="string">'测试数据集长度为：&#123;&#125;'</span>.format(test_data_size))</span><br><span class="line"></span><br><span class="line"><span class="comment">#利用dataloader来加载数据集</span></span><br><span class="line">train_dataloader=DataLoader(dataset=train_data,batch_size=<span class="number">64</span>)</span><br><span class="line">test_dataloader=DataLoader(dataset=test_data,batch_size=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#搭建神经网络</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.model=nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>,<span class="number">32</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>,<span class="number">32</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>,<span class="number">64</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>*<span class="number">4</span>*<span class="number">4</span>,<span class="number">64</span>),</span><br><span class="line">            nn.Linear(<span class="number">64</span>,<span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x=self.model(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"><span class="comment">#创建网络模型</span></span><br><span class="line">tudui=Tudui()</span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    tudui=tudui.cuda()</span><br><span class="line"></span><br><span class="line"><span class="comment">#损失函数</span></span><br><span class="line">loss_fn=nn.CrossEntropyLoss()</span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    loss_fn=loss_fn.cuda()</span><br><span class="line"></span><br><span class="line"><span class="comment">#优化器</span></span><br><span class="line"><span class="comment">#learning_rate=0.01</span></span><br><span class="line"><span class="comment">#1e-2=1*10^(-2)=1/100=0.01</span></span><br><span class="line">learning_rate=<span class="number">1e-2</span></span><br><span class="line">optimizer=torch.optim.SGD(tudui.parameters(),lr=learning_rate)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置训练网络的一些参数</span></span><br><span class="line">total_train_step=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#记录测试的次数</span></span><br><span class="line">total_test_step=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#训练次数</span></span><br><span class="line">epoch=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加tensorboard</span></span><br><span class="line">writer=SummaryWriter(<span class="string">'../logs_train'</span>)</span><br><span class="line">strat_time=time.time()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(epoch):</span><br><span class="line">    print(<span class="string">'------第&#123;&#125;轮训练开始------'</span>.format(i+<span class="number">1</span>))</span><br><span class="line">    <span class="comment">#训练步骤开始</span></span><br><span class="line">    tudui.train()</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> train_dataloader:</span><br><span class="line">        imgs,targets=data</span><br><span class="line">        <span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">            imgs=imgs.cuda()</span><br><span class="line">            targets=targets.cuda()</span><br><span class="line">        outputs=tudui(imgs)</span><br><span class="line">        loss=loss_fn(outputs,targets)</span><br><span class="line">        <span class="comment">#优化器优化模型</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        total_train_step+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> total_train_step%<span class="number">100</span>==<span class="number">0</span>:</span><br><span class="line">            end_time = time.time()</span><br><span class="line">            print(end_time-strat_time)</span><br><span class="line">            print(<span class="string">'训练次数：&#123;&#125;,Loss:&#123;&#125;'</span>.format(total_train_step,loss.item()))</span><br><span class="line">            writer.add_scalar(<span class="string">'train_loss'</span>,loss.item(),total_train_step)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#判断模型是否训练好：每次训练完之后在测试数据集上跑一遍，以测试数据集的损失或正确率来评估模型是否训练好</span></span><br><span class="line">    <span class="comment">#测试步骤开始</span></span><br><span class="line">    tudui.eval()</span><br><span class="line">    total_test_loss=<span class="number">0</span></span><br><span class="line">    total_accuracy=<span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():<span class="comment">#没有梯度调优，便于测试</span></span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> test_dataloader:</span><br><span class="line">            imgs,targets=data</span><br><span class="line">            <span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">                imgs = imgs.cuda()</span><br><span class="line">                targets = targets.cuda()</span><br><span class="line">            outputs=tudui(imgs)</span><br><span class="line">            loss=loss_fn(outputs,targets)</span><br><span class="line">            total_test_loss+=loss.item()</span><br><span class="line">            accuracy=(outputs.argmax(<span class="number">1</span>)==targets).sum()</span><br><span class="line">            total_accuracy+=accuracy</span><br><span class="line">    print(<span class="string">'整体测试集上的Loss:&#123;&#125;'</span>.format(total_test_loss))</span><br><span class="line">    print(<span class="string">'整体测试集上的正确率：&#123;&#125;'</span>.format(total_accuracy/test_data_size))</span><br><span class="line">    writer.add_scalar(<span class="string">'test_loss'</span>,total_test_loss,total_test_step)</span><br><span class="line">    writer.add_scalar(<span class="string">'test_accuracy'</span>,total_accuracy/test_data_size,total_test_step)</span><br><span class="line">    total_test_step+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    torch.save(tudui,<span class="string">'tudui_&#123;&#125;.pth'</span>.format(i))</span><br><span class="line">    <span class="comment">#torch.save(tudui,'tudui_&#123;&#125;.pth'.format(i))#方式二</span></span><br><span class="line">    print(<span class="string">'模型已保存'</span>)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure>
<p>方式二</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义了训练的设备</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义训练的设备</span></span><br><span class="line">device=torch.device(<span class="string">'cuda'</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">'cpu'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#准备数据集</span></span><br><span class="line">train_data=torchvision.datasets.CIFAR10(root=<span class="string">'../dataset'</span>,train=<span class="literal">True</span>,transform=torchvision.transforms.ToTensor(),</span><br><span class="line">                                        download=<span class="literal">True</span>)</span><br><span class="line">test_data=torchvision.datasets.CIFAR10(root=<span class="string">'../dataset'</span>,train=<span class="literal">False</span>,transform=torchvision.transforms.ToTensor(),</span><br><span class="line">                                       download=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#length长度</span></span><br><span class="line">train_data_size=len(train_data)</span><br><span class="line">test_data_size=len(test_data)</span><br><span class="line"><span class="comment">#如果train_data_size=10，训练数据集的长度为：10</span></span><br><span class="line"><span class="comment">#ctrl+d可以复制当前行</span></span><br><span class="line">print(<span class="string">'训练数据集长度为：&#123;&#125;'</span>.format(train_data_size))</span><br><span class="line">print(<span class="string">'测试数据集长度为：&#123;&#125;'</span>.format(test_data_size))</span><br><span class="line"></span><br><span class="line"><span class="comment">#利用dataloader来加载数据集</span></span><br><span class="line">train_dataloader=DataLoader(dataset=train_data,batch_size=<span class="number">64</span>)</span><br><span class="line">test_dataloader=DataLoader(dataset=test_data,batch_size=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#搭建神经网络</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.model=nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>,<span class="number">32</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>,<span class="number">32</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>,<span class="number">64</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>*<span class="number">4</span>*<span class="number">4</span>,<span class="number">64</span>),</span><br><span class="line">            nn.Linear(<span class="number">64</span>,<span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x=self.model(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"><span class="comment">#创建网络模型</span></span><br><span class="line">tudui=Tudui()</span><br><span class="line">tudui=tudui.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment">#损失函数</span></span><br><span class="line">loss_fn=nn.CrossEntropyLoss()</span><br><span class="line">loss_fn=loss_fn.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment">#优化器</span></span><br><span class="line"><span class="comment">#learning_rate=0.01</span></span><br><span class="line"><span class="comment">#1e-2=1*10^(-2)=1/100=0.01</span></span><br><span class="line">learning_rate=<span class="number">1e-2</span></span><br><span class="line">optimizer=torch.optim.SGD(tudui.parameters(),lr=learning_rate)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置训练网络的一些参数</span></span><br><span class="line">total_train_step=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#记录测试的次数</span></span><br><span class="line">total_test_step=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#训练次数</span></span><br><span class="line">epoch=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加tensorboard</span></span><br><span class="line">writer=SummaryWriter(<span class="string">'../logs_train'</span>)</span><br><span class="line">strat_time=time.time()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(epoch):</span><br><span class="line">    print(<span class="string">'------第&#123;&#125;轮训练开始------'</span>.format(i+<span class="number">1</span>))</span><br><span class="line">    <span class="comment">#训练步骤开始</span></span><br><span class="line">    tudui.train()</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> train_dataloader:</span><br><span class="line">        imgs,targets=data</span><br><span class="line">        imgs=imgs.to(device)</span><br><span class="line">        targets=targets.to(device)</span><br><span class="line">        outputs=tudui(imgs)</span><br><span class="line">        loss=loss_fn(outputs,targets)</span><br><span class="line">        <span class="comment">#优化器优化模型</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        total_train_step+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> total_train_step%<span class="number">100</span>==<span class="number">0</span>:</span><br><span class="line">            end_time = time.time()</span><br><span class="line">            print(end_time-strat_time)</span><br><span class="line">            print(<span class="string">'训练次数：&#123;&#125;,Loss:&#123;&#125;'</span>.format(total_train_step,loss.item()))</span><br><span class="line">            writer.add_scalar(<span class="string">'train_loss'</span>,loss.item(),total_train_step)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#判断模型是否训练好：每次训练完之后在测试数据集上跑一遍，以测试数据集的损失或正确率来评估模型是否训练好</span></span><br><span class="line">    <span class="comment">#测试步骤开始</span></span><br><span class="line">    tudui.eval()</span><br><span class="line">    total_test_loss=<span class="number">0</span></span><br><span class="line">    total_accuracy=<span class="number">0</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():<span class="comment">#没有梯度调优，便于测试</span></span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> test_dataloader:</span><br><span class="line">            imgs,targets=data</span><br><span class="line">            imgs = imgs.to(device)</span><br><span class="line">            targets = targets.to(device)</span><br><span class="line">            outputs=tudui(imgs)</span><br><span class="line">            loss=loss_fn(outputs,targets)</span><br><span class="line">            total_test_loss+=loss.item()</span><br><span class="line">            accuracy=(outputs.argmax(<span class="number">1</span>)==targets).sum()</span><br><span class="line">            total_accuracy+=accuracy</span><br><span class="line">    print(<span class="string">'整体测试集上的Loss:&#123;&#125;'</span>.format(total_test_loss))</span><br><span class="line">    print(<span class="string">'整体测试集上的正确率：&#123;&#125;'</span>.format(total_accuracy/test_data_size))</span><br><span class="line">    writer.add_scalar(<span class="string">'test_loss'</span>,total_test_loss,total_test_step)</span><br><span class="line">    writer.add_scalar(<span class="string">'test_accuracy'</span>,total_accuracy/test_data_size,total_test_step)</span><br><span class="line">    total_test_step+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    torch.save(tudui,<span class="string">'tudui_&#123;&#125;.pth'</span>.format(i))</span><br><span class="line">    <span class="comment">#torch.save(tudui,'tudui_&#123;&#125;.pth'.format(i))#方式二</span></span><br><span class="line">    print(<span class="string">'模型已保存'</span>)</span><br><span class="line">writer.close()</span><br></pre></td></tr></table></div></figure>

        <h3 id="8-完整的模型验证（测试，demo）套路">
          <a href="#8-完整的模型验证（测试，demo）套路" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-完整的模型验证（测试，demo）套路" class="headerlink" title="8.完整的模型验证（测试，demo）套路"></a>8.完整的模型验证（测试，demo）套路</h3>
      <p>利用已经训练好的模型，然后给它提供输入</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">image_path=<span class="string">'../images/QQ图片201802031008421.jpg'</span></span><br><span class="line">image=Image.open(image_path)<span class="comment">#PIL类型</span></span><br><span class="line">print(image)</span><br><span class="line"><span class="comment">#因为png格式是四个通道，除了RGB三通道外，还有一个透明度通道。所以，外面调用下述代码，保留其颜色通道</span></span><br><span class="line"><span class="comment">#当然，如果图片本来就是三个颜色通道，经过此操作，不变。加上这一步后，可以适应png jpg各种格式的图片</span></span><br><span class="line">image=image.convert(<span class="string">'RGB'</span>)</span><br><span class="line">transform=torchvision.transforms.Compose([torchvision.transforms.Resize((<span class="number">32</span>,<span class="number">32</span>)),</span><br><span class="line">                                          torchvision.transforms.ToTensor()])</span><br><span class="line">image=transform(image)</span><br><span class="line">print(image.shape)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tudui</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(Tudui, self).__init__()</span><br><span class="line">        self.model=nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>,<span class="number">32</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>,<span class="number">32</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>,<span class="number">64</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>),</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>*<span class="number">4</span>*<span class="number">4</span>,<span class="number">64</span>),</span><br><span class="line">            nn.Linear(<span class="number">64</span>,<span class="number">10</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        x=self.model(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">model=torch.load(<span class="string">'tudui_0.pth'</span>,map_location=torch.device(<span class="string">'cpu'</span>))</span><br><span class="line">print(model)</span><br><span class="line">image=torch.reshape(image,(<span class="number">1</span>,<span class="number">3</span>,<span class="number">32</span>,<span class="number">32</span>))</span><br><span class="line">model.eval()</span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">    output=model(image)</span><br><span class="line">print(output)</span><br><span class="line"></span><br><span class="line">print(output.argmax(<span class="number">1</span>))</span><br></pre></td></tr></table></div></figure></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/07/07/pytorch%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%AE%89%E8%A3%85/">pytorch环境的配置与安装</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-07-07</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-07-07</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="1-默认已经安装了Anaconda">
          <a href="#1-默认已经安装了Anaconda" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-默认已经安装了Anaconda" class="headerlink" title="1.默认已经安装了Anaconda"></a>1.默认已经安装了Anaconda</h2>
      
        <h2 id="2-Anaconda-Prompt">
          <a href="#2-Anaconda-Prompt" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Anaconda-Prompt" class="headerlink" title="2.Anaconda Prompt"></a>2.Anaconda Prompt</h2>
      <ul>
<li>根据自己的python版本创建pytorch环境  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n pytorch python=<span class="number">3.7</span></span><br></pre></td></tr></table></div></figure></li>
<li>激活环境  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate pytorch</span><br></pre></td></tr></table></div></figure>
  左边括号里的环境由base变成了pytorch</li>
<li>安装pytorch<ul>
<li>看下环境中的工具包，并没有pytorch  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip list</span><br></pre></td></tr></table></div></figure></li>
<li>查看电脑cuda版本<ul>
<li>桌面右键-NVIDIA控制面板-帮助-系统信息-组件-NVCUDA64.DLL,cuda版本向下兼容</li>
</ul>
</li>
<li><span class="exturl"><a class="exturl__link" href="https://pytorch.org/" target="_blank" rel="noopener">pytorch官网</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><ul>
<li>找到适合自己的版本，复制命令  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch torchvision torchaudio cudatoolkit=<span class="number">11.3</span> -c pytorch</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
<li>直接用命令安装较慢，可用镜像安装或先下载对应版本的pytorch和torchvision安装包，然后本地安装，我选择了离线安装<ul>
<li><span class="exturl"><a class="exturl__link" href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/win-64/" target="_blank" rel="noopener">清华镜像</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install后面为安装包的文件路径</span></span><br><span class="line">conda install D:\pytorch<span class="number">-1.6</span><span class="number">.0</span>-py3<span class="number">.8</span>_cpu_0.tar.bz2</span><br><span class="line">conda install D:\torchvision<span class="number">-0.7</span><span class="number">.0</span>-py38_cpu.tar.bz2</span><br></pre></td></tr></table></div></figure></li>
<li>验证是否安装成功<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment">#若没报错则安装成功</span></span><br></pre></td></tr></table></div></figure></li>
<li>报错<ul>
<li>winerror:126找不到指定模块<ul>
<li>升级numpy（命令中有提示，复制即可）  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update -n base -c defaults conda</span><br></pre></td></tr></table></div></figure></li>
<li>没有安装cudatoolkit<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#版本要对应</span></span><br><span class="line">conda install cudatoolkit=<span class="number">11.3</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>依旧报错，缺少依赖包，再次执行下载命令   <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch torchvision torchaudio cudatoolkit=<span class="number">11.3</span> -c pytorch</span><br></pre></td></tr></table></div></figure></li>
<li>检验安装成功  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip list</span><br><span class="line"><span class="comment">#发现有torch</span></span><br><span class="line">python</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment">#无报错信息</span></span><br><span class="line"> torch.cuda.is_available()</span><br><span class="line"> <span class="comment">#检验pytorch是否可以用GPU，返回True</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>附：镜像安装<ul>
<li>anaconda prompt      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</span><br><span class="line">conda config --set show_channel_urls yes</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/</span><br><span class="line">conda install pytorch torchvision torchaudio cudatoolkit=<span class="number">11.3</span></span><br><span class="line"><span class="comment">#删去-c pytorch</span></span><br></pre></td></tr></table></div></figure></li>
<li>安装成功<br>              
        <h2 id="3-Jupyter-Notebook">
          <a href="#3-Jupyter-Notebook" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Jupyter-Notebook" class="headerlink" title="3.Jupyter Notebook"></a>3.Jupyter Notebook</h2>
      </li>
</ul>
</li>
</ul>
</li>
<li>Jupyter默认安装在base环境下，但是base环境中没有安装 Pytorch，所以需要在pytorch环境下安装Jupyter</li>
<li>Anaconda Prompt  <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#base环境可以看到有要用到的package-ipykernel</span></span><br><span class="line">conda list</span><br><span class="line"><span class="comment">#进入pytorch环境，发现没有</span></span><br><span class="line">conda activate pytorch</span><br><span class="line">conda list</span><br><span class="line"><span class="comment">#安装</span></span><br><span class="line">conda install nb_conda</span><br><span class="line">jupyter notebook</span><br><span class="line"><span class="comment">#新建</span></span><br><span class="line">New-Python[conda env:pytorch]*</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"> torch.cuda.is_available()</span><br><span class="line"> <span class="comment">#返回true</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/06/24/DRF/">DRF</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-06-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-16</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="1-增删改查接口">
          <a href="#1-增删改查接口" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-增删改查接口" class="headerlink" title="1.增删改查接口"></a><strong>1.增删改查接口</strong></h2>
      <ul>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">GET /books/ 提供所有记录</span></span><br><span class="line"><span class="string">POST /books/ 新增一条记录</span></span><br><span class="line"><span class="string">GET /books/&lt;pk&gt;/ 提供指定id的记录</span></span><br><span class="line"><span class="string">PUT /books/&lt;pk&gt;/ 修改指定id的记录</span></span><br><span class="line"><span class="string">DELETE /books/&lt;pk&gt;/ 删除指定id的记录</span></span><br><span class="line"><span class="string">响应数据 JSON</span></span><br><span class="line"><span class="string">列表视图：路由后面没有pk/ID</span></span><br><span class="line"><span class="string">详情视图：路由后面pk/ID</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment">#192.168.103.210</span></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse,JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookListView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">'''列表视图'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="string">'''查询所有图书接口'''</span></span><br><span class="line">        <span class="comment">#1.查询出所有图书模型</span></span><br><span class="line">        books=BookInfo.objects.all()</span><br><span class="line">        <span class="comment">#2.遍历查询集，取出里面的每个书籍模型对象，把模型对象转换成字典</span></span><br><span class="line">        <span class="comment">#定义一个列表变量用来保存多个字典</span></span><br><span class="line">        book_list=[]</span><br><span class="line">        <span class="keyword">for</span> book <span class="keyword">in</span> books:</span><br><span class="line">            book_dict=&#123;</span><br><span class="line">                <span class="string">'id'</span>:book.id,</span><br><span class="line">                <span class="string">'btitle'</span>:book.btitle,</span><br><span class="line">                <span class="string">'bpub_date'</span>:book.bpub_date,</span><br><span class="line">                <span class="string">'bread'</span>:book.bread,</span><br><span class="line">                <span class="string">'bcomment'</span>:book.bcomment,</span><br><span class="line">                <span class="string">'image'</span>:book.image.url <span class="keyword">if</span> book.image <span class="keyword">else</span> <span class="string">''</span><span class="comment">#if不成立为None.url，返回空字符串</span></span><br><span class="line">            &#125;</span><br><span class="line">            book_list.append(book_dict)<span class="comment">#将转换好的字典添加到列表中</span></span><br><span class="line">        <span class="comment">#3.响应</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(book_list,safe=<span class="literal">False</span>)<span class="comment">#如果book_list不是一个字典的话就需要将safe设置成False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="string">'''新增图书接口'''</span></span><br><span class="line">        <span class="comment">#获取前端传入的请求体数据（json） request.body</span></span><br><span class="line">        json_str_bytes=request.body</span><br><span class="line">        <span class="comment">#把bytes类型的json字符串转换成json_str</span></span><br><span class="line">        json_str=json_str_bytes.decode()</span><br><span class="line">        <span class="comment">#利用json.loads将json字符串转换成json（字典、列表）</span></span><br><span class="line">        book_dict=json.loads(json_str)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#创建模型对象并保存（把字典转换成模型并存储）</span></span><br><span class="line">        book=BookInfo(</span><br><span class="line">            btitle=book_dict[<span class="string">'btitle'</span>],</span><br><span class="line">            bpub_date=book_dict[<span class="string">'bpub_date'</span>],</span><br><span class="line">        )</span><br><span class="line">        book.save()</span><br><span class="line">        <span class="comment">#把新增的模型转换成字典</span></span><br><span class="line">        json_dict = &#123;</span><br><span class="line">            <span class="string">'id'</span>: book.id,</span><br><span class="line">            <span class="string">'btitle'</span>: book.btitle,</span><br><span class="line">            <span class="string">'bpub_date'</span>: book.bpub_date,</span><br><span class="line">            <span class="string">'bread'</span>: book.bread,</span><br><span class="line">            <span class="string">'bcomment'</span>: book.bcomment,</span><br><span class="line">            <span class="string">'image'</span>: book.image.url <span class="keyword">if</span> book.image <span class="keyword">else</span> <span class="string">''</span>  <span class="comment"># if不成立为None.url，返回空字符串</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#响应（把新增的数据再响应回去，201）</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(json_dict,status=<span class="number">201</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookDetailView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">'''详情视图'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request,pk)</span>:</span></span><br><span class="line">        <span class="string">'''查询指定pk的图书接口'''</span></span><br><span class="line">        <span class="comment">#1.获取出指定pk的那个模型对象</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            book=BookInfo.objects.get(id=pk)</span><br><span class="line">        <span class="keyword">except</span> BookInfo.DoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(&#123;<span class="string">'message'</span>:<span class="string">'查询的数据不存在'</span>&#125;,status=<span class="number">404</span>)</span><br><span class="line">        <span class="comment">#2.模型对象转字典</span></span><br><span class="line">        book_dict = &#123;</span><br><span class="line">            <span class="string">'id'</span>: book.id,</span><br><span class="line">            <span class="string">'btitle'</span>: book.btitle,</span><br><span class="line">            <span class="string">'bpub_date'</span>: book.bpub_date,</span><br><span class="line">            <span class="string">'bread'</span>: book.bread,</span><br><span class="line">            <span class="string">'bcomment'</span>: book.bcomment,</span><br><span class="line">            <span class="string">'image'</span>: book.image.url <span class="keyword">if</span> book.image <span class="keyword">else</span> <span class="string">''</span>  <span class="comment"># if不成立为None.url，返回空字符串</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#3.响应</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(book_dict)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request,pk)</span>:</span></span><br><span class="line">        <span class="string">'''修改指定图书接口'''</span></span><br><span class="line">        <span class="comment">#先查询要修改的模型对象</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            book=BookInfo.objects.get(pk=pk)</span><br><span class="line">        <span class="keyword">except</span> BookInfo.DoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(&#123;<span class="string">'message'</span>:<span class="string">'要修改的数据不存在'</span>&#125;,status=<span class="number">404</span>)</span><br><span class="line">        <span class="comment">#获取前端传入的新数据（把数据转换成字典）</span></span><br><span class="line">        json_str_bytes=request.body</span><br><span class="line">        json_str=json_str_bytes.decode()</span><br><span class="line">        book_dict=json.loads(json_str)</span><br><span class="line">        <span class="comment">#book_dict=json.loads(request.body.decode())</span></span><br><span class="line">        <span class="comment">#重新给模型指定的属性赋值</span></span><br><span class="line">        book.btitle=book_dict[<span class="string">'btitle'</span>]</span><br><span class="line">        book.bpub_date=book_dict[<span class="string">'bpub_date'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">#调用save方法进行修改操作</span></span><br><span class="line">        book.save()</span><br><span class="line">        <span class="comment">#把修改后的模型再转换成字典</span></span><br><span class="line">        json_dict = &#123;</span><br><span class="line">            <span class="string">'id'</span>: book.id,</span><br><span class="line">            <span class="string">'btitle'</span>: book.btitle,</span><br><span class="line">            <span class="string">'bpub_date'</span>: book.bpub_date,</span><br><span class="line">            <span class="string">'bread'</span>: book.bread,</span><br><span class="line">            <span class="string">'bcomment'</span>: book.bcomment,</span><br><span class="line">            <span class="string">'image'</span>: book.image.url <span class="keyword">if</span> book.image <span class="keyword">else</span> <span class="string">''</span>  <span class="comment"># if不成立为None.url，返回空字符串</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#响应</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(json_dict)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self,request,pk)</span>:</span></span><br><span class="line">        <span class="string">'''删除指定图书接口'''</span></span><br><span class="line">        <span class="comment">#获取要删除的模型对象</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            book=BookInfo.objects.get(id=pk)</span><br><span class="line">        <span class="keyword">except</span> BookInfo.DoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(&#123;<span class="string">'message'</span>:<span class="string">'要删除的数据不存在'</span>&#125;,status=<span class="number">404</span>)</span><br><span class="line">        <span class="comment">#删除模型对象</span></span><br><span class="line">        book.delete()<span class="comment">#物理删除（真正从数据库中删除）</span></span><br><span class="line">        <span class="comment">#逻辑删除</span></span><br><span class="line">        <span class="comment"># book.is_delete=True</span></span><br><span class="line">        <span class="comment"># book.save()</span></span><br><span class="line">        <span class="comment">#响应：删除时不需要有响应体，但要指定状态码为204</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(status=<span class="number">204</span>)</span><br></pre></td></tr></table></div></figure>

        <h2 id="2-DRF框架简介">
          <a href="#2-DRF框架简介" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-DRF框架简介" class="headerlink" title="2.DRF框架简介"></a><strong>2.DRF框架简介</strong></h2>
      </li>
<li>序列化和反序列化<ul>
<li>序列化：（输出）模型转字典，只有删除操作不需要</li>
<li>反序列化：（输入）字典转模型，只有增加和修改操作需要</li>
<li>在开发REST API的视图中，虽然每个视图具体操作的数据不同，但增、删、改、查的实现流程基本套路化，所以这部分代码也是可以复⽤简化编写的：<ul>
<li>增：校验请求数据 -&gt; 执⾏反序列化过程 -&gt; 保存数据库 -&gt; 将保存的对象序列化并返回</li>
<li>删：判断要删除的数据是否存在 -&gt; 执⾏数据库删除</li>
<li>改：判断要修改的数据是否存在 -&gt; 校验请求的数据 -&gt; 执⾏反序列化过程 -&gt; 保存数据库 -&gt; 将保存的对象序列化并返回</li>
<li>查：查询数据库 -&gt; 将数据序列化并返回</li>
</ul>
</li>
<li>DRF将序列化和反序列化的业务逻辑进行了封装，程序员只需要将序列化和反序列化的数据传给DRF即可
        <h2 id="3-DRF安装和配置">
          <a href="#3-DRF安装和配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-DRF安装和配置" class="headerlink" title="3.DRF安装和配置"></a><strong>3.DRF安装和配置</strong></h2>
      </li>
</ul>
</li>
<li>DRF环境依赖<ul>
<li>python</li>
<li>django</li>
</ul>
</li>
<li>安装DRF  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework</span><br></pre></td></tr></table></div></figure></li>
<li>添加rest_framework应用<ul>
<li>settings.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line"><span class="string">'django.contrib.admin'</span>,</span><br><span class="line"><span class="string">'django.contrib.auth'</span>,</span><br><span class="line"><span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line"><span class="string">'django.contrib.sessions'</span>,</span><br><span class="line"><span class="string">'django.contrib.messages'</span>,</span><br><span class="line"><span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">'rest_framework'</span>, <span class="comment"># DRF</span></span><br><span class="line"><span class="string">'users.apps.UsersConfig'</span>, <span class="comment"># 安装users应⽤,演示基本使⽤</span></span><br><span class="line"><span class="string">'request_response.apps.RequestResponseConfig'</span>, <span class="comment"># 演示请求和响应</span></span><br><span class="line"><span class="string">'booktest.apps.BooktestConfig'</span>, <span class="comment"># 图书英雄管理应用</span></span><br><span class="line">]</span><br></pre></td></tr></table></div></figure></li>
</ul>
  <strong>【十行代码】</strong><ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line">router=DefaultRouter()<span class="comment">#创建路由器</span></span><br><span class="line">router.register(<span class="string">r'books'</span>,views.BookListView)<span class="comment">#注册路由</span></span><br><span class="line">urlpatterns+=router.urls<span class="comment">#把生成好的路由拼接到urlpatterns</span></span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookInfoSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfo</span><span class="params">(ModelViewSet)</span>:</span></span><br><span class="line">    <span class="string">'''定义类视图'''</span></span><br><span class="line">    <span class="comment">#指定查询集</span></span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#指定序列化器</span></span><br><span class="line">    serializer_class = BookInfoSerializer</span><br></pre></td></tr></table></div></figure></li>
<li>app目录(booktest)下新建serializers.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> BookInfo</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfoSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="string">'''定义序列化器'''</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span><span class="comment">#元类</span></span><br><span class="line">        model=BookInfo<span class="comment">#指定序列化从哪个模型映射字段</span></span><br><span class="line">        fields=<span class="string">'__all__'</span><span class="comment">#映射哪些字段</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/">excel实用技巧</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-05-21</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h3 id="1-计算合计数据">
          <a href="#1-计算合计数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-计算合计数据" class="headerlink" title="1.计算合计数据"></a><strong>1.计算合计数据</strong></h3>
      <p>方法：alt+=<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/alt%2B%3D.png" alt></p>

        <h3 id="2-填好空格信息">
          <a href="#2-填好空格信息" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-填好空格信息" class="headerlink" title="2.填好空格信息"></a><strong>2.填好空格信息</strong></h3>
      <p>方法：ctrl+e<br>【如果找不到规律就多写几个】<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/ctrl%2Be.jpg" alt></p>

        <h3 id="3-函数">
          <a href="#3-函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-函数" class="headerlink" title="3.函数"></a><strong>3.函数</strong></h3>
      
        <h4 id="3-1-sum实战">
          <a href="#3-1-sum实战" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-1-sum实战" class="headerlink" title="3.1 sum实战"></a><strong>3.1 sum实战</strong></h4>
      <p><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/sum.jpg" alt></p>
<ul>
<li>sum函数<ul>
<li>选中单元格，=SUM()，选中要求和的列即可自动填充</li>
<li>手机总销售额=SUM(Q:Q)</li>
</ul>
</li>
<li>SUMIF函数<ul>
<li>满足一个条件的求和<br>SUMIF(Range,Criteria,[Sum_range])条件范围，条件，求和范围</li>
<li>=SUMIF(，按tab键，选择插入函数，选中上述三个参数对应的列<br>2019年手机总销售额<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/sumif.jpg" alt></li>
<li>=SUMIF(B:B,B4,Q:Q)</li>
</ul>
</li>
<li>SUMIFS函数<ul>
<li>满足多个条件的求和</li>
<li>SUMIFS(Sum_range,Criteria_Range1,Criteria1,…)求和范围,条件范围1，条件1,…<br>2019年小米手机总销售额<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/sumifs1.jpg" alt><br>2019年2月1日到2月15日小米红米8A总销售额<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/sumifs2.jpg" alt>  </li>
</ul>
</li>
</ul>

        <h4 id="3-2-VLOOKUP实战">
          <a href="#3-2-VLOOKUP实战" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-2-VLOOKUP实战" class="headerlink" title="3.2 VLOOKUP实战"></a><strong>3.2 VLOOKUP实战</strong></h4>
      <p><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/vlookup.jpg" alt><br>做出其中一个，剩下的往下一拖即可</p>
<ul>
<li>VLOOKUP(lookup_value,table_array,col_index_num,[range_lookup])<ul>
<li>lookup_value：查找值（用谁找）</li>
<li>table_array：表格阵列（在哪找）</li>
<li>col_index_num：所在列数（在哪列）</li>
<li>range_lookup：查找方式<ul>
<li>精确（0）：一对一匹配<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/vlookup0.jpg" alt><br>其中4表示所选区域的第四列</li>
<li>模糊（1或不填）：没有一对一匹配<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/vlookup1.jpg" alt><br>col_index_num=3,range_lookup=1（因为是范围，无法精确查找）</li>
</ul>
</li>
<li>col_index_num必须为table_array中的第一列（若不在第一列，可将其复制到最前面）</li>
<li>正常是相对引用，若表格改变，则函数失效。选中参数按F4变成绝对引用，此时，参数前面会多一个$。</li>
<li>混合引用：列固定/行固定<br>固定单价的列，不固定行，所以F前加$，这样左右上下拖拽，结果仍然正确。<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/vlookup_%E7%BB%9D%E5%AF%B9.png" alt></li>
<li>跨表查询<br>选择参数时，先点击要查询的表，参数中会自动添加【表名】!，其他操作同上  </li>
</ul>
</li>
</ul>

        <h4 id="3-3数据透视表实战">
          <a href="#3-3数据透视表实战" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-3数据透视表实战" class="headerlink" title="3.3数据透视表实战"></a><strong>3.3数据透视表实战</strong></h4>
      <ul>
<li>选中数据，插入数据透视表，并根据需求将字段拖拽到四个区域。</li>
<li>建议行可以多几个维度，列最好只有1-2个维度（多了不好看）</li>
<li>若原数据改变，则右键数据透视表刷新即可</li>
<li>汇总方式<br><img src="/2022/05/21/excel%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/%E6%B1%87%E6%80%BB%E6%96%B9%E5%BC%8F.png" alt><ul>
<li>父行汇总的百分比：黑龙江的iPhone销售额百分比相加为1</li>
</ul>
</li>
<li>切片器：筛选数据，与数据透视表联动</li>
<li>放入ppt选择嵌入粘贴方式</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/04/15/django%E6%95%99%E7%A8%8B/">django教程</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-04-15</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2023-07-07</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="1-安装">
          <a href="#1-安装" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-安装" class="headerlink" title="1.安装"></a><strong>1.安装</strong></h2>
      <ul>
<li>win+r cmd</li>
<li>pip37 install django(我用的版本是python3.7，可自行更换)</li>
</ul>

        <h2 id="2-创建项目">
          <a href="#2-创建项目" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-创建项目" class="headerlink" title="2.创建项目"></a><strong>2.创建项目</strong></h2>
      <ul>
<li><p>命令行创建</p>
<ul>
<li>win+R cmd</li>
<li>进入某个目录（该目录为项目的创建目录）【建议与所有django项目放在同一目录，方便寻找】</li>
<li>执行命令创建项目  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"C:\Users\dell\PycharmProjects\untitled\venv\Scripts\django-admin.exe" startproject 项目名称【目录为python的安装目录】</span><br></pre></td></tr></table></div></figure></li>
<li>若scripts已加入环境变量则可用  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject 项目名称</span><br></pre></td></tr></table></div></figure>
</li>
</ul>
</li>
<li><p>pycharm</p>
<ul>
<li>新建项目，选择django</li>
<li>删去根目录下的templates文件夹</li>
<li>settings.py中删除TEMPLATES内的’DIRS’:[<del>os.path.join(BASE_DIR,’templates’)</del>]，否则render会优先从根目录下的templates目录找html，若寻找不到，会根据app的注册顺序逐一去他们的templates目录中寻找</li>
</ul>
</li>
<li><p>特殊说明：</p>
<ul>
<li>使用命令行创建的项目是标准的</li>
<li>pycharm在标准的基础上默认加了些东西。如上，需删除。  </li>
</ul>
</li>
</ul>

        <h2 id="3-默认项目的文件介绍">
          <a href="#3-默认项目的文件介绍" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-默认项目的文件介绍" class="headerlink" title="3.默认项目的文件介绍"></a><strong>3.默认项目的文件介绍</strong></h2>
      <ul>
<li>mysite<ul>
<li>__init__.py</li>
<li>asgi.py【用于接受网络请求，无需修改】【异步式】</li>
<li>settings.py【项目配置eg.链接数据库，注册app，<strong>经常操作</strong>】</li>
<li>urls.py【url和python函数的对应关系，<strong>经常操作</strong>】</li>
<li>wsgi.py【用于接受网络请求，无需修改】【同步式】</li>
</ul>
</li>
<li>venv</li>
<li>manage.py【用于项目的管理、启动，创建app，数据管理，<strong>经常用</strong>】  </li>
</ul>

        <h2 id="4-App">
          <a href="#4-App" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-App" class="headerlink" title="4. App"></a><strong>4. App</strong></h2>
      <ul>
<li>django可以编写比较大型的项目，将项目按功能划分为多个app。</li>
<li>【每个app可以有独自的表结构、HTML模板、css】</li>
<li>注意：较简洁的开发用不到多app。一般情况下，项目下创建一个app即可。</li>
<li>在pycharm终端平台Terminal通过mange.py创建app  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp app1</span><br></pre></td></tr></table></div></figure></li>
<li>app1<ul>
<li>__init__.py</li>
<li>migrations【数据库变更记录，固定，不用修改】<ul>
<li>__init__.py</li>
</ul>
</li>
<li>admin.py【django默认提供了admin后台管理功能。固定，不用修改】</li>
<li>apps.py【app启动类。固定，不用修改】</li>
<li>models.py【对数据库操作，<strong>重要</strong>】</li>
<li>tests.py【做单元测试】</li>
<li>views.py【url对应的函数定义在这，<strong>重要</strong>】  </li>
</ul>
</li>
</ul>

        <h2 id="5-启动运行django">
          <a href="#5-启动运行django" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-启动运行django" class="headerlink" title="5.启动运行django"></a><strong>5.启动运行django</strong></h2>
      <ul>
<li>接收用户请求，并返回页面</li>
<li>确保app已注册【settings.py】<ul>
<li>INSTALLED_APPS<ul>
<li>在其内加入’app1.apps.App1Config’</li>
<li>【此处App1Config与apps.py中App1Config类名称一致】<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/app%E6%B3%A8%E5%86%8C.png" alt></li>
</ul>
</li>
</ul>
</li>
<li>编写URL和视图函数view的对应关系【urls.py】<ul>
<li>urlpatterns<ul>
<li>注释掉django默认的对应关系  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#path('admin/', admin.site.urls),</span></span><br><span class="line">path(<span class="string">'index/'</span>, views.index),</span><br></pre></td></tr></table></div></figure></li>
<li>只要用户访问<code>www.xxx.com/index/</code>就会执行后面的函数</li>
</ul>
</li>
<li>urlpatterns之上<ul>
<li>导入函数  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app1 <span class="keyword">import</span> views</span><br></pre></td></tr></table></div></figure></li>
<li>只要访问index，就会在views找view.index函数，并执行函数<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/urlpattern.png" alt></li>
</ul>
</li>
</ul>
</li>
<li>编写视图函数【views.py】<ul>
<li>导入HttpResponse  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br></pre></td></tr></table></div></figure></li>
<li>def index(request)：  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">"欢迎使用"</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>index与url对应的函数一致，且函数默认有一个request参数<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/index%E5%87%BD%E6%95%B0.png" alt></li>
<li>用户访问index，将执行index函数，并返回“欢迎使用”。</li>
</ul>
</li>
<li>启动django<ul>
<li>命令行启动<ul>
<li>pycharm终端平台  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>pycharm启动<ul>
<li>运行mysite<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/start.png" alt></li>
</ul>
</li>
<li>打开服务器<br>  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/404.png" alt><ul>
<li>查看错误原因发现需加上index<br>  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/welcome.png" alt></li>
</ul>
</li>
</ul>
</li>
</ul>

        <h3 id="5-1再写一个页面">
          <a href="#5-1再写一个页面" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-1再写一个页面" class="headerlink" title="5.1再写一个页面"></a><strong>5.1再写一个页面</strong></h3>
      <ul>
<li>url与函数的对应关系</li>
<li>视图函数</li>
</ul>

        <h3 id="5-2-templates模板">
          <a href="#5-2-templates模板" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-2-templates模板" class="headerlink" title="5.2 templates模板"></a><strong>5.2 templates模板</strong></h3>
      <ul>
<li>django返回html用render</li>
<li>去app目录下的templates目录寻找user_list.html</li>
<li>不是去当前app寻找，是根据app的注册顺序逐一去他们的templates目录中寻找<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_list</span><span class="params">(request)</span>:</span>  </span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">"user_list.html"</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>app目录下新建templates文件夹</li>
<li>在该文件夹中新建html文件user_list.html  </li>
</ul>

        <h3 id="5-3静态文件">
          <a href="#5-3静态文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-3静态文件" class="headerlink" title="5.3静态文件"></a><strong>5.3静态文件</strong></h3>
      <ul>
<li>在开发过程中，一般将图片、CSS、js当作静态文件处理。 </li>
<li>在app目录下新建static文件夹来储存图片</li>
<li>static文件夹中必须创建img,css,js,plugins（插件）文件夹</li>
<li>django中静态文件static的引入须在文件开头写{% load static %}<ul>
<li>在引用时写上述代码加文件路径，如：<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'img/1.jpg' %&#125;"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

        <h2 id="6-模板语法">
          <a href="#6-模板语法" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-模板语法" class="headerlink" title="6.模板语法"></a><strong>6.模板语法</strong></h2>
      </li>
<li>本质上：在HTML中写一些占位符，由数据对这些占位符进行替换和处理</li>
<li>获取数据在HTML中给用户返回<ul>
<li>views.py<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tpl</span><span class="params">(request)</span>:</span></span><br><span class="line">name=<span class="string">"haha"</span></span><br><span class="line">roles=[<span class="string">"guanli"</span>,<span class="string">"ceo"</span>,<span class="string">"baoan"</span>]</span><br><span class="line"><span class="comment">#字典</span></span><br><span class="line">user_info=&#123;<span class="string">"name"</span>:<span class="string">"guo"</span>,<span class="string">"salary"</span>:<span class="number">10000</span>,<span class="string">"role"</span>:<span class="string">"cto"</span>&#125;</span><br><span class="line"><span class="comment">#列表套字典</span></span><br><span class="line">data_list=[</span><br><span class="line">    &#123;<span class="string">"name"</span>: <span class="string">"guo"</span>, <span class="string">"salary"</span>: <span class="number">10000</span>, <span class="string">"role"</span>: <span class="string">"cto"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"name"</span>: <span class="string">"wa"</span>, <span class="string">"salary"</span>: <span class="number">30000</span>, <span class="string">"role"</span>: <span class="string">"ceo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"name"</span>: <span class="string">"ja"</span>, <span class="string">"salary"</span>: <span class="number">20000</span>, <span class="string">"role"</span>: <span class="string">"cfo"</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'tpl.html'</span>, &#123;<span class="string">"n1"</span>: name,<span class="string">"n2"</span>:roles,<span class="string">"n3"</span>:user_info,<span class="string">"n4"</span>:data_list&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>tpl.html【返回一个单独的值】<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>study<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; n1 &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; n2 &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; n2.0 &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>#取列表中第零个索引 </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>#循环遍历n2</span><br><span class="line">        &#123;% raw %&#125;&#123;% for item in n2 %&#125;&#123;% endraw %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        &#123;% raw %&#125;&#123;% endfor %&#125;&#123;% endraw %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123; n3 &#125;&#125;</span><br><span class="line">    &#123;&#123; n3.name &#125;&#125;#根据字典的键获取</span><br><span class="line">    &#123;&#123; n3.salary &#125;&#125;</span><br><span class="line">    &#123;&#123; n3.role &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span>#字典可以遍历</span><br><span class="line">        &#123;% raw %&#125;&#123;% for k,v in n3.items %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; k &#125;&#125;=&#123;&#123; v &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;&#123;% endraw %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;&#123; n4.0 &#125;&#125;#输出列表中的第一个字典</span><br><span class="line">    #列表里面套字典可以遍历</span><br><span class="line">    &#123;% raw %&#125;&#123;% for item in n4 %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; item.name &#125;&#125; &#123;&#123; item.salary &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">    #django模板支持条件语句</span><br><span class="line">    &#123;% if n1 == "haha" %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>dadadadada<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>dududududu<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% if n1 == "aa" %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>aaaaa<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;% elif n1 == "haha" %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ddddd<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;&#123;% endraw %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></div></figure>
<img src="/2022/04/15/django%E6%95%99%E7%A8%8B/tpl_output.png" alt><br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/django.jpg" alt></li>
</ul>
</li>
<li>视图函数的render内部</li>
<li>读取含有模板语法的HTML文件</li>
<li>内部进行渲染（模板语法执行并替换数据）最终得到只包含HTML标签的字符串</li>
<li>将渲染（替换）完成的字符串返还给用户浏览器  </li>
</ul>
</li>
</ul>

        <h2 id="7-请求和响应">
          <a href="#7-请求和响应" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-请求和响应" class="headerlink" title="7.请求和响应"></a><strong>7.请求和响应</strong></h2>
      <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.【请求】获取用户请求方式get/post</span></span><br><span class="line">print(request.method)</span><br><span class="line"><span class="comment">#2.【请求】在url上传递值/something/?n1=123&amp;n2=999</span></span><br><span class="line">print(request.GET)</span><br><span class="line"><span class="comment">#3.【请求】在请求体中提交数据</span></span><br><span class="line">print(request.POST)</span><br><span class="line"><span class="comment">#4.【响应】HttpResponse("返回内容")，内容以字符串内容返回给请求者</span></span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">"返回内容"</span>)</span><br><span class="line"><span class="comment">#5.【响应】读取HTML的内容+渲染（替换），从而生成字符串，返回给用户浏览器</span></span><br><span class="line"><span class="keyword">return</span> render(request,<span class="string">'something.html'</span>,&#123;<span class="string">"title"</span>:<span class="string">" come on"</span>&#125;)</span><br><span class="line"><span class="comment">#something.html:&lt;h1&gt;something&#123;&#123; title &#125;&#125;&lt;/h1&gt;【页面显示内容：something come on】</span></span><br><span class="line"><span class="comment">#6.【响应】让浏览器重定向到其他的页面</span></span><br><span class="line"><span class="comment">#关于重定向： 浏览器向django发送请求，django返回内容给浏览器，让浏览器自行百度，百度给浏览器结果</span></span><br><span class="line"><span class="keyword">return</span> redirect(<span class="string">"https://www.baidu.com"</span>)</span><br></pre></td></tr></table></div></figure>
<p> <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/url_output.png" alt>  </p>

        <h3 id="案例：简易用户登录界面">
          <a href="#案例：简易用户登录界面" class="heading-link"><i class="fas fa-link"></i></a><a href="#案例：简易用户登录界面" class="headerlink" title="案例：简易用户登录界面"></a><strong>案例：简易用户登录界面</strong></h3>
      <ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用户登录</span></span><br><span class="line">path(<span class="string">'login/'</span>,views.login),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#用户第一次看到页面是get请求</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">"GET"</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br><span class="line">    <span class="comment">#如果是post请求，则获取用户提交的数据</span></span><br><span class="line">    <span class="comment">#print(request.POST)</span></span><br><span class="line">    <span class="comment">#return HttpResponse("登录成功")</span></span><br><span class="line"></span><br><span class="line">    username=request.POST.get(<span class="string">"user"</span>)</span><br><span class="line">    password = request.POST.get(<span class="string">"pwd"</span>)</span><br><span class="line">    <span class="comment">#校验用户名密码是否正确</span></span><br><span class="line">    <span class="keyword">if</span> username==<span class="string">"root"</span> <span class="keyword">and</span> password==<span class="string">"123"</span>:</span><br><span class="line">        <span class="comment">#return HttpResponse("登录成功")</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#正确则重定向到百度</span></span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">    <span class="comment">#返回文本</span></span><br><span class="line">    <span class="comment">#return HttpResponse("登录失败")</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#错误提示用户名或密码错误</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>,&#123;<span class="string">"error_msg"</span>:<span class="string">"用户名或密码错误"</span>&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>login.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/login/"</span>&gt;</span><span class="comment">&lt;!--提交数据用post!--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--django多了一层csrf_token验证的校验，更安全，不加会报错!--&gt;</span></span><br><span class="line">    &#123;% raw %&#125;&#123;% csrf_token %&#125;&#123;% endraw %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; error_msg &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></div></figure>
<ul>
<li>若form表单是post请求，则在form表单中加入csrf_token，否则会报下述错误<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/csrf_token.png" alt></li>
<li>django内部隐含生成的值，用于校验是否是该网页发出的请求<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/hidden.png" alt></li>
<li>结果返回：<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;QueryDict: &#123;&#39;csrfmiddlewaretoken&#39;: [&#39;zyPFcjwslou3WjA44xmvKQOR0y3hmrLGdNqEBgZpDn9wM3BZ7fQ6LYAeUbYaeQrS&#39;], &#39;user&#39;: [&#39;a&#39;], &#39;pwd&#39;: [&#39;a&#39;]&#125;&gt;</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>结果展示<ul>
<li>用户名、密码正确：跳转至百度</li>
<li>用户名、密码错误：提交按钮后红字显示用户名或密码错误  </li>
</ul>
</li>
</ul>

        <h2 id="8-数据库操作">
          <a href="#8-数据库操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-数据库操作" class="headerlink" title="8.数据库操作"></a><strong>8.数据库操作</strong></h2>
      <ul>
<li>MySQL数据库+pymysql  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="comment">#1.连接MySQL</span></span><br><span class="line"><span class="comment"># 连接database</span></span><br><span class="line"><span class="comment"># conn = pymysql.connect(host=“你的数据库地址”, user=“用户名”,password=“密码”,database=“数据库名”,charset=“utf8”)</span></span><br><span class="line">conn=pymysql.connect(host=<span class="string">"127.0.0.1"</span>,port=<span class="number">3306</span>,user=<span class="string">'root'</span>,passwd=<span class="string">"root123"</span>,charset=<span class="string">'utf8'</span>,db=<span class="string">'unicom'</span>)</span><br><span class="line"><span class="comment"># 得到一个可以执行SQL语句的光标对象</span></span><br><span class="line">cursor=conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line"><span class="comment">#2.发送指令</span></span><br><span class="line"><span class="comment"># 执行SQL语句</span></span><br><span class="line">cursor.execute(<span class="string">"insert into admin(username,password,mobile)values('wupeiqi','qwe123','15155555555')"</span>)</span><br><span class="line">conn.commit()</span><br><span class="line"><span class="comment">#3.关闭</span></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></div></figure></li>
<li>Django开发操作数据库更简单，内部提供了ORM框架  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.xxx.all()</span><br></pre></td></tr></table></div></figure>

        <h3 id="8-1安装第三方模块">
          <a href="#8-1安装第三方模块" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-1安装第三方模块" class="headerlink" title="8.1安装第三方模块"></a><strong>8.1安装第三方模块</strong></h3>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mysqlclient</span><br></pre></td></tr></table></div></figure>

</li>
</ul>
<p>【windows系统易报错，可在网上搜索mysqlclient wheel,根据python版本下载wheel包，根据wheel包安装】</p>

        <h3 id="8-2ORM">
          <a href="#8-2ORM" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-2ORM" class="headerlink" title="8.2ORM"></a><strong>8.2ORM</strong></h3>
      <ul>
<li>ORM可以帮助我们做两件事：<ul>
<li>创建、修改、删除数据库中的表（不用写SQL语句）【无法创建数据库】</li>
<li>操作表中的数据（不用写SQL语句）</li>
</ul>
</li>
<li>ORM可以帮助将代码翻译成SQL语言</li>
</ul>
<ol>
<li>自己创建数据库<ul>
<li>启动MySQL服务</li>
<li>cmd mysql -u root -p，然后输入密码进入mysql</li>
<li>利用自带工具创建数据库  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database django_test1 DEFAULT CHARSET utf8_general_ci;</span><br></pre></td></tr></table></div></figure></li>
<li>navicat中选中mytest右击新建数据库django_test1，字符集utf8，排序规则utf8_general_ci</li>
</ul>
</li>
<li>Django连接数据库<ul>
<li>在settings.py进行配置和修改<ul>
<li>注释掉文件中的DATABASE</li>
<li>插入代码  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">    <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">    <span class="string">'NAME'</span>:<span class="string">'django_test1'</span>,<span class="comment">#数据库名字</span></span><br><span class="line">    <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">    <span class="string">'PASSWORD'</span>: <span class="string">'001168'</span>,</span><br><span class="line">    <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,<span class="comment">#本机</span></span><br><span class="line">    <span class="string">'PORT'</span>: <span class="string">'3306'</span>,<span class="comment">#端口</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
<li>django操作表<ul>
<li>创建表<ul>
<li>models.py文件中：  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">与上述代码效果等效</span></span><br><span class="line"><span class="string">create table app1_userinfo(</span></span><br><span class="line"><span class="string">    int bigint auto_increment primary key,#自动生成id</span></span><br><span class="line"><span class="string">    name varchat(32),</span></span><br><span class="line"><span class="string">    passsword varchar(64),</span></span><br><span class="line"><span class="string">    age int</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></div></figure></li>
<li>terminal执行命令：【应在根目录下执行，如本项目应在mysite目录下】  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></div></figure>
  注意：app需已注册</li>
<li>mysql中操作  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use django_test1#选择数据库</span><br><span class="line">show tables;#查看该数据库中的表</span><br><span class="line">desc app1_userinfo;#查看表内容</span><br></pre></td></tr></table></div></figure>
  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/table.png" alt></li>
<li>若要创建其他的表则在models.py添加类，并执行上述两行代码，即可创建表  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(models.Model)</span>:</span>title=models.CharField(max_length=<span class="number">16</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(models.Model)</span>:</span>caption=models.CharField(max_length=<span class="number">16</span>)</span><br></pre></td></tr></table></div></figure>
  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/add_table.png" alt></li>
</ul>
</li>
<li>删除表<ul>
<li>若要删除创建的表则在models.py中将代码注释掉，并执行上述两行代码，即可删除表  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#class Role(models.Model):caption=models.CharField(max_length=16)</span></span><br></pre></td></tr></table></div></figure>
  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/del_table.png" alt></li>
<li>删掉表中的一项与上述操作一致，不再赘述        </li>
</ul>
</li>
<li>修改表<ul>
<li>在表中新增列时，由于已存在列中可能已有数据，所以新增列必须要指定新增列对应的数据</li>
<li>在userinfo表中添加size列,并执行上述第一行代码会报错  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name=models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    size=models.IntegerField()</span><br></pre></td></tr></table></div></figure>
  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/error_table_change.png" alt><ul>
<li>选择1并手动输入一个值，表示size列都等于该值，再执行第二行代码</li>
<li>选择2则退出，此时设置默认值<ul>
<li>在size中设置一个默认值，若有值则都替换成2，若无则都设置成2  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">size=models.IntegerField(default=<span class="number">2</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>也可将值默认为空  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=models.IntegerField(null=<span class="literal">True</span>,blank=<span class="literal">True</span>)</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>在开发中若想对表结构进行调整：<ul>
<li>在models.py文件中操作类即可</li>
<li>terminal执行命令  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
<li>操作表中的数据<ul>
<li>新建数据：类名.objects.create，里面有几列就添加几列  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Department.objects.create(title=<span class="string">"销售部"</span>)</span><br><span class="line">Department.objects.create(title=<span class="string">"IT部"</span>)</span><br><span class="line">Department.objects.create(title=<span class="string">"运营部"</span>)</span><br><span class="line">UserInfo.objects.create(name=<span class="string">"wupeiqi"</span>,password=<span class="string">"123"</span>,age=<span class="number">19</span>)</span><br><span class="line">UserInfo.objects.create(name=<span class="string">"zhuhufei"</span>, password=<span class="string">"666"</span>, age=<span class="number">29</span>)</span><br><span class="line">UserInfo.objects.create(name=<span class="string">"wuyangjun"</span>, password=<span class="string">"666"</span>)<span class="comment">#因age已设置默认值为2，所以不写age则将默认为2</span></span><br></pre></td></tr></table></div></figure>
  cmd操作：  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p#输入密码，进入数据库</span><br><span class="line">show databases;#查看所有数据库</span><br><span class="line">use django_test1;#选择数据库</span><br><span class="line">desc app1_department;#查看数据库中某个表</span><br><span class="line">select * from app1_department;#查看表内容</span><br></pre></td></tr></table></div></figure>
  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/create_table.png" alt></li>
<li>删除  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserInfo.objects.filter(id=<span class="number">3</span>).delete()<span class="comment">#filter加筛选条件</span></span><br><span class="line">Department.objects.all().delete()<span class="comment">#删除表中所有数据</span></span><br></pre></td></tr></table></div></figure>
  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/delete_table.png" alt></li>
<li>获取数据（筛选）  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#是一个列表，列表中是一行一行的数据[对象，对象，对象]，每个对象是一行数据，QuerySet类型</span></span><br><span class="line"><span class="comment">#本质：select * from userinfo</span></span><br><span class="line">data_list=UserInfo.objects.all()<span class="comment">#获取这张表中的所有数据</span></span><br><span class="line">print(data_list)</span><br><span class="line">结果：</span><br><span class="line">&lt;QuerySet [&lt;UserInfo: UserInfo object (<span class="number">1</span>)&gt;, &lt;UserInfo: UserInfo object (<span class="number">2</span>)&gt;, &lt;UserInfo: UserInfo object (<span class="number">4</span>)&gt;, &lt;UserInfo: UserInfo object (<span class="number">5</span>)&gt;]&gt;</span><br><span class="line"><span class="comment">#遍历</span></span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> data_list:</span><br><span class="line">    print(obj.id,obj.name,obj.password,obj.age)</span><br><span class="line">结果：</span><br><span class="line"><span class="number">1</span> wupeiqi <span class="number">123</span> <span class="number">19</span></span><br><span class="line"><span class="number">2</span> wupeiqi <span class="number">123</span> <span class="number">19</span></span><br><span class="line"><span class="number">4</span> zhuhufei <span class="number">666</span> <span class="number">29</span></span><br><span class="line"><span class="number">5</span> wuyangjun <span class="number">666</span> <span class="number">2</span></span><br></pre></td></tr></table></div></figure>
  根据id筛选：  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data_list1=UserInfo.objects.filter(id=<span class="number">1</span>)<span class="comment">#寻找id=1的一行数据（列表），仍是QuerySet</span></span><br><span class="line">row_obj=UserInfo.objects.filter(id=<span class="number">1</span>).first()<span class="comment">#获取第一条数据，得到的是对象</span></span><br><span class="line">print(row_obj.id,row_obj.name,row_obj.password,row_obj.age)</span><br><span class="line">结果：</span><br><span class="line"><span class="number">1</span> wupeiqi <span class="number">123</span> <span class="number">19</span></span><br></pre></td></tr></table></div></figure></li>
<li>更新数据  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserInfo.objects.all().update(password=<span class="number">999</span>)</span><br><span class="line">UserInfo.objects.filter(id=<span class="number">2</span>).update(age=<span class="number">999</span>)</span><br><span class="line">UserInfo.objects.filter(name=<span class="string">"zhuhufei"</span>).update(age=<span class="number">998</span>)</span><br></pre></td></tr></table></div></figure>
  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/update_table.png" alt></li>
</ul>
</li>
</ol>

        <h3 id="案例：用户管理">
          <a href="#案例：用户管理" class="heading-link"><i class="fas fa-link"></i></a><a href="#案例：用户管理" class="headerlink" title="案例：用户管理"></a><strong>案例：用户管理</strong></h3>
      <ol>
<li>展示用户列表<ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'info/list'</span>,views.info_list),</span><br></pre></td></tr></table></div></figure></li>
<li>函数views.py<ul>
<li>获取所有用户信息  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.获取数据库中所有的用户信息对象，对象，对象]</span></span><br><span class="line">data_list=UserInfo.objects.all()</span><br></pre></td></tr></table></div></figure></li>
<li>HTML渲染  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'info/list'</span>,views.info_list),</span><br><span class="line"><span class="comment">#2.渲染，返回给用户</span></span><br><span class="line"><span class="keyword">return</span> render(request,<span class="string">"info_list.html"</span>,&#123;<span class="string">"data_list"</span>:data_list&#125;)<span class="comment">#通过模板语法将数据库内容传递到前端</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>前端info_list.html   <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">path('info/list',views.info_list),</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>info列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/info/add/"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="comment">&lt;!--可跳转到添加用户界面--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="comment">&lt;!--可实现删除用户功能--&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            &#123;% raw %&#125; &#123;% for obj in data_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.password &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.age &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/info/delete?nid=&#123;&#123; obj.id &#125;&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="comment">&lt;!--通过删除按钮实现删除用户功能--&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;&#123;% endraw %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>结果<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/info_output.png" alt></li>
</ul>
</li>
<li>添加用户</li>
</ol>
<ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'info/add'</span>,views.info_add),</span><br></pre></td></tr></table></div></figure></li>
<li>函数views.py<ul>
<li>GET，看到页面，输入内容</li>
<li>POST，提交，并写入数据库<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">"GET"</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">"info_add.html"</span>)</span><br><span class="line">    <span class="comment">#获取用户提交的数据</span></span><br><span class="line">    user=request.POST.get(<span class="string">"user"</span>)</span><br><span class="line">    pwd = request.POST.get(<span class="string">"pwd"</span>)</span><br><span class="line">    age = request.POST.get(<span class="string">"age"</span>)</span><br><span class="line">    <span class="comment">#添加到数据库</span></span><br><span class="line">    UserInfo.objects.create(name=user,password=pwd,age=age)</span><br><span class="line">    <span class="comment">#添加成功则自动跳转</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/info/list"</span>)<span class="comment">#跳转到其他网页需写全网页</span></span><br></pre></td></tr></table></div></figure></li>
<li>indo_add.html  <figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;添加用户&lt;/h1&gt;</span><br><span class="line">    &lt;form method=<span class="string">"post"</span>&gt;&lt;!--若请求的地址和当前地址相同，则可以省略action=<span class="string">"/info/add/"</span>--&gt;</span><br><span class="line">        &#123;% raw %&#125; &#123;% csrf_token %&#125;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"user"</span> placeholder=<span class="string">"用户名"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"pwd"</span> placeholder=<span class="string">"密码"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"age"</span> placeholder=<span class="string">"年龄"</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;&#123;% endraw %&#125;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
<ol start="3">
<li>删除用户</li>
</ol>
<ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'info/delete'</span>,views.info_delete),</span><br></pre></td></tr></table></div></figure></li>
<li>函数views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8000/info/delete?nid=6</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info_delete</span><span class="params">(request)</span>:</span></span><br><span class="line">    nid=request.GET.get(<span class="string">'nid'</span>)</span><br><span class="line">    UserInfo.objects.filter(id=nid).delete()</span><br><span class="line">    <span class="comment">#return HttpResponse("删除成功")</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/info/list"</span>)<span class="comment">#删除成功跳转回用户列表界面</span></span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h2 id="9-主题：员工管理系统">
          <a href="#9-主题：员工管理系统" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-主题：员工管理系统" class="headerlink" title="9.主题：员工管理系统"></a><strong>9.主题：员工管理系统</strong></h2>
      
        <h3 id="9-1-新建项目">
          <a href="#9-1-新建项目" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-1-新建项目" class="headerlink" title="9.1.新建项目"></a><strong>9.1.新建项目</strong></h3>
      <ul>
<li>删除settings.py中DIRS内容，使其变成空列表</li>
<li>删除templates目录  </li>
</ul>

        <h3 id="9-2-创建app并注册">
          <a href="#9-2-创建app并注册" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-2-创建app并注册" class="headerlink" title="9.2.创建app并注册"></a><strong>9.2.创建app并注册</strong></h3>
      <ul>
<li>选择工具(Tools)下拉菜单中的Run manage.py Task…【pycharm自动帮助执行了python manage.py】输入startapp website</li>
<li>settings.py中INSTALLED_APPS中加入’website.apps.WebsiteConfig’,完成app的注册  </li>
</ul>

        <h3 id="9-3-设计表结构-django">
          <a href="#9-3-设计表结构-django" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-3-设计表结构-django" class="headerlink" title="9.3.设计表结构(django)"></a><strong>9.3.设计表结构(django)</strong></h3>
      <ul>
<li><p>用户表存储部门名称还是ID？</p>
<p>  ID：数据库范式（理论知识），常见开发都是这样。【节省存储开销】<br>  名称：特别大的公司。查询的次数非常多，连表操作比较耗时。【加速查找，允许数据冗余】</p>
</li>
<li><p>部门ID需不需要约束？</p>
<p>  需要。只能是部门表中已存在的ID </p>
</li>
<li><p>部门被删除，关联的用户怎么办？</p>
<ul>
<li>删除用户：级联删除，depart_id中加入参数on_delete=models.CASCADE</li>
<li>不删除，用户对应的部门id列置空，depart_id中加入参数null=True,blank=True,on_delete=models.SET_NULL</li>
<li>models.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">'''部门表'''</span></span><br><span class="line">    title=models.CharField(verbose_name=<span class="string">'标题'</span>,max_length=<span class="number">32</span>)<span class="comment">#verbose_name:对表进行注解，可写可不写</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">'''员工表'''</span></span><br><span class="line">    <span class="comment">#浮点型CharField需要加最大长度，整型IntegerField不需要加</span></span><br><span class="line">    name=models.CharField(verbose_name=<span class="string">'姓名'</span>,max_length=<span class="number">16</span>)</span><br><span class="line">    password=models.CharField(verbose_name=<span class="string">'密码'</span>,max_length=<span class="number">64</span>)</span><br><span class="line">    age=models.IntegerField(verbose_name=<span class="string">'年龄'</span>)</span><br><span class="line">    <span class="comment">#decimal是准确的小数值，m是数字总个数（负号不算），d是小数点后个数，m最大值为65，d最大值为30。decimal(m,d)</span></span><br><span class="line">    account=models.DecimalField(verbose_name=<span class="string">'账户余额'</span>,max_digits=<span class="number">10</span>,decimal_places=<span class="number">2</span>,default=<span class="number">0</span>)</span><br><span class="line">    create_time=models.DateTimeField(verbose_name=<span class="string">'入职时间'</span>)</span><br><span class="line">    <span class="comment">#部门id只能是部门表中已存在的id（django自动做），否则报错</span></span><br><span class="line">    <span class="comment"># 无约束</span></span><br><span class="line">    <span class="comment">#depart_id=models.BigIntegerField(verbose_name='部门id')</span></span><br><span class="line">    <span class="comment"># 有约束</span></span><br><span class="line">    <span class="comment">#to：与表关联，to_field：与表中的哪个列关联</span></span><br><span class="line">    <span class="comment">#写的是depart，但生成数据列时会自动加上_id</span></span><br><span class="line">    depart=models.ForeignKey(to=<span class="string">'Department'</span>,to_field=<span class="string">'id'</span>,on_delete=models.CASCADE)<span class="comment">#部门表被删除：级联删除</span></span><br><span class="line">    <span class="comment">#depart = models.ForeignKey(to='Department', to_field='id',null=True,blank=True,on_delete=models.SET_NULL)# 部门表被删除：置空</span></span><br><span class="line">    <span class="comment">#在django中做的约束</span></span><br><span class="line">    gender_choices=(<span class="comment">#性别1代表男，2代表女</span></span><br><span class="line">        (<span class="number">1</span>,<span class="string">'男'</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">'女'</span>),</span><br><span class="line">    )</span><br><span class="line">    gender=models.SmallIntegerField(verbose_name=<span class="string">'性别'</span>,choices=gender_choices)</span><br></pre></td></tr></table></div></figure>

</li>
</ul>
</li>
</ul>

        <h3 id="9-4-在MySQL中生成表">
          <a href="#9-4-在MySQL中生成表" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-4-在MySQL中生成表" class="headerlink" title="9.4.在MySQL中生成表"></a><strong>9.4.在MySQL中生成表</strong></h3>
      <ul>
<li>工具连接MySQL生成数据库【cmd】   <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p输入密码</span><br><span class="line">create database Staffing_System DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span><br></pre></td></tr></table></div></figure></li>
<li>修改配置文件，连接MySQL【settings.py】  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>:<span class="string">'Staffing_System'</span>,<span class="comment">#数据库名字</span></span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'001168'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'localhost'</span>,<span class="comment">#本机</span></span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,<span class="comment">#端口</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>django命令生成数据库表<ul>
<li>选择工具(Tools)下拉菜单中的Run manage.py Task…  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></div></figure></li>
<li>表结构创建成功   <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show databases;#查看数据库</span><br><span class="line">use staffing_system;#选择数据库</span><br><span class="line">show tables;#查看表</span><br><span class="line">desc website_department;#看表中的数据</span><br></pre></td></tr></table></div></figure>

</li>
</ul>
</li>
</ul>

        <h3 id="9-5静态文件管理">
          <a href="#9-5静态文件管理" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-5静态文件管理" class="headerlink" title="9.5静态文件管理"></a><strong>9.5静态文件管理</strong></h3>
      <ul>
<li>app目录下创建static文件夹，并在其中创建<ul>
<li>css文件夹</li>
<li>js文件夹<br>  js目录下导入jquery-3.3.1-min.js文件</li>
<li>imgs文件夹</li>
<li>plugins文件夹<ul>
<li>plugins目录中导入官网下载的预编译bootstrap代码   </li>
</ul>
</li>
</ul>
</li>
<li>website下创建templates目录作为模板文件  </li>
</ul>

        <h3 id="9-6部门管理">
          <a href="#9-6部门管理" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-6部门管理" class="headerlink" title="9.6部门管理"></a><strong>9.6部门管理</strong></h3>
      <ul>
<li>体验最原始的方法来做</li>
<li>使用django中提供的Form和ModelForm组件，十分方便  </li>
</ul>

        <h4 id="9-6-1部门列表">
          <a href="#9-6-1部门列表" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-6-1部门列表" class="headerlink" title="9.6.1部门列表"></a>9.6.1部门列表</h4>
      <ul>
<li>bootstrap引用【jquery.js应在bootstrap.js之前引用】<ul>
<li>cdn引用  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>本地引用<ul>
<li><span class="exturl"><a class="exturl__link" href="https://getbootstrap.com/" target="_blank" rel="noopener">bootstrap官网</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>下载即用型编译代码，解压放在static/plugins目录下<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% load static %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/css/bootstrap.min.css' %&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'js/jquery-3.3.1.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/js/bootstrap.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> website <span class="keyword">import</span> views</span><br><span class="line">path(<span class="string">'depart/list'</span>,views.depart_list),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#部门列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depart_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'depart_list.html'</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>depart_list.html<ul>
<li>引用bootstrap</li>
<li>进入<span class="exturl"><a class="exturl__link" href="https://v3.bootcss.com/" target="_blank" rel="noopener">bootstrap中文文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，选择组件，选择导航复制代码<ul>
<li>页面右键选择检查，选择“在页面中选择一个元素以进行检查”或ctrl+shift+c，选中要复制的位置，复制代码    </li>
</ul>
</li>
<li>head中添加下述代码，去掉圆角  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.navbar</span>&#123;</span></span><br><span class="line">        border-radius: 0;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>button中标题改成联通用户管理系统</li>
<li>删掉  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Link <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>所有内容【下拉功能】</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form navbar-left"</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span>所有内容【输入框功能】</span><br></pre></td></tr></table></div></figure></li>
<li>完整代码  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% load static %&#125;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/css/bootstrap.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.navbar</span>&#123;</span></span><br><span class="line">            border-radius: 0;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span> <span class="attr">data-target</span>=<span class="string">"#bs-example-navbar-collapse-1"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>联通用户管理系统<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Collect the nav links, forms, and other content for toggling --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"bs-example-navbar-collapse-1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/depart/list/"</span>&gt;</span>部门管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>吴佩琦 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>个人资料<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>我的信息<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.navbar-collapse --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.container-fluid --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-bottom:10px "</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus-sign"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    新建部门</span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Default panel contents --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-th-list"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        部门列表</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Table --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-bordered"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>1<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>销售部<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>@mdo<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'js/jquery-3.3.1.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/js/bootstrap.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">    &lt;script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"&gt;&lt;/script&gt;--&gt;</span>&#123;% endraw %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>此时运行代码，css样式显示不出来，网页显示404无法找到bootstrap.min.css,bootstrap.min.js,jquery-3.3.1.min.js。可能是路径问题。</li>
<li>settings.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">由STATIC_URL = <span class="string">'/static/'</span><span class="comment">#相对路径</span></span><br><span class="line">改为STATIC_URL = <span class="string">'static/'</span></span><br></pre></td></tr></table></div></figure></li>
<li>css样式成功显示！  </li>
</ul>

        <h4 id="9-6-2部门-数据库数据">
          <a href="#9-6-2部门-数据库数据" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-6-2部门-数据库数据" class="headerlink" title="9.6.2部门-数据库数据"></a><strong>9.6.2部门-数据库数据</strong></h4>
      <ul>
<li>在数据库中添加两行数据【mysql】  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into website_department(title) value(&quot;IT部门&quot;),(&quot;销售部&quot;);</span><br><span class="line">select * from website_department;#查看部门表中内容</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> website <span class="keyword">import</span> models<span class="comment">#引入models</span></span><br><span class="line"><span class="comment">#部门列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depart_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#去数据库中获取所有的部门列表</span></span><br><span class="line">    <span class="comment">#[对象，对象，对象]</span></span><br><span class="line">    queryset=models.Department.objects.all()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'depart_list.html'</span>,&#123;<span class="string">'queryset'</span>:queryset&#125;)<span class="comment">#queryset传到前端页面</span></span><br></pre></td></tr></table></div></figure></li>
<li>department_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    &#123;% raw %&#125; &#123;% for obj in queryset %&#125;#遍历queryset</span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; obj.id &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>@mdo<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;&#123;% endraw %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>效果展示<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/system_add.png" alt>  </li>
</ul>

        <h4 id="9-6-3部门-添加页面">
          <a href="#9-6-3部门-添加页面" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-6-3部门-添加页面" class="headerlink" title="9.6.3部门-添加页面"></a><strong>9.6.3部门-添加页面</strong></h4>
      <ul>
<li>department_list.html修改为  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-bottom:10px "</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/depart/add"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus-sign"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        新建部门</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'depart/add'</span>,views.depart_add),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depart_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#添加部门</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'depart_add.html'</span>)</span><br></pre></td></tr></table></div></figure>
<ul>
<li>department_add.html<ul>
<li> {% load static %}</li>
<li>bootstrap、js以及样式引用  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/css/bootstrap.min.css' %&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.navbar</span> &#123;</span></span><br><span class="line">        border-radius: 0;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% raw %&#125; <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'js/jquery-3.3.1.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/js/bootstrap.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>导航条与list页面保持一致  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">data-target</span>=<span class="string">"#bs-example-navbar-collapse-1"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>联通用户管理系统<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Collect the nav links, forms, and other content for toggling --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"bs-example-navbar-collapse-1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/depart/list/"</span>&gt;</span>部门管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>吴佩琦 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>个人资料<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>我的信息<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.navbar-collapse --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.container-fluid --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>表单<ul>
<li>bootstrap官网复制面板代码并修改title，将Panel content改成表单  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 新建部门 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">        Panel content</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>bootstrap官网复制表单代码，并修改如下  <figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span>="<span class="title">form</span>-<span class="title">group</span>"&gt;</span></span><br><span class="line"><span class="class">    &lt;label&gt;标题&lt;/label&gt;</span></span><br><span class="line"><span class="class">    &lt;input type="text" class="form-control" placeholder="标题" name="title"/&gt;</span></span><br><span class="line"><span class="class">&lt;/div&gt;</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>完整代码  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% load static %&#125;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/css/bootstrap.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.navbar</span> &#123;</span></span><br><span class="line">            border-radius: 0;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"navbar-toggle collapsed"</span> <span class="attr">data-toggle</span>=<span class="string">"collapse"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">data-target</span>=<span class="string">"#bs-example-navbar-collapse-1"</span> <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"icon-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>联通用户管理系统<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Collect the nav links, forms, and other content for toggling --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span> <span class="attr">id</span>=<span class="string">"bs-example-navbar-collapse-1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/depart/list/"</span>&gt;</span>部门管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"dropdown"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"dropdown-toggle"</span> <span class="attr">data-toggle</span>=<span class="string">"dropdown"</span> <span class="attr">role</span>=<span class="string">"button"</span> <span class="attr">aria-haspopup</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">aria-expanded</span>=<span class="string">"false"</span>&gt;</span>吴佩琦 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"caret"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>个人资料<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>我的信息<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>Something else here<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span> <span class="attr">role</span>=<span class="string">"separator"</span> <span class="attr">class</span>=<span class="string">"divider"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>注销<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.navbar-collapse --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.container-fluid --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 新建部门 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span><span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"标题"</span> <span class="attr">name</span>=<span class="string">"title"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'js/jquery-3.3.1.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/js/bootstrap.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span>&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
<li>效果展示<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/depart_add.png" alt>
        <h4 id="9-6-4部门-添加">
          <a href="#9-6-4部门-添加" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-6-4部门-添加" class="headerlink" title="9.6.4部门-添加"></a><strong>9.6.4部门-添加</strong></h4>
      </li>
<li>depart_add.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">&#123;% raw %&#125; &#123;% csrf_token %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depart_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#添加部门</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">"GET"</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'depart_add.html'</span>)</span><br><span class="line">    <span class="comment">#获取用户post提交过来的数据</span></span><br><span class="line">    title=request.POST.get(<span class="string">"title"</span>)<span class="comment">#获取前端form表单name=title的内容</span></span><br><span class="line">    <span class="comment">#保存到数据库</span></span><br><span class="line">    models.Department.objects.create(title=title)</span><br><span class="line">    <span class="comment">#重定向回部门列表</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/depart/list"</span>)</span><br></pre></td></tr></table></div></figure>

        <h4 id="9-6-5部门-删除">
          <a href="#9-6-5部门-删除" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-6-5部门-删除" class="headerlink" title="9.6.5部门-删除"></a><strong>9.6.5部门-删除</strong></h4>
      </li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'depart/delete'</span>,views.depart_delete),</span><br></pre></td></tr></table></div></figure></li>
<li>函数views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#http://127.0.0.1:8000/info/delete?nid=3</span></span><br><span class="line"><span class="comment">#删除部门</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depart_delete</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#获取id</span></span><br><span class="line">    nid=request.GET.get(<span class="string">'nid'</span>)</span><br><span class="line">    <span class="comment">#删除</span></span><br><span class="line">    models.Department.objects.filter(id=nid).delete()</span><br><span class="line">    <span class="comment">#重定向回部门列表</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/depart/list"</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>depart_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#添加跳转页面通过按钮“删除”实现http://127.0.0.1:8000/info/delete?nid=3相同功能</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"/depart/delete?nid=&#123;&#123; obj.id &#125;&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

        <h4 id="9-6-6部门-编辑">
          <a href="#9-6-6部门-编辑" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-6-6部门-编辑" class="headerlink" title="9.6.6部门-编辑"></a><strong>9.6.6部门-编辑</strong></h4>
      </li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#正则表达式&lt;int:nid&gt;传一个整型</span></span><br><span class="line"><span class="comment"># #http://127.0.0.1:8000/depart/2/edit</span></span><br><span class="line">path(<span class="string">'depart/&lt;int:nid&gt;/edit'</span>,views.depart_edit),</span><br></pre></td></tr></table></div></figure></li>
<li>depart_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"/depart/&#123;&#123; obj.id &#125;&#125;/edit"</span>&gt;</span>删编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>函数views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改部门</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depart_edit</span><span class="params">(request, nid)</span>:</span>  <span class="comment"># 通过url传过来的真实的id</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        <span class="comment"># 根据nid，获取他的数据，获取的是要编辑的那行对象</span></span><br><span class="line">        row_object = models.Department.objects.filter(id=nid).first()</span><br><span class="line">        <span class="comment"># print(row_object.id,row_object.title)</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'depart_edit.html'</span>, &#123;<span class="string">'row_object'</span>: row_object&#125;)</span><br><span class="line">    <span class="comment">#提交</span></span><br><span class="line">    <span class="comment"># 获取用户提交的标题</span></span><br><span class="line">    title=request.POST.get(<span class="string">"title"</span>)</span><br><span class="line">    <span class="comment">#根据id找到数据库中的数据并进行更新</span></span><br><span class="line">    <span class="comment">#models.Department.objects.filter(id=nid).update(title=title,其他=123)#更新多个字段</span></span><br><span class="line">    models.Department.objects.filter(id=nid).update(title=title)</span><br><span class="line">    <span class="comment">#重定向回部门列表</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">"/depart/list"</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>复制depart_add.html，并将新建部门改成修改部门重命名为depart_edit.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--value:设置默认值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"标题"</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; row_object.title &#125;&#125;"</span>/&gt;</span></span><br></pre></td></tr></table></div></figure>

        <h2 id="9-7模板的继承">
          <a href="#9-7模板的继承" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-7模板的继承" class="headerlink" title="9.7模板的继承"></a><strong>9.7模板的继承</strong></h2>
      </li>
<li>如想要修改导航，则只需要修改layout.html中的即可，所有继承了模板的文件都可以生效。如果不继承，需要修改所有用了导航的HTML文件</li>
<li>新建layout.html，复制depart_list.html代码，删除<div class="container">及其中所有内容，并添加<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% block content %&#125;&#123;% endblock %&#125;<span class="comment">&lt;!--当有页面继承了该模板，只需要编写content里面的内容就可以--&gt;</span>&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></div></li>
<li>测试页面index.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html'%&#125;<span class="comment">&lt;!--继承模板--&gt;</span></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></div></figure>
<ul>
<li>相当于在layout中block中加入h1标签</li>
</ul>
</li>
<li>depart_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-bottom:10px "</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/depart/add"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus-sign"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                新建部门</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Default panel contents --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-th-list"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                部门列表</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Table --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-bordered"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;% for obj in queryset %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; obj.id &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"/depart/&#123;&#123; obj.id &#125;&#125;/edit"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"/depart/delete?nid=&#123;&#123; obj.id &#125;&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>@mdo<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>depart_edit.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 修改部门 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span><span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"标题"</span> <span class="attr">name</span>=<span class="string">"title"</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">value</span>=<span class="string">"&#123;&#123; row_object.title &#125;&#125;"</span>/&gt;</span><span class="comment">&lt;!--value:设置默认值--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>depart_add.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 新建部门 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span><span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"标题"</span> <span class="attr">name</span>=<span class="string">"title"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>定义母板layout.html：  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugins/bootstrap-3.4.1-dist/css/bootstrap.min.css' %&#125;"</span>&gt;</span><span class="comment">&lt;!--引入css样式--&gt;</span></span><br><span class="line">    &#123;% block css %&#125;&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% block content %&#125;&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>底部<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'js/jquery-3.3.1.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="comment">&lt;!--引入js样式--&gt;</span></span><br><span class="line">&#123;% block js %&#125;&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>&#123;% endraw %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>继承母板  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html'%&#125;<span class="comment">&lt;!--继承模板--&gt;</span></span><br><span class="line">&#123;% block css %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'pluxxx.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block js %&#125;</span><br><span class="line">    <span class="comment">&lt;!--引入其他js样式，将js填充到母板，允许每个页面有自己独立的样式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'js/jquery-3.3.1.min.js' %&#125;"</span>&gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="9-8用户管理">
          <a href="#9-8用户管理" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8用户管理" class="headerlink" title="9.8用户管理"></a><strong>9.8用户管理</strong></h3>
      
        <h4 id="9-8-1用户-列表">
          <a href="#9-8-1用户-列表" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-1用户-列表" class="headerlink" title="9.8.1用户-列表"></a><strong>9.8.1用户-列表</strong></h4>
      <ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'user/list'</span>, views.user_list),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用户管理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#获取所有的用户列表[obj,obj,obj]</span></span><br><span class="line">    queryset=models.UserInfo.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#用python的语法获取数据</span></span><br><span class="line">    <span class="comment">#for obj in queryset:</span></span><br><span class="line">        <span class="comment">#datatime类型转化为字符串类型strftime("%Y-%m-%d-%H-%M")</span></span><br><span class="line">        <span class="comment">#print(obj.id,obj.name,obj.account,obj.create_time.strftime("%Y-%m-%d"),obj.gender,obj.get_gender_display(),obj.depart_id,obj.depart.title)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#obj.gender#1/2</span></span><br><span class="line">        <span class="comment">#obj.get_gender_display()#get_字段名称_display()找到1、2对应的名称</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#obj.depart_id获取数据库中存储的那个字段值</span></span><br><span class="line">        <span class="comment">#obj.depart根据id自动去关联的表中获取那一行数据depart对象</span></span><br><span class="line">        <span class="comment">#print(obj.name,obj.depart_id)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 获取部门id对应的部门名称</span></span><br><span class="line">        <span class="comment"># xx=models.Department.objects.filter(id=obj.depart_id).first()</span></span><br><span class="line">        <span class="comment"># xx.title</span></span><br><span class="line">        <span class="comment">#obj.depart.title#根据id自动去关联的表中获取那一行数据depart对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'user_list.html'</span>,&#123;<span class="string">"queryset"</span>:queryset&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>user_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125;&#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-bottom:10px "</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus-sign"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                新建用户</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Default panel contents --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-th-list"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                用户列表</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Table --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-bordered"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>余额<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>入职时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>所属部门<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;% for obj in queryset %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; obj.id &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.password &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.age &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.account &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.create_time|date:"Y-m-d" &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="comment">&lt;!--模板语法中用|date:"Y-m-d H:i:s"输出时间--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.get_gender_display &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="comment">&lt;!--模板语法中不允许加括号--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.depart.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125; &#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>layout.html<br>部门管理下面一行新增  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/user/list"</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>构造数据库数据  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------------+------+-----+---------+----------------+</span><br><span class="line">| Field       | Type          | Null | Key | Default | Extra          |</span><br><span class="line">+-------------+---------------+------+-----+---------+----------------+</span><br><span class="line">| id          | bigint        | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name        | varchar(16)   | NO   |     | NULL    |                |</span><br><span class="line">| password    | varchar(64)   | NO   |     | NULL    |                |</span><br><span class="line">| age         | int           | NO   |     | NULL    |                |</span><br><span class="line">| account     | decimal(10,2) | NO   |     | NULL    |                |</span><br><span class="line">| create_time | datetime(6)   | NO   |     | NULL    |                |</span><br><span class="line">| gender      | smallint      | NO   |     | NULL    |                |</span><br><span class="line">| depart_id   | bigint        | NO   | MUL | NULL    |                |</span><br><span class="line">+-------------+---------------+------+-----+---------+----------------+</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">insert into website_userinfo(name,password,age,account,create_time,gender,depart_id)values("韩超","666",23,100.68,"2020-01-11",2,1);</span><br><span class="line">insert into website_userinfo(name,password,age,account,create_time,gender,depart_id)values("刘东","123",23,100.68,"2010-11-11",1,4);</span><br><span class="line">insert into website_userinfo(name,password,age,account,create_time,gender,depart_id)values("朱虎飞","999",33,9900.68,"2021-05-11",1,1);</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> select * from website_userinfo;</span></span><br><span class="line">+----+-----------+----------+-----+---------+----------------------------+--------+-----------+</span><br><span class="line">| id | name      | password | age | account | create_time                | gender | depart_id |</span><br><span class="line">+----+-----------+----------+-----+---------+----------------------------+--------+-----------+</span><br><span class="line">|  1 | 韩超      | 666      |  23 |  100.68 | 2020-01-11 00:00:00.000000 |      2 |         1 |</span><br><span class="line">|  2 | 刘东      | 123      |  23 |  100.68 | 2010-11-11 00:00:00.000000 |      1 |         4 |</span><br><span class="line">|  3 | 朱虎飞    | 999      |  33 | 9900.68 | 2021-05-11 00:00:00.000000 |      1 |         1 |</span><br><span class="line">+----+-----------+----------+-----+---------+----------------------------+--------+-----------+</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h4 id="9-8-2用户-添加（原始方法）">
          <a href="#9-8-2用户-添加（原始方法）" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-2用户-添加（原始方法）" class="headerlink" title="9.8.2用户-添加（原始方法）"></a><strong>9.8.2用户-添加（原始方法）</strong></h4>
      <ul>
<li>新建用户：<ul>
<li>原始方法理思路：不会采用（本质）【麻烦】</li>
<li>user_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/user/add"</span>&gt;</span><span class="comment">&lt;!--新建用户跳转链接--&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'user/add'</span>, views.user_add),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加用户(原始方式)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        context = &#123;</span><br><span class="line">            <span class="string">'gender_choices'</span>: models.UserInfo.gender_choices,</span><br><span class="line">            <span class="string">'depart_list'</span>: models.Department.objects.all()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'user_add.html'</span>, context)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取用户提交的数据</span></span><br><span class="line">    user=request.POST.get(<span class="string">'user'</span>)</span><br><span class="line">    pwd = request.POST.get(<span class="string">'pwd'</span>)</span><br><span class="line">    age = request.POST.get(<span class="string">'age'</span>)</span><br><span class="line">    account = request.POST.get(<span class="string">'ac'</span>)</span><br><span class="line">    ctime = request.POST.get(<span class="string">'ctime'</span>)</span><br><span class="line">    gender = request.POST.get(<span class="string">'gd'</span>)</span><br><span class="line">    depart_id = request.POST.get(<span class="string">'dp'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#添加到数据库中</span></span><br><span class="line">    models.UserInfo.objects.create(name=user,password=pwd,age=age,account=account,create_time=ctime,gender=gender,depart_id=depart_id)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#返回到用户列表页面</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/user/list'</span>)</span><br></pre></td></tr></table></div></figure>
<ul>
<li>user_add.html<ul>
<li>因新建用户和新建部门界面相同，故复制depart_add.html并加以修改<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 新建用户 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span><span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"姓名"</span> <span class="attr">name</span>=<span class="string">"user"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"年龄"</span> <span class="attr">name</span>=<span class="string">"age"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>余额<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"余额"</span> <span class="attr">name</span>=<span class="string">"ac"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>入职时间<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"入职时间"</span> <span class="attr">name</span>=<span class="string">"ctime"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">name</span>=<span class="string">"gd"</span>&gt;</span></span><br><span class="line">                            &#123;% for item in gender_choices %&#125;</span><br><span class="line">                                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; item.0 &#125;&#125;"</span>&gt;</span>&#123;&#123; item.1 &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="comment">&lt;!--item.0表示1、2，item.1表示男女--&gt;</span></span><br><span class="line">                            &#123;% endfor %&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span>&gt;</span>部门<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">name</span>=<span class="string">"dp"</span>&gt;</span></span><br><span class="line">                            &#123;% for item in depart_list %&#125;</span><br><span class="line">                                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; item.id &#125;&#125;"</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                                &#123;% endfor %&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
<li>缺点<ul>
<li>用户提交的数据没有校验</li>
<li>若有错误，页面上应该有错误提示</li>
<li>页面上每一个字段都需要重新写一遍</li>
<li>关联的数据需要手动的获取并循环展示在页面</li>
</ul>
</li>
</ul>
</li>
<li>django组件<pre><code>- form组件（没那么方便），需要写代码
- modelform组件（最方便）  </code></pre></li>
</ul>

        <h4 id="9-8-3初识Form">
          <a href="#9-8-3初识Form" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-3初识Form" class="headerlink" title="9.8.3初识Form"></a><strong>9.8.3初识Form</strong></h4>
      <ol>
<li>views.py <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span><span class="params">(Form)</span>:</span><span class="comment">#Form为django内置的Form</span></span><br><span class="line">    user=forms.Charfield(widget=forms.Input)<span class="comment">#widget:会在HTML页面中显示出输入框</span></span><br><span class="line">    pwd=forms.Charfield(widget=forms.Input)</span><br><span class="line">    email=forms.Charfield(widget=forms.Input)</span><br><span class="line">    account=forms.Charfield(widget=forms.Input)</span><br><span class="line">    create_time=forms.Charfield(widget=forms.Input)</span><br><span class="line">    depart=forms.Charfield(widget=forms.Input)</span><br><span class="line">    gender=forms.Charfield(widget=forms.Input)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        form=MyForm()<span class="comment">#实例化MyForm对象</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'user_add.html'</span>, &#123;<span class="string">"form"</span>:form&#125;)<span class="comment">#把form传回到前端页面</span></span><br></pre></td></tr></table></div></figure></li>
<li>user_add.html <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125;<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span>      </span><br><span class="line">    &#123;%for field in form%&#125;<span class="comment">&lt;!--自动循环form中的所有字段--&gt;</span>        </span><br><span class="line">        &#123;&#123;field&#125;&#125;</span><br><span class="line">    &#123;%endfor%&#125;</span><br><span class="line">    <span class="comment">&lt;!--&lt;input type="text" placeholder="姓名" name="user"/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></div></figure>
 <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span>      </span><br><span class="line">    &#123;&#123;form.user&#125;&#125;<span class="comment">&lt;!--自动生成html标签--&gt;</span>        </span><br><span class="line">    &#123;&#123;form.pwd&#125;&#125; </span><br><span class="line">    &#123;&#123;form.email&#125;&#125; </span><br><span class="line">    <span class="comment">&lt;!--&lt;input type="text" placeholder="姓名" name="user"/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span>     &#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ol>

        <h4 id="9-8-4ModelForm-推荐">
          <a href="#9-8-4ModelForm-推荐" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-4ModelForm-推荐" class="headerlink" title="9.8.4ModelForm(推荐)"></a><strong>9.8.4ModelForm(推荐)</strong></h4>
      <ol start="0">
<li>models.py <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"> <span class="string">'''员工表'''</span></span><br><span class="line">    name=models.CharField(verbose_name=<span class="string">'姓名'</span>,max_length=<span class="number">16</span>)</span><br><span class="line">    password=models.CharField(verbose_name=<span class="string">'密码'</span>,max_length=<span class="number">64</span>)</span><br><span class="line">    age=models.IntegerField(verbose_name=<span class="string">'年龄'</span>)</span><br><span class="line">    account=models.DecimalField(verbose_name=<span class="string">'账户余额'</span>,max_digits=<span class="number">10</span>,decimal_places=<span class="number">2</span>,default=<span class="number">0</span>)</span><br><span class="line">    create_time=models.DateTimeField(verbose_name=<span class="string">'入职时间'</span>)</span><br><span class="line">    depart=models.ForeignKey(to=<span class="string">'Department'</span>,to_field=<span class="string">'id'</span>,on_delete=models.CASCADE)<span class="comment">#部门表被删除：级联删除</span></span><br><span class="line">    gender_choices=(<span class="comment">#性别1代表男，2代表女</span></span><br><span class="line">        (<span class="number">1</span>,<span class="string">'男'</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">'女'</span>),</span><br><span class="line">    )</span><br><span class="line">    gender=models.SmallIntegerField(verbose_name=<span class="string">'性别'</span>,choices=gender_choices)</span><br></pre></td></tr></table></div></figure></li>
<li>views.py <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span><span class="params">(ModelForm)</span>:</span></span><br><span class="line">    xx=form.CharField*(<span class="string">"..."</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model=UserInfo</span><br><span class="line">        fields=&#123;<span class="string">"name"</span>,<span class="string">"password"</span>,<span class="string">"age"</span>,<span class="string">"xx"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        form=MyForm()<span class="comment">#实例化MyForm对象</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'user_add.html'</span>, &#123;<span class="string">"form"</span>:form&#125;)<span class="comment">#把form传回到前端页面</span></span><br></pre></td></tr></table></div></figure></li>
<li>user_add.html <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125; <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span>      </span><br><span class="line">    &#123;%for field in form%&#125;<span class="comment">&lt;!--自动循环form中的所有字段--&gt;</span>        </span><br><span class="line">        &#123;&#123;field&#125;&#125;</span><br><span class="line">    &#123;%endfor%&#125;</span><br><span class="line">    <span class="comment">&lt;!--&lt;input type="text" placeholder="姓名" name="user"/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span> &#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>
 <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span>      </span><br><span class="line">    &#123;&#123;form.user&#125;&#125;<span class="comment">&lt;!--自动生成html标签--&gt;</span>        </span><br><span class="line">    &#123;&#123;form.pwd&#125;&#125; </span><br><span class="line">    &#123;&#123;form.email&#125;&#125; </span><br><span class="line">    <span class="comment">&lt;!--&lt;input type="text" placeholder="姓名" name="user"/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

</li>
</ol>

        <h4 id="9-8-5用户-添加（ModelForm）">
          <a href="#9-8-5用户-添加（ModelForm）" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-5用户-添加（ModelForm）" class="headerlink" title="9.8.5用户-添加（ModelForm）"></a><strong>9.8.5用户-添加（ModelForm）</strong></h4>
      <ul>
<li><p>user_list.html</p>
  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/user/model/form/add"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus-sign"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">新建用户ModelForm</span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li><p>urls.py</p>
   <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'/user/model/form/add'</span>, views.user_model_form_add),</span><br></pre></td></tr></table></div></figure></li>
<li><p>views.py</p>
  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">obj=Foo()</span><br><span class="line">print(obj)</span><br><span class="line"><span class="comment">#输出结果：&lt;website.views.Foo object at 0x0000020B9AD410F0&gt;</span></span><br></pre></td></tr></table></div></figure>
  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line">obj1=Foo(<span class="string">"IT部门"</span>)</span><br><span class="line">print(obj1)<span class="comment">#输出对象时，如果想要定制显示的内容</span></span><br><span class="line">obj2=Foo(<span class="string">"销售部"</span>)</span><br><span class="line">print(obj2)</span><br><span class="line"><span class="comment">#输出结果：</span></span><br><span class="line"><span class="comment">#IT部门</span></span><br><span class="line"><span class="comment">#销售部</span></span><br></pre></td></tr></table></div></figure>
  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##完整代码</span></span><br><span class="line"><span class="comment">##########ModelForm实例############</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model=models.UserInfo</span><br><span class="line">        fields=[<span class="string">'name'</span>,<span class="string">'password'</span>,<span class="string">'age'</span>,<span class="string">'account'</span>,<span class="string">'create_time'</span>,<span class="string">'gender'</span>,<span class="string">'depart'</span>]</span><br><span class="line">        <span class="comment"># widgets=&#123;</span></span><br><span class="line">        <span class="comment">#     "name":forms.TextInput(attrs=&#123;"class":"form-control"&#125;)#页面显示的输入框用input标签，并使用class样式</span></span><br><span class="line">        <span class="comment">#     "password": forms.PasswordInput(attrs=&#123;"class": "form-control"&#125;)</span></span><br><span class="line">        <span class="comment">#     "age": forms.TextInput(attrs=&#123;"class": "form-control"&#125;)</span></span><br><span class="line">        <span class="comment"># &#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,*args,**kwargs)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        <span class="comment">#循环找到所有的插件，添加一个class="form-control"的样式</span></span><br><span class="line">        <span class="keyword">for</span> name,field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">            <span class="comment">#print(name,field)#输出名字和对象</span></span><br><span class="line">            <span class="comment">#if name=='password':#某个插件不使用该样式</span></span><br><span class="line">                <span class="comment">#continue</span></span><br><span class="line">            field.widget.attrs=&#123;<span class="string">"class"</span>:<span class="string">"form-control"</span>,<span class="string">"placeholder"</span>:field.label&#125;</span><br><span class="line"><span class="comment">#添加用户(ModelForm版本)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_model_form_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    form=UserModelForm()</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'user_model_form_add.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br></pre></td></tr></table></div></figure>
<p>  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/user_cre.png" alt><br>  加入placeholder，显示如下<br>  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/user_cre_placeholder.png" alt></p>
</li>
<li><p>models.py</p>
  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Department类中新增</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.title<span class="comment">#输出显示部门名称</span></span><br></pre></td></tr></table></div></figure>
<p>  若不加上述代码，页面会显示部门对象</p>
<p>  <img src="/2022/04/15/django%E6%95%99%E7%A8%8B/depart_obj.png" alt></p>
</li>
<li><p>user_model_form_add.html</p>
  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 复制user_add.html代码，并加以修改 --&gt;</span></span><br><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 新建用户 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span><span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    &#123;% for field in form %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123;field.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="comment">&lt;!--中文名称(verbose_name)--&gt;</span></span><br><span class="line">                            &#123;&#123; field &#125;&#125;<span class="comment">&lt;!--输入框--&gt;</span></span><br><span class="line">                            &#123;#<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"姓名"</span> <span class="attr">name</span>=<span class="string">"user"</span>/&gt;</span>#&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h4 id="9-8-6用户-添加和错误提示">
          <a href="#9-8-6用户-添加和错误提示" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-6用户-添加和错误提示" class="headerlink" title="9.8.6用户-添加和错误提示"></a><strong>9.8.6用户-添加和错误提示</strong></h4>
      <ul>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##########ModelForm实例############</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    name=forms.CharField(min_length=<span class="number">3</span>,label=<span class="string">"用户名"</span>)<span class="comment">#验证规则可以有很多</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.UserInfo</span><br><span class="line">        fields=[<span class="string">'name'</span>,<span class="string">'password'</span>,<span class="string">'age'</span>,<span class="string">'account'</span>,<span class="string">'create_time'</span>,<span class="string">'gender'</span>,<span class="string">'depart'</span>]</span><br><span class="line">        <span class="comment"># widgets=&#123;</span></span><br><span class="line">        <span class="comment">#     "name":forms.TextInput(attrs=&#123;"class":"form-control"&#125;)#页面显示的输入框用input标签，并使用class样式</span></span><br><span class="line">        <span class="comment">#     "password": forms.PasswordInput(attrs=&#123;"class": "form-control"&#125;)</span></span><br><span class="line">        <span class="comment">#     "age": forms.TextInput(attrs=&#123;"class": "form-control"&#125;)</span></span><br><span class="line">        <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 循环找到所有的插件，添加一个class="form-control"的样式</span></span><br><span class="line">        <span class="keyword">for</span> name, field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">            <span class="comment"># print(name,field)#输出名字和对象</span></span><br><span class="line">            <span class="comment"># if name=='password':#某个插件不使用该样式</span></span><br><span class="line">            <span class="comment">#     continue</span></span><br><span class="line">            field.widget.attrs = &#123;<span class="string">"class"</span>: <span class="string">"form-control"</span>, <span class="string">"placeholder"</span>: field.label&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加用户(ModelForm版本)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_model_form_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        form = UserModelForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'user_model_form_add.html'</span>, &#123;<span class="string">'form'</span>: form&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用户POST提交数据，要进行数据校验，不允许为空</span></span><br><span class="line">    form = UserModelForm(data=request.POST)  <span class="comment"># 用户提交的所有数据给了ModelForm</span></span><br><span class="line">    print(<span class="number">11</span>)</span><br><span class="line">    print(request.POST)</span><br><span class="line">    <span class="comment">#print(form.cleaned_data)</span></span><br><span class="line">    <span class="keyword">if</span> form.is_valid():  <span class="comment"># 校验成功</span></span><br><span class="line">        <span class="comment">#&#123;'name': '吴佩琦2', 'password': '123', 'age': 19, 'account': Decimal('0'), 'create_time': datetime.datetime(2011, 11, 11, 0, 0, tzinfo=&lt;UTC&gt;), 'gender': 1, 'depart': &lt;Department: 媒体企划&gt;&#125;</span></span><br><span class="line">        <span class="comment"># 如果数据合法，则保存到数据库</span></span><br><span class="line">        <span class="comment">#print(form.cleaned_data)</span></span><br><span class="line">        <span class="comment"># models.UserInfo.objects.create(...)</span></span><br><span class="line">        <span class="comment">#print(1)</span></span><br><span class="line">        form.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/user/list'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 校验失败，在页面显示错误信息</span></span><br><span class="line">    print(<span class="number">111</span>)</span><br><span class="line">    print(form.errors)<span class="comment">#form里面封装了每一个错误信息</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user_model_form_add.html'</span>, &#123;<span class="string">'form'</span>: form&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>user_model_form_add.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">novalidate</span>&gt;</span><span class="comment">&lt;!--取消浏览器的校验--&gt;</span></span><br><span class="line">    &#123;% raw %&#125; &#123;% csrf_token %&#125;</span><br><span class="line">    &#123;% for field in form %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="comment">&lt;!--中文名称(verbose_name)--&gt;</span></span><br><span class="line">            &#123;&#123; field &#125;&#125;<span class="comment">&lt;!--输入框--&gt;</span></span><br><span class="line">            &#123;#<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"姓名"</span> <span class="attr">name</span>=<span class="string">"user"</span>/&gt;</span>#&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red;"</span>&gt;</span>&#123;&#123; field.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="comment">&lt;!--只显示第一个错误--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;&#123;% endraw %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>settings.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">'zh-hans'</span><span class="comment">#语言改为中文</span></span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h4 id="9-8-7编辑用户">
          <a href="#9-8-7编辑用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-7编辑用户" class="headerlink" title="9.8.7编辑用户"></a><strong>9.8.7编辑用户</strong></h4>
      <ul>
<li>知识回顾<ul>
<li>部门管理</li>
<li>用户管理<ul>
<li>用户列表</li>
<li>新建用户<ul>
<li>ModelForm，针对数据库中的某个表</li>
<li>Form</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>点击编辑，跳转到编辑页面（将编辑行的ID携带过去）</li>
<li>编辑页面（默认数据，根据ID获取并设置到页面中）</li>
<li>提交：<ul>
<li>错误提示</li>
<li>数据校验</li>
<li>数据库更新  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">models.UserInfo.filter(id=<span class="number">4</span>).update(...)</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'user/&lt;int:nid&gt;/edit'</span>, views.user_edit),<span class="comment">#用户中间传一个id</span></span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑用户</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_edit</span><span class="params">(request, nid)</span>:</span></span><br><span class="line">    row_object = models.UserInfo.objects.filter(id=nid).first()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:  <span class="comment"># 让用户看到数据</span></span><br><span class="line">        <span class="comment"># 根据id去数据库获取要编辑的那一行数据(对象)</span></span><br><span class="line">        form = UserModelForm(instance=row_object)  <span class="comment"># instance默认会将默认值显示出来</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'user_edit.html'</span>, &#123;<span class="string">'form'</span>: form&#125;)</span><br><span class="line">    <span class="comment">#如果是POST请求，则对数据进行校验</span></span><br><span class="line">    form=UserModelForm(data=request.POST,instance=row_object)<span class="comment">#更新数据</span></span><br><span class="line">    <span class="keyword">if</span> form.is_valid():</span><br><span class="line">        <span class="comment">#默认保存的是用户输入的所有数据</span></span><br><span class="line">        <span class="comment">#如果想要在用户输入以外增加一些值</span></span><br><span class="line">        <span class="comment">#form.instance.字段名=值</span></span><br><span class="line">        form.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/user/list'</span>)</span><br><span class="line">    <span class="comment">#若校验不合法</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'user_edit.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>user_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"/user/&#123;&#123; obj.id &#125;&#125;/edit"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>user_edit.html<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 复制user_model_form_add.html代码，并将新建用户改为编辑用户 --&gt;</span></span><br><span class="line">&#123;% raw %&#125;&#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 编辑用户 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span><span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">novalidate</span>&gt;</span><span class="comment">&lt;!--取消浏览器的校验--&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    &#123;% for field in form %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="comment">&lt;!--中文名称(verbose_name)--&gt;</span></span><br><span class="line">                            &#123;&#123; field &#125;&#125;<span class="comment">&lt;!--输入框--&gt;</span></span><br><span class="line">                            &#123;#<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"姓名"</span> <span class="attr">name</span>=<span class="string">"user"</span>/&gt;</span>#&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red;"</span>&gt;</span>&#123;&#123; field.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="comment">&lt;!--只显示第一个错误--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125; &#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>前端页面入职时间显示年月日时分秒，修改数据库如下<ul>
<li>models.py<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#create_time=models.DateTimeField(verbose_name='入职时间')</span></span><br><span class="line">create_time = models.DateField(verbose_name=<span class="string">'入职时间'</span>)<span class="comment">#datafield只包含年月日</span></span><br></pre></td></tr></table></div></figure></li>
<li>修改数据库，需要执行(pycharm-工具-Run manage.py Task…)  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></div></figure>

</li>
</ul>
</li>
</ul>

        <h4 id="9-8-8删除用户">
          <a href="#9-8-8删除用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-8-8删除用户" class="headerlink" title="9.8.8删除用户"></a><strong>9.8.8删除用户</strong></h4>
      <ul>
<li>user_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"/user/&#123;&#123; obj.id &#125;&#125;/delete"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'user/&lt;int:nid&gt;/delete'</span>, views.user_delete),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除用户</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_delete</span><span class="params">(request,nid)</span>:</span></span><br><span class="line">    models.UserInfo.objects.filter(id=nid).delete()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/user/list'</span>)</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h2 id="10-靓号管理">
          <a href="#10-靓号管理" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-靓号管理" class="headerlink" title="10.靓号管理"></a><strong>10.靓号管理</strong></h2>
      
        <h3 id="10-1表结构">
          <a href="#10-1表结构" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-1表结构" class="headerlink" title="10.1表结构"></a><strong>10.1表结构</strong></h3>
      <p><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/table_stru.png" alt></p>
<ul>
<li>根据表结构的需求，在models.py中创建类（由类生成数据库中的表）  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 靓号表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrettyNum</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    mobile = models.CharField(verbose_name=<span class="string">'手机号'</span>, max_length=<span class="number">32</span>)  <span class="comment"># charfield必须要设置最大长度，否则会报错</span></span><br><span class="line">    <span class="comment">#想要允许为空，则在参数中加null=True,blank=True</span></span><br><span class="line">    price = models.IntegerField(verbose_name=<span class="string">'价格'</span>,default=<span class="number">0</span>,null=<span class="literal">True</span>,blank=<span class="literal">True</span>)  <span class="comment"># 整型不用加最大长度</span></span><br><span class="line">    level_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'1级'</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">'2级'</span>),</span><br><span class="line">        (<span class="number">3</span>, <span class="string">'3级'</span>),</span><br><span class="line">        (<span class="number">4</span>, <span class="string">'4级'</span>),</span><br><span class="line">    )</span><br><span class="line">    level = models.SmallIntegerField(verbose_name=<span class="string">'级别'</span>, choices=level_choices,default=<span class="number">1</span>)<span class="comment">#default没选择时默认为1，可以不写</span></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'已占用'</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">'未使用'</span>),</span><br><span class="line">    )</span><br><span class="line">    status = models.SmallIntegerField(verbose_name=<span class="string">'状态'</span>, choices=status_choices,default=<span class="number">2</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>tools-Run manage.py Task  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></div></figure></li>
<li>自己在数据库模拟创建一些数据<ul>
<li>登录数据库win+r-cmd  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">use staffing_system;</span><br><span class="line">show tables;</span><br><span class="line">insert into website_prettynum(mobile,price,level,status)values(&#39;111111111&#39;,19,1,1);</span><br><span class="line">select *from website_prettynum;</span><br><span class="line"></span><br><span class="line">mysql&gt; select *from website_prettynum;</span><br><span class="line">+----+-----------+-------+-------+--------+</span><br><span class="line">| id | mobile    | price | level | status |</span><br><span class="line">+----+-----------+-------+-------+--------+</span><br><span class="line">|  1 | 111111111 |    19 |     1 |      1 |</span><br><span class="line">|  2 | 111111111 |    19 |     1 |      1 |</span><br><span class="line">|  3 | 111111111 |    19 |     1 |      1 |</span><br><span class="line">|  4 | 111111111 |    19 |     1 |      1 |</span><br><span class="line">+----+-----------+-------+-------+--------+</span><br></pre></td></tr></table></div></figure>

</li>
</ul>
</li>
</ul>

        <h3 id="10-2靓号列表">
          <a href="#10-2靓号列表" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-2靓号列表" class="headerlink" title="10.2靓号列表"></a><strong>10.2靓号列表</strong></h3>
      <ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'pretty/list'</span>,views.pretty_list),</span><br></pre></td></tr></table></div></figure></li>
<li>函数<ul>
<li>获取所有的靓号</li>
<li>结合html+render将靓号罗列出来<br>  id 号码 价格 级别（中文） 状态（中文）</li>
</ul>
</li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#靓号列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#select *from 表 order by id asc;</span></span><br><span class="line">    queryset=models.PrettyNum.objects.all().order_by(<span class="string">'-level'</span>)<span class="comment">#获取全部靓号,level为按照level升序asc,-level为降序desc</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'pretty_list.html'</span>,&#123;<span class="string">'queryset'</span>:queryset&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>pretty_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 复制user_list.html代码并修改 --&gt;</span></span><br><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-bottom:10px "</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus-sign"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                新建靓号</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Default panel contents --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-th-list"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                靓号列表</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Table --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-bordered"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>号码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>级别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;% for obj in queryset %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; obj.id &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.mobile &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.price &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.get_level_display &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.get_status_display &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>layout.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导航条中加入靓号管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/pretty/list"</span>&gt;</span>靓号管理<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="10-3新建靓号">
          <a href="#10-3新建靓号" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-3新建靓号" class="headerlink" title="10.3新建靓号"></a><strong>10.3新建靓号</strong></h3>
      <ul>
<li>列表页面点击跳转：’/pretty/add’</li>
<li>url</li>
<li>ModelForm类  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrettyModelForm</span><span class="params">(forms.ModelForm)</span></span></span><br><span class="line"><span class="class">    ...</span></span><br></pre></td></tr></table></div></figure></li>
<li>函数<ul>
<li>实例化类的对象</li>
<li>通过render将对象传入到HTML中</li>
<li>模板循环展示所有的字段</li>
</ul>
</li>
<li>点击提交<ul>
<li>数据校验</li>
<li>保存到数据库</li>
<li>跳转回靓号列表</li>
</ul>
</li>
<li>pretty_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/pretty/add"</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'pretty/add'</span>, views.pretty_add),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator<span class="comment">#validators里面可以写正则表达式</span></span><br><span class="line">    <span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PrettyModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">        <span class="comment">#验证 方式一：字段+正则</span></span><br><span class="line">        <span class="comment"># mobile=forms.CharField(</span></span><br><span class="line">        <span class="comment">#     label='手机号',</span></span><br><span class="line">        <span class="comment">#     validators=[RegexValidator(r'^1[3-9]\d&#123;9&#125;$','手机号格式错误')],#添加正则表达式判断</span></span><br><span class="line">        <span class="comment"># )</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            model=models.PrettyNum</span><br><span class="line">            fields=[<span class="string">'mobile'</span>,<span class="string">'price'</span>,<span class="string">'level'</span>,<span class="string">'status'</span>]<span class="comment">#自定义的字段</span></span><br><span class="line">            <span class="comment">#fields="__all__"#所有字段</span></span><br><span class="line">            <span class="comment">#exclude=['level']#排除某个字段</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,*args,**kwargs)</span>:</span><span class="comment">#添加bootstrap样式</span></span><br><span class="line">            super().__init__(*args,**kwargs)</span><br><span class="line">            <span class="keyword">for</span> name,field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">                field.widget.attrs=&#123;<span class="string">'class'</span>:<span class="string">'form-control'</span>,<span class="string">'placeholder'</span>:field.label&#125;</span><br><span class="line">        <span class="comment">#验证 方式二:验证mobile字段（钩子方法）clean_字段名</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">clean_mobile</span><span class="params">(self)</span>:</span></span><br><span class="line">            txt_mobile=self.cleaned_data[<span class="string">'mobile'</span>]<span class="comment">#用户传入的数据</span></span><br><span class="line">            <span class="keyword">if</span> len(txt_mobile)!=<span class="number">11</span>:</span><br><span class="line">                <span class="comment">#验证不通过</span></span><br><span class="line">                <span class="keyword">raise</span> ValidationError(<span class="string">"格式错误"</span>)<span class="comment">#错误信息</span></span><br><span class="line">            <span class="comment">#验证通过，则返回用户输入的值</span></span><br><span class="line">            <span class="keyword">return</span> txt_mobile</span><br><span class="line"></span><br><span class="line">    <span class="comment">#添加靓号</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pretty_add</span><span class="params">(request)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> request.method==<span class="string">"GET"</span>:</span><br><span class="line">            form=PrettyModelForm()</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">'pretty_add.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line">        form=PrettyModelForm(data=request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.save()</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/pretty/list'</span>)</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'pretty_add.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line">    ```    </span><br><span class="line">- pretty_add.html</span><br><span class="line">    ```html</span><br><span class="line">    &lt;!-- 复制user_Model_form_add.html并加以修改 --&gt;</span><br><span class="line">    &#123;% raw %&#125; &#123;% extends <span class="string">'layout.html'</span> %&#125;</span><br><span class="line">    &#123;% block content %&#125;</span><br><span class="line">        &lt;div class="container"&gt;</span><br><span class="line">            &lt;div class="panel panel-default"&gt;</span><br><span class="line">                &lt;div class="panel-heading"&gt;</span><br><span class="line">                    &lt;h3 class="panel-title"&gt; 新建靓号 &lt;/h3&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class="panel-body"&gt;&lt;!--表单--&gt;</span><br><span class="line">                    &lt;form method=<span class="string">"post"</span> novalidate&gt;</span><br><span class="line">                        &#123;% csrf_token %&#125;</span><br><span class="line">                        &#123;% <span class="keyword">for</span> field <span class="keyword">in</span> form %&#125;</span><br><span class="line">                            &lt;div class="form-group"&gt;</span><br><span class="line">                                &lt;label&gt;&#123;&#123; field.label &#125;&#125;&lt;/label&gt;</span><br><span class="line">                                &#123;&#123; field &#125;&#125;</span><br><span class="line">                                &lt;span style="color: red"&gt;&#123;&#123; field.errors.0 &#125;&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &#123;% endfor %&#125;</span><br><span class="line">                        &lt;button type="submit" class="btn btn-primary"&gt;提 交&lt;/button&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="10-4编辑和删除靓号">
          <a href="#10-4编辑和删除靓号" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-4编辑和删除靓号" class="headerlink" title="10.4编辑和删除靓号"></a><strong>10.4编辑和删除靓号</strong></h3>
      
        <h4 id="10-4-1编辑靓号">
          <a href="#10-4-1编辑靓号" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-4-1编辑靓号" class="headerlink" title="10.4.1编辑靓号"></a><strong>10.4.1编辑靓号</strong></h4>
      <ul>
<li>列表页面：/pretty/数字/edit</li>
<li>URL</li>
<li>函数<ul>
<li>根据ID获取当前编辑的对象</li>
<li>ModelForm配合，默认显示数据</li>
<li>提交修改</li>
</ul>
</li>
<li>不允许手机号重复<ul>
<li>添加：【正则表达式校验】【手机号不能重复】  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[obj,obj,obj]</span></span><br><span class="line">queryset=moile.PrettyNum.objects.filter(mobile=<span class="string">'18888888888'</span>)</span><br><span class="line"></span><br><span class="line">obj=moile.PrettyNum.objects.filter(mobile=<span class="string">'18888888888'</span>).first()</span><br><span class="line"></span><br><span class="line"><span class="comment">#True/False判断是否存在</span></span><br><span class="line">obj=moile.PrettyNum.objects.filter(mobile=<span class="string">'18888888888'</span>).exists()</span><br></pre></td></tr></table></div></figure></li>
<li>编辑：【正则表达式校验】  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#排除自己以外，其他的数据是否手机号重复？</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#id!=2 and mobile='18888888888'</span></span><br><span class="line">moile.PrettyNum.objects.filter(mobile=<span class="string">'18888888888'</span>).exclude(id=<span class="number">2</span>)</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>pretty_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"/pretty/&#123;&#123; obj.id &#125;&#125;/edit"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'pretty/&lt;int:nid&gt;/edit'</span>, views.pretty_edit),</span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrettyEditModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="comment">#mobile=forms.CharField(disabled=True,label='手机号')#不允许编辑手机号</span></span><br><span class="line">    <span class="comment"># mobile=forms.CharField(</span></span><br><span class="line">    <span class="comment">#     label='手机号',</span></span><br><span class="line">    <span class="comment">#     validators=[RegexValidator(r'^1[3-9]\d&#123;9&#125;$','手机号格式错误')],#添加正则表达式判断</span></span><br><span class="line">    <span class="comment"># )</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model=models.PrettyNum</span><br><span class="line">        fields=[<span class="string">'mobile'</span>,<span class="string">'price'</span>,<span class="string">'level'</span>,<span class="string">'status'</span>]</span><br><span class="line">        <span class="comment">#fields=['price','level','status']#不允许修改手机号，也可直接去掉该字段</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,*args,**kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args,**kwargs)</span><br><span class="line">        <span class="keyword">for</span> name,field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">            field.widget.attrs=&#123;<span class="string">'class'</span>:<span class="string">'form-control'</span>,<span class="string">'placeholder'</span>:field.label&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_mobile</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#当前编辑的那一行的ID</span></span><br><span class="line">        print(self.instance.pk)</span><br><span class="line">        txt_mobile=self.cleaned_data[<span class="string">'mobile'</span>]<span class="comment">#用户传入的数据</span></span><br><span class="line">        exists=models.PrettyNum.objects.exclude(id=self.instance.pk).filter(mobile=txt_mobile).exists()</span><br><span class="line">        <span class="keyword">if</span> exists:</span><br><span class="line">            <span class="comment">#验证不通过</span></span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">"手机号已存在"</span>)<span class="comment">#错误信息</span></span><br><span class="line">        <span class="comment">#验证通过，则返回用户输入的值</span></span><br><span class="line">        <span class="keyword">return</span> txt_mobile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑靓号</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty_edit</span><span class="params">(request,nid)</span>:</span></span><br><span class="line">    row_object=models.PrettyNum.objects.filter(id=nid).first()</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">"GET"</span>:</span><br><span class="line">        form=PrettyEditModelForm(instance=row_object)</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'pretty_edit.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line"></span><br><span class="line">    form=PrettyEditModelForm(data=request.POST,instance=row_object)</span><br><span class="line">    <span class="keyword">if</span> form.is_valid():</span><br><span class="line">        form.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/pretty/list'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'pretty_edit.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>pretty_edit.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 复制user_edit.html代码并修改 --&gt;</span></span><br><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> 编辑靓号 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    &#123;% for field in form %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            &#123;&#123; field &#125;&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; field.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">" btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h4 id="10-4-2删除靓号">
          <a href="#10-4-2删除靓号" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-4-2删除靓号" class="headerlink" title="10.4.2删除靓号"></a><strong>10.4.2删除靓号</strong></h4>
      <ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'pretty/&lt;int:nid&gt;/delete'</span>,views.pretty_delete),</span><br></pre></td></tr></table></div></figure></li>
<li>pretty_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"/pretty/&#123;&#123; obj.id &#125;&#125;/delete"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除靓号</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty_delete</span><span class="params">(request,nid)</span>:</span></span><br><span class="line">    models.PrettyNum.objects.filter(id=nid).delete()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/pretty/list'</span>)</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="10-5搜索手机号">
          <a href="#10-5搜索手机号" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-5搜索手机号" class="headerlink" title="10.5搜索手机号"></a><strong>10.5搜索手机号</strong></h3>
      <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">models.PrettyNum.objects.filter(mobile=<span class="string">'19999999999'</span>,id=<span class="number">12</span>)</span><br><span class="line"><span class="comment">#filter也支持字典</span></span><br><span class="line">data_dict=&#123;<span class="string">'mobile'</span>:<span class="string">'19999999999'</span>,<span class="string">'id'</span>:<span class="number">123</span>&#125;</span><br><span class="line">models.PrettyNum.objects.filter(**data_dict)</span><br></pre></td></tr></table></div></figure>
<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">models.PrettyNum.objects.filter(id=<span class="number">12</span>)<span class="comment">#等于12</span></span><br><span class="line">models.PrettyNum.objects.filter(id__gt=<span class="number">12</span>)<span class="comment">#大于12</span></span><br><span class="line">models.PrettyNum.objects.filter(id__gte=<span class="number">12</span>)<span class="comment">#大于等于12</span></span><br><span class="line">models.PrettyNum.objects.filter(id__lt=<span class="number">12</span>)<span class="comment">#小于12</span></span><br><span class="line">models.PrettyNum.objects.filter(id__lte=<span class="number">12</span>)<span class="comment">#小于等于12</span></span><br><span class="line"><span class="comment">#字典</span></span><br><span class="line">data_dict=&#123;<span class="string">'id__lte'</span>:<span class="number">12</span>&#125;</span><br><span class="line">models.PrettyNum.objects.filter(**data_dict)</span><br></pre></td></tr></table></div></figure>
<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">models.PrettyNum.objects.filter(mobile=<span class="string">'1999'</span>)<span class="comment">#等于1999的</span></span><br><span class="line">models.PrettyNum.objects.filter(mobile__startswith=<span class="string">'1999'</span>)<span class="comment">#筛选出以1999开头</span></span><br><span class="line">models.PrettyNum.objects.filter(mobile__endswith=<span class="string">'999'</span>)<span class="comment">#筛选出以999结尾</span></span><br><span class="line">models.PrettyNum.objects.filter(mobile__contains=<span class="string">'999'</span>)<span class="comment">#筛选出包含999的</span></span><br><span class="line"><span class="comment">#字典</span></span><br><span class="line">data_dict=&#123;<span class="string">'mobile__contains'</span>:<span class="string">'999'</span>&#125;</span><br><span class="line">models.PrettyNum.objects.filter(**data_dict)</span><br></pre></td></tr></table></div></figure>
<ul>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#靓号列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    data_dict=&#123;&#125;</span><br><span class="line">    search_data=request.GET.get(<span class="string">'q'</span>,<span class="string">''</span>)<span class="comment">#有值的话拿值，没值的话拿空字符串</span></span><br><span class="line">    <span class="keyword">if</span> search_data:</span><br><span class="line">        <span class="comment">#&lt;QuerySet [&lt;PrettyNum: PrettyNum object (5)&gt;, &lt;PrettyNum: PrettyNum object (7)&gt;]&gt;</span></span><br><span class="line">        data_dict[<span class="string">'mobile__contains'</span>]=search_data</span><br><span class="line">    res=models.PrettyNum.objects.filter(**data_dict)<span class="comment">#字典为空，则获取所有的</span></span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#&lt;QuerySet [&lt;PrettyNum: PrettyNum object (5)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># q1=models.PrettyNum.objects.filter(mobile='19999999999',id=5)</span></span><br><span class="line">    <span class="comment"># print(q1)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># #&lt;QuerySet [&lt;PrettyNum: PrettyNum object (5)&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># data_dict = &#123;'mobile': '19999999999', 'id': 5&#125;</span></span><br><span class="line">    <span class="comment"># q2=models.PrettyNum.objects.filter(**data_dict)</span></span><br><span class="line">    <span class="comment"># print(q2)</span></span><br><span class="line"></span><br><span class="line">    queryset = models.PrettyNum.objects.filter(**data_dict).order_by(<span class="string">'-level'</span>)<span class="comment">#字典为空，则获取所有的，不为空则页面只显示有q的</span></span><br><span class="line">    <span class="comment">#select *from 表 order by id asc;</span></span><br><span class="line">    <span class="comment">#queryset=models.PrettyNum.objects.all().order_by('-level')#获取全部靓号,level为按照level升序asc,-level为降序desc</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'pretty_list.html'</span>,&#123;<span class="string">'queryset'</span>:queryset,<span class="string">'search_data'</span>:search_data&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>pretty_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在bootstrap页面中找输入框表单和放大镜图标并复制其代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"float: right;width:300px;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'q'</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Search for..."</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; search_data &#125;&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-search"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /input-group --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="10-6分页">
          <a href="#10-6分页" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-6分页" class="headerlink" title="10.6分页"></a><strong>10.6分页</strong></h3>
      <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">queryset=models.PrettyNum.objects.all()</span><br><span class="line">queryset=models.PrettyNum.objects.all()[<span class="number">0</span>:<span class="number">10</span>]<span class="comment">#只取前十条</span></span><br><span class="line">queryset=models.PrettyNum.objects.filter(id=<span class="number">1</span>)[<span class="number">0</span>:<span class="number">10</span>]<span class="comment">#只取符合条件的前十条</span></span><br><span class="line"></span><br><span class="line">queryset=models.PrettyNum.objects.all()[<span class="number">0</span>:<span class="number">10</span>]<span class="comment">#第一页</span></span><br><span class="line">queryset=models.PrettyNum.objects.all()[<span class="number">10</span>:<span class="number">20</span>]<span class="comment">#第二页</span></span><br><span class="line">queryset=models.PrettyNum.objects.all()[<span class="number">20</span>:<span class="number">30</span>]<span class="comment">#第三页</span></span><br><span class="line"></span><br><span class="line">data=models.PrettyNum.objects.all.count()<span class="comment">#数据库的总条数</span></span><br><span class="line">data=models.PrettyNum.objects.filter(id=<span class="number">1</span>).count()<span class="comment">#符合条件的有多少条数据</span></span><br></pre></td></tr></table></div></figure>
<ul>
<li>分页的逻辑和处理规则<ul>
<li>views.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty_list</span>:</span></span><br><span class="line">    ...</span><br><span class="line">     <span class="comment"># 根据用户要访问的页码计算出起止位置</span></span><br><span class="line">    page = int(request.GET.get(<span class="string">'page'</span>, <span class="number">1</span>))  <span class="comment"># 获取页码，若没有则默认为1</span></span><br><span class="line">    page_size = <span class="number">10</span><span class="comment">#每页显示十条数据</span></span><br><span class="line">    start = (page - <span class="number">1</span>) * page_size</span><br><span class="line">    end = page * page_size</span><br><span class="line">    total_count= models.PrettyNum.objects.filter(**data_dict).order_by(<span class="string">'-level'</span>).count()<span class="comment">#数据库的总条数</span></span><br><span class="line">    queryset = models.PrettyNum.objects.filter(**data_dict).order_by(<span class="string">'-level'</span>)[start:end]  <span class="comment"># 只取前十条</span></span><br><span class="line">    <span class="comment">#总页码</span></span><br><span class="line">    total_page_count,div=divmod(total_count,page_size)<span class="comment">#divmod(99,10)得到(9,9)</span></span><br><span class="line">    <span class="keyword">if</span> div:</span><br><span class="line">        total_page_count+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#计算出显示当前页的前五页和后五页</span></span><br><span class="line">    plus=<span class="number">5</span></span><br><span class="line">    <span class="keyword">if</span> total_page_count&lt;=<span class="number">2</span>*plus:</span><br><span class="line">        <span class="comment">#数据库中数据较少，没有达到11页</span></span><br><span class="line">        start_page=<span class="number">1</span></span><br><span class="line">        end_page=total_page_count</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#数据库中数据比较多，大于11页</span></span><br><span class="line">        <span class="comment">#当前页小于5时(小极值)</span></span><br><span class="line">        <span class="keyword">if</span> page&lt;=plus:</span><br><span class="line">            start_page=<span class="number">1</span></span><br><span class="line">            end_page=<span class="number">2</span>*plus+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#当前页大于5</span></span><br><span class="line">            <span class="comment">#当前页+5大于总页码</span></span><br><span class="line">            <span class="keyword">if</span> (page+plus)&gt;total_page_count:</span><br><span class="line">                start_page=total_page_count<span class="number">-2</span>*plus</span><br><span class="line">                end_page=total_page_count</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                start_page=page-plus</span><br><span class="line">                end_page=page+plus</span><br><span class="line">    <span class="comment"># 页码</span></span><br><span class="line">    page_str_list=[]</span><br><span class="line">    <span class="comment">#首页</span></span><br><span class="line">    page_str_list.append(<span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;首页&lt;/a&gt;&lt;/li&gt;'</span>.format(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#上一页</span></span><br><span class="line">    <span class="comment">#当前页码大于1才有上一页，否则将其置为第一页</span></span><br><span class="line">    <span class="keyword">if</span> page&gt;<span class="number">1</span>:</span><br><span class="line">        prev= <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;上一页&lt;/a&gt;&lt;/li&gt;'</span>.format(page<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        prev = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;上一页&lt;/a&gt;&lt;/li&gt;'</span>.format(<span class="number">1</span>)</span><br><span class="line">    page_str_list.append(prev)</span><br><span class="line">    <span class="comment">#for i in range(1,total_page_count+1):#循环多少次，前端页面就能看到多少个页码，range前取后不取，所以加一</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(start_page,end_page+<span class="number">1</span>):<span class="comment">#前取后不取，所以加一</span></span><br><span class="line">        <span class="keyword">if</span> i==page:</span><br><span class="line">            ele=<span class="string">'&lt;li class="active"&gt;&lt;a href="?page=&#123;&#125;"&gt;&#123;&#125;&lt;/a&gt;&lt;/li&gt;'</span>.format(i,i)<span class="comment">#给当前页加一个样式</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ele = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;&#123;&#125;&lt;/a&gt;&lt;/li&gt;'</span>.format(i, i)</span><br><span class="line">        page_str_list.append(ele)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 下一页</span></span><br><span class="line">    <span class="comment"># 当前页码小于最大页数则有下一页，否则将其置为最后一页</span></span><br><span class="line">    <span class="keyword">if</span> page &lt;total_page_count:</span><br><span class="line">        prev = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;下一页&lt;/a&gt;&lt;/li&gt;'</span>.format(page + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        prev = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;下一页&lt;/a&gt;&lt;/li&gt;'</span>.format(total_page_count)</span><br><span class="line">    page_str_list.append(prev)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尾页</span></span><br><span class="line">    page_str_list.append(<span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;尾页&lt;/a&gt;&lt;/li&gt;'</span>.format(total_page_count))</span><br><span class="line"></span><br><span class="line">    page_string=mark_safe(<span class="string">''</span>.join(page_str_list))<span class="comment">#make_safe是安全的，加上即可显示页码</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    &lt;li&gt;&lt;a href="?page=1"&gt;1&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li&gt;&lt;a href="?page=2"&gt;2&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li&gt;&lt;a href="?page=3"&gt;3&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li&gt;&lt;a href="?page=4"&gt;4&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li&gt;&lt;a href="/pretty/list?page=5"&gt;5&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></div></figure></li>
<li>pretty_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span></span><br><span class="line">    &#123;&#123; page_string &#125;&#125;</span><br><span class="line">    <span class="comment">&lt;!--&lt;li&gt;&lt;a href="?page=1"&gt;1&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">    &lt;li&gt;&lt;a href="?page=2"&gt;2&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">    &lt;li&gt;&lt;a href="?page=3"&gt;3&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">    &lt;li&gt;&lt;a href="?page=4"&gt;4&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">    &lt;li&gt;&lt;a href="/pretty/list?page=5"&gt;5&lt;/a&gt;&lt;/li&gt;加不加/pretty/list均可--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span> <span class="attr">style</span>=<span class="string">"width: 200px"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"page"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"页码"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>跳转<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>封装分页类<ul>
<li>从头到尾开发<ul>
<li>website目录下新建utils目录，utils目录下新建pagination.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">            <span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Pagination</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, request,queryset,page_size=<span class="number">10</span>, page_param=<span class="string">'page'</span>,plus=<span class="number">5</span>)</span>:</span>  <span class="comment"># 传入一些值</span></span><br><span class="line">                    <span class="string">'''</span></span><br><span class="line"><span class="string">                    :param request: 请求的对象</span></span><br><span class="line"><span class="string">                    :param queryset: 符合条件的数据（根据这个数据给他进行分页处理）</span></span><br><span class="line"><span class="string">                    :param page_size: 每页显示多少条数据</span></span><br><span class="line"><span class="string">                    :param page_param: 在URL中传递的获取分页的参数，例如：/pretty/list?page=2</span></span><br><span class="line"><span class="string">                    :param plus: 显示当前页的 前或后几页（页码）</span></span><br><span class="line"><span class="string">                    '''</span></span><br><span class="line">                    page = request.GET.get(page_param, <span class="string">'1'</span>)</span><br><span class="line">                    <span class="keyword">if</span> page.isdecimal():<span class="comment">#输入如果是中文</span></span><br><span class="line">                        page=int(page)</span><br><span class="line">                    <span class="keyword">else</span>:<span class="comment">#输入如果不是中文则拿到第一页</span></span><br><span class="line">                        page=<span class="number">1</span></span><br><span class="line">                    self.page=page<span class="comment">#获取当前页</span></span><br><span class="line">                    <span class="comment">#print(page,type(page))</span></span><br><span class="line">                    self.page_size=page_size</span><br><span class="line">                    self.start = (page - <span class="number">1</span>) * page_size</span><br><span class="line">                    self.end = page * page_size</span><br><span class="line">                    self.page_queryset=queryset[self.start:self.end]</span><br><span class="line">                    total_count = queryset.count()  <span class="comment"># 数据库的总条数</span></span><br><span class="line">                    total_page_count, div = divmod(total_count, page_size)  <span class="comment"># divmod(99,10)得到(9,9)</span></span><br><span class="line">                    <span class="keyword">if</span> div:</span><br><span class="line">                        total_page_count += <span class="number">1</span></span><br><span class="line">                    self.total_page_count=total_page_count</span><br><span class="line">                    self.plus=plus</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">def</span> <span class="title">html</span><span class="params">(self)</span>:</span></span><br><span class="line">                    <span class="comment"># 计算出显示当前页的前五页和后五页</span></span><br><span class="line">                    <span class="keyword">if</span> self.total_page_count &lt;= <span class="number">2</span> * self.plus+<span class="number">1</span>:</span><br><span class="line">                        <span class="comment"># 数据库中数据较少，没有达到11页</span></span><br><span class="line">                        start_page = <span class="number">1</span></span><br><span class="line">                        end_page = self.total_page_count</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># 数据库中数据比较多，大于11页</span></span><br><span class="line">                        <span class="comment"># 当前页小于5时(小极值)</span></span><br><span class="line">                        <span class="keyword">if</span> self.page &lt;= self.plus:</span><br><span class="line">                            start_page = <span class="number">1</span></span><br><span class="line">                            end_page = <span class="number">2</span> * self.plus + <span class="number">1</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="comment"># 当前页大于5</span></span><br><span class="line">                            <span class="comment"># 当前页+5大于总页码</span></span><br><span class="line">                            <span class="keyword">if</span> (self.page + self.plus) &gt; self.total_page_count:</span><br><span class="line">                                start_page = self.total_page_count - <span class="number">2</span> * self.plus</span><br><span class="line">                                end_page = self.total_page_count</span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                start_page = self.page - self.plus</span><br><span class="line">                                end_page = self.page + self.plus</span><br><span class="line">                    <span class="comment"># 页码</span></span><br><span class="line">                    page_str_list = []</span><br><span class="line">                    <span class="comment"># 首页</span></span><br><span class="line">                    page_str_list.append(<span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;首页&lt;/a&gt;&lt;/li&gt;'</span>.format(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># 上一页</span></span><br><span class="line">                    <span class="comment"># 当前页码大于1才有上一页，否则将其置为第一页</span></span><br><span class="line">                    <span class="keyword">if</span> self.page &gt; <span class="number">1</span>:</span><br><span class="line">                        prev = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;上一页&lt;/a&gt;&lt;/li&gt;'</span>.format(self.page - <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        prev = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;上一页&lt;/a&gt;&lt;/li&gt;'</span>.format(<span class="number">1</span>)</span><br><span class="line">                    page_str_list.append(prev)</span><br><span class="line">                    <span class="comment"># for i in range(1,total_page_count+1):#循环多少次，前端页面就能看到多少个页码，range前取后不取，所以加一</span></span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(start_page, end_page + <span class="number">1</span>):  <span class="comment"># 前取后不取，所以加一</span></span><br><span class="line">                        <span class="keyword">if</span> i == self.page:</span><br><span class="line">                            ele = <span class="string">'&lt;li class="active"&gt;&lt;a href="?page=&#123;&#125;"&gt;&#123;&#125;&lt;/a&gt;&lt;/li&gt;'</span>.format(i, i)  <span class="comment"># 给当前页加一个样式</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            ele = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;&#123;&#125;&lt;/a&gt;&lt;/li&gt;'</span>.format(i, i)</span><br><span class="line">                        page_str_list.append(ele)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># 下一页</span></span><br><span class="line">                    <span class="comment"># 当前页码小于最大页数则有下一页，否则将其置为最后一页</span></span><br><span class="line">                    <span class="keyword">if</span> self.page &lt; self.total_page_count:</span><br><span class="line">                        prev = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;下一页&lt;/a&gt;&lt;/li&gt;'</span>.format(self.page + <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        prev = <span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;下一页&lt;/a&gt;&lt;/li&gt;'</span>.format(self.total_page_count)</span><br><span class="line">                    page_str_list.append(prev)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># 尾页</span></span><br><span class="line">                    page_str_list.append(<span class="string">'&lt;li&gt;&lt;a href="?page=&#123;&#125;"&gt;尾页&lt;/a&gt;&lt;/li&gt;'</span>.format(self.total_page_count))</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># 跳转页面</span></span><br><span class="line">                    search_string = <span class="string">"""</span></span><br><span class="line"><span class="string">                            &lt;li&gt;</span></span><br><span class="line"><span class="string">                                &lt;form style="float: left;margin-left: 1px" method="get"&gt;</span></span><br><span class="line"><span class="string">                                    &lt;input name="page"</span></span><br><span class="line"><span class="string">                                        style="position: relative;float: left;display: inline-block;width:80px;border-radius: 0 "</span></span><br><span class="line"><span class="string">                                        type="text" class="form-control" placeholder="页码"&gt;</span></span><br><span class="line"><span class="string">                                    &lt;button style="border-radius: 0" class="btn btn-default" type="submit"&gt;跳转&lt;/button&gt;</span></span><br><span class="line"><span class="string">                                &lt;/form&gt;</span></span><br><span class="line"><span class="string">                            &lt;/li&gt;</span></span><br><span class="line"><span class="string">                            """</span></span><br><span class="line">                    page_str_list.append(search_string)</span><br><span class="line"></span><br><span class="line">                    page_string = mark_safe(<span class="string">''</span>.join(page_str_list))  <span class="comment"># make_safe是安全的，加上即可显示页码</span></span><br><span class="line">                    <span class="keyword">return</span> page_string</span><br><span class="line">            ``` </span><br><span class="line">    - 写项目用【pagination.py】公共组件</span><br><span class="line">- 小Bug，搜索+分页情况下</span><br><span class="line">    - 点击分页时，保留原来的搜索条件，但点击跳转无法保留搜索条件</span><br><span class="line">        ```shell</span><br><span class="line">        http://127.0.0.1:8000/pretty/list?q=888</span><br><span class="line">        http://127.0.0.1:8000/pretty/list?page=1</span><br><span class="line"></span><br><span class="line">        http://127.0.0.1:8000/pretty/list?q=888&amp;page=23</span><br><span class="line"></span><br><span class="line">        html中输入http://127.0.0.1:8000/pretty/list?page=20&amp;xx=123</span><br><span class="line">        print(request.GET)</span><br><span class="line">        print(request.GET.urlencode())</span><br><span class="line">        输出：</span><br><span class="line">        &lt;QueryDict: &#123;<span class="string">'page'</span>: [<span class="string">'20'</span>], <span class="string">'xx'</span>: [<span class="string">'123'</span>]&#125;&gt;</span><br><span class="line">        page=<span class="number">20</span>&amp;xx=<span class="number">123</span></span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
</ul>
</li>
<li>pagination.py使用方法  <figure class="highlight"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">自定义的分页组件</span><br><span class="line">以后如果想用这个分页组件，需要做如下几件事：</span><br><span class="line"><span class="number">1.</span>在视图函数中导入</span><br><span class="line"><span class="keyword">from</span> website.utils.pagination <span class="keyword">import</span> Pagination</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>在视图函数中：</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#1.用户根据自己的情况去筛选自己的数据</span></span><br><span class="line">    queryset = models.PrettyNum.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#2.实例化分页对象</span></span><br><span class="line">    page_object=Pagination(request,queryset)<span class="comment">#可加入page_size=2修改页面显示条目数</span></span><br><span class="line"></span><br><span class="line">    context=&#123;</span><br><span class="line">        <span class="string">'queryset'</span>:page_object.page_queryset,<span class="comment">#分完页的数据</span></span><br><span class="line">        <span class="string">'page_string'</span>:page_object.html()<span class="comment">#生成页码</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'pretty_list.html'</span>,context)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>在HTML页面中：</span><br><span class="line">&#123;% raw %&#125; &#123;% <span class="keyword">for</span> obj <span class="keyword">in</span> queryset %&#125;</span><br><span class="line">    &#123;&#123;obj.xx&#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;&#123;% endraw %&#125;</span><br><span class="line"></span><br><span class="line">&lt;ul class="pagination"&gt;</span><br><span class="line">    &#123;&#123; page_string &#125;&#125;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h2 id="11-时间插件">
          <a href="#11-时间插件" class="heading-link"><i class="fas fa-link"></i></a><a href="#11-时间插件" class="headerlink" title="11.时间插件"></a><strong>11.时间插件</strong></h2>
      <ul>
<li>下载<span class="exturl"><a class="exturl__link" href="https://uxsolutions.github.io/bootstrap-datepicker/?markup=input&format=&weekStart=&startDate=&endDate=&startView=0&minViewMode=0&maxViewMode=4&todayBtn=false&clearBtn=false&language=en&orientation=auto&multidate=&multidateSeparator=&keyboardNavigation=on&forceParse=on#sandbox" target="_blank" rel="noopener">bootstrap-datapicker</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，并放入static/plugins目录下  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入css --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"static/plugins/bootstrap-3.4.1-dist/css/bootstrap.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"static/plugins/bootstrap-datepicker-1.9.0-dist/css/bootstrap-datepicker.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"dt"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"入职日期"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 引入js,放在jquery和bootstrap的js后面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/js/jquery-3.3.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/plugins/bootstrap-3.4.1-dist/js/bootstrap.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/plugins/bootstrap-datepicker-1.9.0-dist/js/bootstrap-datepicker.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"static/plugins/bootstrap-datepicker-1.9.0-dist/locales/bootstrap-datepicker.zh-CN.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#dt'</span>).datepicker(&#123;</span></span><br><span class="line"><span class="actionscript">            format:<span class="string">'yyyy-mm-dd'</span>,</span></span><br><span class="line"><span class="actionscript">            startDate:<span class="string">'0'</span>,</span></span><br><span class="line">            language:"zh-CN',</span><br><span class="line"><span class="actionscript">            autoclose:<span class="literal">true</span></span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure>
<ul>
<li>layout.html<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% raw %&#125;&#123;% block css %&#125;&#123;% endblock %&#125;</span><br><span class="line">&#123;% block js %&#125;&#123;% endblock %&#125; &#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>
</li>
</ul>

        <h2 id="12-ModelForm和Bootstrap">
          <a href="#12-ModelForm和Bootstrap" class="heading-link"><i class="fas fa-link"></i></a><a href="#12-ModelForm和Bootstrap" class="headerlink" title="12.ModelForm和Bootstrap"></a><strong>12.ModelForm和Bootstrap</strong></h2>
      <ul>
<li>ModelForm可以帮助我们生成HTML标签，但无法生成bootstrap样式  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">name = forms.CharField(min_length=<span class="number">3</span>, label=<span class="string">"用户名"</span>)  <span class="comment"># 验证规则可以有很多</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model = models.UserInfo</span><br><span class="line">    fields = [<span class="string">'name'</span>, <span class="string">'password'</span>]</span><br><span class="line">form=UserModelForm()</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 普通的input框 --&gt;</span></span><br><span class="line">&#123;&#123;form.name&#125;&#125;</span><br><span class="line">&#123;&#123;form.password&#125;&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>定义插件  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">name = forms.CharField(min_length=<span class="number">3</span>, label=<span class="string">"用户名"</span>)  <span class="comment"># 验证规则可以有很多</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model = models.UserInfo</span><br><span class="line">    fields = [<span class="string">'name'</span>, <span class="string">'password'</span>]</span><br><span class="line">    widgets=&#123;</span><br><span class="line">        <span class="string">"name"</span>:forms.TextInput(attrs=&#123;<span class="string">"class"</span>:<span class="string">"form-control"</span>&#125;)<span class="comment">#页面显示的输入框用input标签，并使用class样式</span></span><br><span class="line">        <span class="string">"password"</span>: forms.PasswordInput(attrs=&#123;<span class="string">"class"</span>: <span class="string">"form-control"</span>&#125;)</span><br><span class="line">        <span class="string">"age"</span>: forms.TextInput(attrs=&#123;<span class="string">"class"</span>: <span class="string">"form-control"</span>&#125;)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">name = forms.CharField(</span><br><span class="line">    min_length=<span class="number">3</span>, </span><br><span class="line">    label=<span class="string">"用户名"</span>,</span><br><span class="line">    widget=form.TextInput(attrs=&#123;<span class="string">"class"</span>:<span class="string">"form-control"</span>&#125;)</span><br><span class="line">)  <span class="comment"># 验证规则可以有很多</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model = models.UserInfo</span><br><span class="line">    fields = [<span class="string">'name'</span>, <span class="string">'password'</span>]</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 可得到bootstrap的input框 --&gt;</span></span><br><span class="line">&#123;&#123;form.name&#125;&#125;</span><br><span class="line">&#123;&#123;form.password&#125;&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>重新定义的init方法，批量设置  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.UserInfo</span><br><span class="line">        fields = [<span class="string">'name'</span>, <span class="string">'password'</span>, <span class="string">'age'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment">#循环ModelForm中的所有字段，给每个字段的插件设置attrs</span></span><br><span class="line">        <span class="keyword">for</span> name, field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">            field.widget.attrs = &#123;</span><br><span class="line">                <span class="string">"class"</span>: <span class="string">"form-control"</span>, </span><br><span class="line">                <span class="string">"placeholder"</span>: field.label</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#优化</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.UserInfo</span><br><span class="line">        fields = [<span class="string">'name'</span>, <span class="string">'password'</span>, <span class="string">'age'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment">#循环ModelForm中的所有字段，给每个字段的插件设置attrs</span></span><br><span class="line">        <span class="keyword">for</span> name, field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">            <span class="comment">#字段中有属性，保留原来的属性，没有属性才增加</span></span><br><span class="line">            <span class="keyword">if</span> field.widget.attrs:</span><br><span class="line">                field.widget.attrs[<span class="string">"class"</span>]=<span class="string">"form-control"</span></span><br><span class="line">                field.widget.attrs[<span class="string">"placeholder"</span>]=field.label</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                field.widget.attrs = &#123;</span><br><span class="line">                    <span class="string">"class"</span>: <span class="string">"form-control"</span>, </span><br><span class="line">                    <span class="string">"placeholder"</span>: field.label</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></div></figure></li>
<li>自定义类  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BootstrapModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment">#循环ModelForm中的所有字段，给每个字段的插件设置attrs</span></span><br><span class="line">        <span class="keyword">for</span> name, field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">            <span class="comment">#字段中有属性，保留原来的属性，没有属性才增加</span></span><br><span class="line">            <span class="keyword">if</span> field.widget.attrs:</span><br><span class="line">                field.widget.attrs[<span class="string">"class"</span>]=<span class="string">"form-control"</span></span><br><span class="line">                field.widget.attrs[<span class="string">"placeholder"</span>]=field.label</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                field.widget.attrs = &#123;</span><br><span class="line">                    <span class="string">"class"</span>: <span class="string">"form-control"</span>, </span><br><span class="line">                    <span class="string">"placeholder"</span>: field.label</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></div></figure>
  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#继承BootstrapModelForm的功能</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserModelForm</span><span class="params">(BootstrapModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.UserInfo</span><br><span class="line">        fields = [<span class="string">'name'</span>, <span class="string">'password'</span>, <span class="string">'age'</span>]</span><br></pre></td></tr></table></div></figure></li>
<li>若form文件过多，可在website目录下新建form目录；若较少，则可在utils中新建form.py,并将class类放在其中。</li>
<li>可在website目录下新建view目录用于根据业务划分，存放函数，并将默认的views.py删掉。并修改urls.py中的路径。  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> website.views <span class="keyword">import</span> depart,user,pretty</span><br><span class="line"><span class="comment">#例如：将views.depart_list改为depart.depart_list</span></span><br><span class="line"><span class="comment"># 部门管理</span></span><br><span class="line">path(<span class="string">'depart/list'</span>, depart.depart_list),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户管理</span></span><br><span class="line">path(<span class="string">'user/list'</span>, user.user_list),</span><br><span class="line"></span><br><span class="line"><span class="comment">#靓号管理</span></span><br><span class="line">path(<span class="string">'pretty/list'</span>, pretty.pretty_list),</span><br></pre></td></tr></table></div></figure></li>
<li>【models.py不可以拆】  </li>
</ul>

        <h2 id="13-管理员操作">
          <a href="#13-管理员操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#13-管理员操作" class="headerlink" title="13.管理员操作"></a><strong>13.管理员操作</strong></h2>
      <ul>
<li>表结构<br><img src="/2022/04/15/django%E6%95%99%E7%A8%8B/table_admin_stru.png" alt>  </li>
</ul>

        <h3 id="13-1管理员列表">
          <a href="#13-1管理员列表" class="heading-link"><i class="fas fa-link"></i></a><a href="#13-1管理员列表" class="headerlink" title="13.1管理员列表"></a><strong>13.1管理员列表</strong></h3>
      <ul>
<li>models.py【创建管理员表】  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">'''管理员'''</span></span><br><span class="line">    username=models.CharField(verbose_name=<span class="string">'用户名'</span>,max_length=<span class="number">32</span>)</span><br><span class="line">    password=models.CharField(verbose_name=<span class="string">'密码'</span>,max_length=<span class="number">64</span>)</span><br></pre></td></tr></table></div></figure></li>
<li>tool-run manage.py task…  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></div></figure></li>
<li>此时，数据库中已有该表<ul>
<li>cmd操作：  <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p#输入密码，进入数据库</span><br><span class="line">show databases;#查看所有数据库       </span><br><span class="line">use staffing_system;#选择数据库</span><br><span class="line">show tables;#查看该数据库中所有的表</span><br><span class="line">desc website_admin;#查看数据库中某个表</span><br><span class="line">insert into website_admin(username,password) values('wupeiqi','123');</span><br><span class="line">select * from website_admin;#查看表内容</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>layout.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/admin/list"</span>&gt;</span>管理员账户<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>views目录下新建admin.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> website <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> website.utils.pagination <span class="keyword">import</span> Pagination</span><br><span class="line"></span><br><span class="line"><span class="comment">#管理员列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment">#构造搜索条件</span></span><br><span class="line">    data_dict = &#123;&#125;</span><br><span class="line">    search_data = request.GET.get(<span class="string">'q'</span>, <span class="string">''</span>)  <span class="comment"># 有值的话拿值，没值的话拿空字符串</span></span><br><span class="line">    <span class="keyword">if</span> search_data:</span><br><span class="line">        data_dict[<span class="string">'username__contains'</span>] = search_data</span><br><span class="line"></span><br><span class="line">    <span class="comment">#根据搜索条件去数据库获取</span></span><br><span class="line">    queryset=models.Admin.objects.filter(**data_dict)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#分页</span></span><br><span class="line">    page_object=Pagination(request,queryset)</span><br><span class="line">    context=&#123;</span><br><span class="line">        <span class="string">'queryset'</span>:page_object.page_queryset,</span><br><span class="line">        <span class="string">'page_string'</span>:page_object.html(),</span><br><span class="line">        <span class="string">'search_data'</span>:search_data,<span class="comment">#前端页面显示默认值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'admin_list.html'</span>,context)</span><br></pre></td></tr></table></div></figure></li>
<li>搜索功能的使用  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#构造搜索条件</span></span><br><span class="line">data_dict = &#123;&#125;</span><br><span class="line">search_data = request.GET.get(<span class="string">'q'</span>, <span class="string">''</span>)  <span class="comment"># 有值的话拿值，没值的话拿空字符串</span></span><br><span class="line"><span class="keyword">if</span> search_data:</span><br><span class="line">    data_dict[<span class="string">'username__contains'</span>] = search_data</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据搜索条件去数据库获取</span></span><br><span class="line">queryset=models.Admin.objects.filter(**data_dict)</span><br></pre></td></tr></table></div></figure></li>
<li>admin_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 复制pretty_list.html并加以修改 --&gt;</span></span><br><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-bottom:10px "</span> <span class="attr">class</span>=<span class="string">"clearfix"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">href</span>=<span class="string">"/admin/add"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus-sign"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                新建管理员</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"float: right;width:300px;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'q'</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"关键字"</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">value</span>=<span class="string">"&#123;&#123; search_data &#125;&#125;"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-search"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /input-group --&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Default panel contents --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-th-list"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                管理员列表</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Table --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-bordered"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;% for obj in queryset %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span>&gt;</span>&#123;&#123; obj.id &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.username &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span>*****<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span></span><br><span class="line">            &#123;&#123; page_string &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> website.views <span class="keyword">import</span> admin</span><br><span class="line"><span class="comment">#管理员的管理</span></span><br><span class="line">path(<span class="string">'admin/list'</span>,admin.admin_list),</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="13-2新建管理员">
          <a href="#13-2新建管理员" class="heading-link"><i class="fas fa-link"></i></a><a href="#13-2新建管理员" class="headerlink" title="13.2新建管理员"></a><strong>13.2新建管理员</strong></h3>
      <ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'admin/add'</span>, admin.admin_add),</span><br></pre></td></tr></table></div></figure></li>
<li>utils目录下新建encrypt.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="comment">#md5加密</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(data_string)</span>:</span></span><br><span class="line">    <span class="comment"># salt='xxxxx'</span></span><br><span class="line">    <span class="comment"># obj=hashlib.md5(salt.encode('utf-8'))</span></span><br><span class="line">    obj=hashlib.md5(settings.SECRET_KEY.encode(<span class="string">'utf-8'</span>))<span class="comment">#django自带的密文</span></span><br><span class="line">    obj.update(data_string.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">return</span> obj.hexdigest()</span><br></pre></td></tr></table></div></figure></li>
<li>admin.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"><span class="keyword">from</span> website.utils.bootstrap <span class="keyword">import</span> BootstrapModelForm<span class="comment">#引入样式</span></span><br><span class="line"><span class="keyword">from</span> website.utils.encrypt <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminModelForm</span><span class="params">(BootstrapModelForm)</span>:</span></span><br><span class="line">    confirm_password=forms.CharField(</span><br><span class="line">        label=<span class="string">'确认密码'</span>,</span><br><span class="line">        widget=forms.PasswordInput(render_value=<span class="literal">True</span>)<span class="comment">#render_value=True密码错误后不清空</span></span><br><span class="line">    )</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model=models.Admin</span><br><span class="line">        fields=[<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'confirm_password'</span>]</span><br><span class="line">        widgets=&#123;</span><br><span class="line">            <span class="string">'password'</span>:forms.PasswordInput(render_value=<span class="literal">True</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_password</span><span class="params">(self)</span>:</span></span><br><span class="line">        pwd=self.cleaned_data.get(<span class="string">'password'</span>)</span><br><span class="line">        <span class="keyword">return</span> md5(pwd)<span class="comment">#对密码进行md5加密，密码存入数据库也是密文</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_confirm_password</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># print(self.cleaned_data)</span></span><br><span class="line">        pwd=self.cleaned_data.get(<span class="string">'password'</span>)</span><br><span class="line">        confirm=md5(self.cleaned_data.get(<span class="string">'confirm_password'</span>))</span><br><span class="line">        <span class="keyword">if</span> confirm!=pwd:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'密码不一致'</span>)</span><br><span class="line">        <span class="comment"># return什么，clean_confirm_password字段的值保存到数据库就是什么</span></span><br><span class="line">        <span class="keyword">return</span> confirm</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加管理员</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_add</span><span class="params">(request)</span>:</span></span><br><span class="line">    title=<span class="string">'新建管理员'</span></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">'GET'</span>:</span><br><span class="line">        form=AdminModelForm()</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'change.html'</span>,&#123;<span class="string">'form'</span>:form,<span class="string">'title'</span>:title&#125;)</span><br><span class="line">    form=AdminModelForm(data=request.POST)</span><br><span class="line">    <span class="keyword">if</span> form.is_valid():</span><br><span class="line">        <span class="comment"># print(form.cleaned_data)</span></span><br><span class="line">        <span class="comment"># &#123;'username': 'admin', 'password': '123', 'confirm_password': '3333'&#125;</span></span><br><span class="line">        form.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/admin/list'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'change.html'</span>, &#123;<span class="string">'form'</span>: form, <span class="string">'title'</span>: title&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>templates目录下新建change.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这样再次实现添加功能不用复制之前写过的添加页面了 --&gt;</span></span><br><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span> &#123;&#123; title &#125;&#125; <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span><span class="comment">&lt;!--表单--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    &#123;% for field in form %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            &#123;&#123; field &#125;&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: red"</span>&gt;</span>&#123;&#123; field.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>提 交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="13-3编辑管理员">
          <a href="#13-3编辑管理员" class="heading-link"><i class="fas fa-link"></i></a><a href="#13-3编辑管理员" class="headerlink" title="13.3编辑管理员"></a><strong>13.3编辑管理员</strong></h3>
      <ul>
<li>urls.py  <figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'admin/&lt;int:nid&gt;/edit'</span>, admin.admin_edit),</span><br></pre></td></tr></table></div></figure></li>
<li>admin_list.html  <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span> <span class="attr">href</span>=<span class="string">"/admin/&#123;&#123; obj.id &#125;&#125;/edit"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    ``` </span><br><span class="line">- admin.py</span><br><span class="line">    ```py</span><br><span class="line">    class AdminEditModelForm(BootstrapModelForm):</span><br><span class="line">        class Meta:</span><br><span class="line">            model=models.Admin</span><br><span class="line">            fields=['username']</span><br><span class="line"></span><br><span class="line">    #编辑管理员</span><br><span class="line">    def admin_edit(request,nid):</span><br><span class="line">        #能获取到则得到对象，获取不到则得到none</span><br><span class="line">        row_object=models.Admin.objects.filter(id=nid).first()</span><br><span class="line">        if not row_object:#获取不到</span><br><span class="line">            return render(request,'error.html',&#123;'msg':'数据不存在'&#125;)</span><br><span class="line"></span><br><span class="line">        title = '编辑管理员'</span><br><span class="line"></span><br><span class="line">        if request.method=="GET":</span><br><span class="line">            form=AdminEditModelForm(instance=row_object)</span><br><span class="line">            return render(request,'change.html',&#123;'form':form,'title':title&#125;)</span><br><span class="line"></span><br><span class="line">        form=AdminEditModelForm(instance=row_object,data=request.POST)</span><br><span class="line">        if form.is_valid():</span><br><span class="line">            form.save()</span><br><span class="line">            return redirect('/admin/list')</span><br><span class="line">        return render(request,'change.html',&#123;'form':form,'title':title&#125;)</span><br></pre></td></tr></table></div></figure></li>
<li>error.html<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bootstrap网页上复制警告框代码，用来报错 --&gt;</span></span><br><span class="line">&#123;% raw %&#125; &#123;% extends 'layout.html' %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger"</span> <span class="attr">role</span>=<span class="string">"alert"</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;&#123;% endraw %&#125;</span><br></pre></td></tr></table></div></figure>

</li>
</ul>

        <h3 id="13-4删除管理员和重置密码">
          <a href="#13-4删除管理员和重置密码" class="heading-link"><i class="fas fa-link"></i></a><a href="#13-4删除管理员和重置密码" class="headerlink" title="13.4删除管理员和重置密码"></a><strong>13.4删除管理员和重置密码</strong></h3>
      <ol>
<li>删除<ul>
<li>admin_list.html<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span> <span class="attr">href</span>=<span class="string">"/admin/&#123;&#123; obj.id &#125;&#125;/delete"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>urls.py<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'admin/&lt;int:nid&gt;/delete'</span>, admin.admin_delete),</span><br></pre></td></tr></table></div></figure></li>
<li>admin.py<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除管理员</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_delete</span><span class="params">(request,nid)</span>:</span></span><br><span class="line">    models.Admin.objects.filter(id=nid).delete()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">'/admin/list'</span>)</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>重置密码<ul>
<li>admin_list.html<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/admin/&#123;&#123; obj.id &#125;&#125;/reset"</span>&gt;</span>重置密码<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></div></figure></li>
<li>urls.py<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'admin/&lt;int:nid&gt;/reset'</span>, admin.admin_reset),</span><br></pre></td></tr></table></div></figure></li>
<li>admin.py<figure class="highlight py"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminResetModelForm</span><span class="params">(BootstrapModelForm)</span>:</span></span><br><span class="line">confirm_password=forms.CharField(</span><br><span class="line">    label=<span class="string">'确认密码'</span>,</span><br><span class="line">    widget=forms.PasswordInput(render_value=<span class="literal">True</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model=models.Admin</span><br><span class="line">    fields=[<span class="string">'password'</span>,<span class="string">'confirm_password'</span>]</span><br><span class="line">    widgets=&#123;</span><br><span class="line">        <span class="string">'password'</span>:forms.PasswordInput(render_value=<span class="literal">True</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_password</span><span class="params">(self)</span>:</span></span><br><span class="line">    pwd=self.cleaned_data.get(<span class="string">'password'</span>)</span><br><span class="line">    md5_pwd=md5(pwd)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#去数据库校验当前密码是否与新输入的密码一致</span></span><br><span class="line">    self.instance.pk<span class="comment">#通过instance参数传过来的对象,.pk获取当前行的id</span></span><br><span class="line">    <span class="comment">#当前密码与新输入的密码一致的项是否存在</span></span><br><span class="line">    exists=models.Admin.objects.filter(id=self.instance.pk,password=md5_pwd).exists()</span><br><span class="line">    <span class="keyword">if</span> exists:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">'不能与以前的密码相同'</span>)</span><br><span class="line">    <span class="keyword">return</span> md5(pwd)<span class="comment">#对密码进行md5加密，密码存入数据库也是密文</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_confirm_password</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># print(self.cleaned_data)</span></span><br><span class="line">    pwd=self.cleaned_data.get(<span class="string">'password'</span>)</span><br><span class="line">    confirm=md5(self.cleaned_data.get(<span class="string">'confirm_password'</span>))</span><br><span class="line">    <span class="keyword">if</span> confirm!=pwd:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">'密码不一致'</span>)</span><br><span class="line">    <span class="comment"># return什么，clean_confirm_password字段的值保存到数据库就是什么</span></span><br><span class="line">    <span class="keyword">return</span> confirm</span><br><span class="line"></span><br><span class="line"><span class="comment">#重置密码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_reset</span><span class="params">(request,nid)</span>:</span></span><br><span class="line">    row_object=models.Admin.objects.filter(id=nid).first()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> row_object:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'error.html'</span>,&#123;<span class="string">'msg'</span>:<span class="string">'数据不存在'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    title=<span class="string">'重置密码 - &#123;&#125;'</span>.format(row_object.username)<span class="comment">#用占位符加上用户名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">"GET"</span>:</span><br><span class="line">        form=AdminResetModelForm()<span class="comment">#不希望看到密码值，去掉instance=row_object</span></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'change.html'</span>,&#123;<span class="string">'form'</span>:form,<span class="string">'title'</span>:title&#125;)</span><br><span class="line"></span><br><span class="line">    form=AdminResetModelForm(data=request.POST,instance=row_object)</span><br><span class="line">    <span class="keyword">if</span> form.is_valid():</span><br><span class="line">        form.save()</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/admin/list'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'change.html'</span>,&#123;<span class="string">'form'</span>:form,<span class="string">'title'</span>:title&#125;)</span><br></pre></td></tr></table></div></figure>

</li>
</ul>
</li>
</ol>

        <h2 id="14-用户登录">
          <a href="#14-用户登录" class="heading-link"><i class="fas fa-link"></i></a><a href="#14-用户登录" class="headerlink" title="14.用户登录"></a><strong>14.用户登录</strong></h2>
      <ul>
<li>http/https请求<ul>
<li>无状态的短链接：一次请求、一次响应之后会断开浏览器和网站之间的连接。再发起则重新再连接，不会携带以前的状态<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#浏览器向网站发送请求是通过网址发，发的是http&#x2F;https请求</span><br><span class="line">http:127.0.0.1:8000&#x2F;admin&#x2F;list</span><br><span class="line">https:127.0.0.1:8000&#x2F;admin&#x2F;list</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li>什么是cookie和session？<ul>
<li>cookie<ol>
<li>保存在浏览器上的键值对</li>
<li>发送请求时，自动携带</li>
</ol>
</li>
<li>session<ol>
<li>存放在数据库，redis、文件中，django默认存放在数据库</li>
</ol>
</li>
</ul>
</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/02/27/%E9%83%A8%E7%BD%B2%E5%8D%9A%E5%AE%A2%E5%A4%B1%E8%B4%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">部署博客失败解决方案</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-02-27</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2023-05-11</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="SpawnFailed">
          <a href="#SpawnFailed" class="heading-link"><i class="fas fa-link"></i></a><a href="#SpawnFailed" class="headerlink" title="SpawnFailed"></a><strong>SpawnFailed</strong></h2>
      <ul>
<li>问题描述：在使用 hexo d 时，出现 SpawnFailed 的错误</li>
<li>解决方案<ol>
<li>重启电脑   </li>
<li>输入邮箱、用户名  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &quot;2673065011@qq.com&quot;</span><br><span class="line">git config --global user.name &quot;210173313&quot;</span><br></pre></td></tr></table></div></figure></li>
<li>删除.deploy_git文件夹 <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.autocrlf false</span><br><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></div></figure></li>
<li>修改_config.yml配置文件 <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">type: &#39;git&#39;</span><br><span class="line">repo: https:&#x2F;&#x2F;github.com&#x2F;yourname&#x2F;yourname.github.io.git</span><br><span class="line">branch: master</span><br><span class="line"># 其中的repo修改为</span><br><span class="line">repo: git@github.com:yourname&#x2F;yourname.github.io.git</span><br></pre></td></tr></table></div></figure></li>
</ol>
</li>
<li>报错信息     <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">err: Error: Spawn failed</span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (E:\HexoWeb\node_modules\hexo-util\lib\spawn.js:51:21)</span><br><span class="line">    at ChildProcess.emit (node:events:526:28)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (node:internal&#x2F;child_process:291:12) &#123;</span><br><span class="line">  code: 128</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure></li>
<li>解决方案<ol>
<li>删掉.deploy_git  </li>
<li>hexo三步   <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></div></figure></li>
</ol>
</li>
<li>版权声明：本文为CSDN博主「-小豆同学-」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。</li>
<li>原文链接：<span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/qq_49218475/article/details/117334256" target="_blank" rel="noopener">https://blog.csdn.net/qq_49218475/article/details/117334256</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>
        <h2 id="git提示“Please-make-sure-you-have-the-correct-access-rights-and-the-repository-exists-”">
          <a href="#git提示“Please-make-sure-you-have-the-correct-access-rights-and-the-repository-exists-”" class="heading-link"><i class="fas fa-link"></i></a><a href="#git提示“Please-make-sure-you-have-the-correct-access-rights-and-the-repository-exists-”" class="headerlink" title="git提示“Please make sure you have the correct access rights and the repository exists.”"></a><strong>git提示“Please make sure you have the correct access rights and the repository exists.”</strong></h2>
      </li>
<li>ssh key有问题，导致的连接不上服务器</li>
<li>首先要重新在git设置一下身份的名字和邮箱。  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;yourname&quot;</span><br><span class="line">git config --global user.email“your@email.com&quot;</span><br></pre></td></tr></table></div></figure></li>
<li>删除.ssh文件夹（直接搜索该文件夹，一般在C盘的Users文件夹下）</li>
<li>git输入命令ssh-keygen -t rsa -C “<span class="exturl"><a class="exturl__link" href="mailto:your@email.com">your@email.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>“</li>
<li>复制id_rsa.pub(.ssh文件夹下)全部内容</li>
<li>打开<span class="exturl"><a class="exturl__link" href="https://github.com/，登陆你的账户，进入设置，进入ssh设置，New" target="_blank" rel="noopener">https://github.com/，登陆你的账户，进入设置，进入ssh设置，New</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> SSH Key，在key中将刚刚复制的id_rsa.pub中的内容粘贴进去，点击add ssh key。</li>
<li>在git中输入命令：  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com </span><br><span class="line">#然后输入</span><br><span class="line">yes</span><br></pre></td></tr></table></div></figure></li>
<li>重新hexo d
        <h2 id="remote-Support-for-password-authentication-was-removed-on-August-13-2021">
          <a href="#remote-Support-for-password-authentication-was-removed-on-August-13-2021" class="heading-link"><i class="fas fa-link"></i></a><a href="#remote-Support-for-password-authentication-was-removed-on-August-13-2021" class="headerlink" title="remote: Support for password authentication was removed on August 13, 2021."></a><strong>remote: Support for password authentication was removed on August 13, 2021.</strong></h2>
      </li>
<li>2021年8月13日之后，就不再支持密码验证进行上传了</li>
<li>生成自己的token<ul>
<li>GitHub在个人设置页面，找到Setting</li>
<li>选择开发者设置Developer setting</li>
<li>选择个人访问令牌Personal access tokens，然后选中生成令牌Generate new token</li>
<li>设置token的有效期，访问权限等。选择要授予此令牌token的范围或权限。<ul>
<li>我选了一直有效</li>
<li>要使用token从命令行访问仓库，请选择repo。</li>
<li>要使用token从命令行删除仓库，请选择delete_repo</li>
<li>其他根据需要进行勾选</li>
</ul>
</li>
<li>生成令牌Generate token</li>
<li>把token保存下来，再次刷新网页无法看到它</li>
<li>生成token后保存在本地以后，然后继续提交。这个时候会出一个输入github用户名和密码的弹出框，输入用户名和token后点击回车，然后再在命令行上输入token，点击回车即可提交代码</li>
<li>也可以 把token直接添加远程仓库链接中，这样就可以避免同一个仓库每次提交代码都要输入token了  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url origin https:&#x2F;&#x2F;&lt;your_token&gt;@github.com&#x2F;&lt;USERNAME&gt;&#x2F;&lt;REPO&gt;.git</span><br></pre></td></tr></table></div></figure></li>
</ul>
</li>
<li><span class="exturl"><a class="exturl__link" href="https://blog.csdn.net/weixin_41010198/article/details/119698015" target="_blank" rel="noopener">参考链接</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>
        <h2 id="Git报错解决：OpenSSL-SSL-read-Connection-was-reset-errno-10054-错误解决">
          <a href="#Git报错解决：OpenSSL-SSL-read-Connection-was-reset-errno-10054-错误解决" class="heading-link"><i class="fas fa-link"></i></a><a href="#Git报错解决：OpenSSL-SSL-read-Connection-was-reset-errno-10054-错误解决" class="headerlink" title="Git报错解决：OpenSSL SSL_read: Connection was reset, errno 10054 错误解决"></a><strong>Git报错解决：OpenSSL SSL_read: Connection was reset, errno 10054 错误解决</strong></h2>
      </li>
<li>产生原因：一般是这是因为服务器的SSL证书没有经过第三方机构的签署，所以才报错</li>
<li>参考网上解决办法：解除ssl验证后，再次git即可</li>
<li>打开Git命令页面，执行git命令脚本：修改设置，解除ssl验证  <figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.sslVerify &quot;false&quot;</span><br></pre></td></tr></table></div></figure></li>
<li>再次执行git
        <h2 id="git-github-com-Permission-denied-publickey-fatal-Could-not-read-from-remote-repository">
          <a href="#git-github-com-Permission-denied-publickey-fatal-Could-not-read-from-remote-repository" class="heading-link"><i class="fas fa-link"></i></a><a href="#git-github-com-Permission-denied-publickey-fatal-Could-not-read-from-remote-repository" class="headerlink" title="git@github.com: Permission denied (publickey). fatal: Could not read from remote repository."></a><span class="exturl"><a class="exturl__link" href="mailto:git@github.com">git@github.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>: Permission denied (publickey). fatal: Could not read from remote repository.</h2>
      </li>
<li>产生原因：密钥设置不对</li>
<li>解决方法<ul>
<li>首先检查有没有在GitHub的<span class="exturl"><a class="exturl__link" href="https://github.com/settings/keys上添加你本机的SSH" target="_blank" rel="noopener">https://github.com/settings/keys上添加你本机的SSH</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> key。</li>
<li>查看用户主目录(C:\Users\dell.ssh)下是否有id_rsa和id_rsa.pub这两个文件，有则跳到下一步，没有则创建<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#Git Bash Here</span><br><span class="line">ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</span><br><span class="line">#邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可</span><br></pre></td></tr></table></div></figure></li>
<li>登陆GitHub，打开“Account settings”，“SSH and GPG Keys”页面,”New SSH Key”,填上任意Title，在Key文本框里粘贴id_rsa.pub文件的内容，“Add SSH Key”</li>
<li>再次执行hexo d即可</li>
</ul>
</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/02/27/markdown%E6%8E%92%E7%89%88%E8%AF%AD%E6%B3%95/">markdown排版语法</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2022-02-27</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2022-05-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="标题">
          <a href="#标题" class="heading-link"><i class="fas fa-link"></i></a><a href="#标题" class="headerlink" title="标题"></a><strong>标题</strong></h2>
      <ul>
<li><p>#一级标题</p>
<ul>
<li>
        <h1 id="一级标题">
          <a href="#一级标题" class="heading-link"><i class="fas fa-link"></i></a><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1>
      </li>
</ul>
</li>
<li><p>##二级标题</p>
<ul>
<li>
        <h2 id="二级标题">
          <a href="#二级标题" class="heading-link"><i class="fas fa-link"></i></a><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2>
      </li>
</ul>
</li>
<li><p>###三级标题</p>
<ul>
<li>
        <h3 id="三级标题">
          <a href="#三级标题" class="heading-link"><i class="fas fa-link"></i></a><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3>
      </li>
</ul>
</li>
<li><p>与html中h1-h6对应，共有六级</p>

        <h2 id="插入图片">
          <a href="#插入图片" class="heading-link"><i class="fas fa-link"></i></a><a href="#插入图片" class="headerlink" title="插入图片"></a><strong>插入图片</strong></h2>
      </li>
<li><p>对应于HTML中的img标签</p>
</li>
<li><p>![无法加载时的提示信息(图片网址)]</p>
</li>
<li><p>插入本地图片</p>
<ul>
<li>本地图片的路径更改或丢失都会造成图片无法打开</li>
<li>绝对路径：![avatar](/home/picture/1.png)</li>
<li>相对路径：需放在与markdown相同目录下![avatar](picture/1.png)</li>
</ul>
</li>
<li><p>插入网络图片</p>
<ul>
<li>在基础语法的括号中填入图片的网络链接</li>
<li>![avatar](<span class="exturl"><a class="exturl__link" href="http://baidu.com/pic/doge.png" target="_blank" rel="noopener">http://baidu.com/pic/doge.png</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>)</li>
</ul>
</li>
<li><p>图片存入markdown文件</p>
<ul>
<li><p>用base64转码工具把图片转成一段字符串，然后把字符串填到基础格式中链接的位置</p>
</li>
<li><p>![avatar](data:image/png;base64,iVBORw0……)</p>
</li>
<li><p>但插入过长的字符串会把整个文章分开，此时可在文章中通过一个id来调用，文章就不会被开。</p>
<ul>
<li>![avatar][base64str]</li>
<li>[base64str]:data:image/png;base64,iVBORw0……</li>
</ul>
</li>
<li><p>base64图片编码【python】</p>
<ol>
<li>import base64</li>
<li>f=open(‘723.png’,’rb’) #二进制方式打开图文件</li>
<li>ls_f=base64.b64encode(f.read()) #读取文件内容，转换为base64编码</li>
<li>f.close()</li>
<li>print(ls_f) </li>
</ol>
</li>
<li><p>base64字符串转化为图片【python】</p>
<ol>
<li>import base64</li>
<li>bs=’iVBORw0KGgoAAAANSUhEUg….’ </li>
<li>imgdata=base64.b64decode(bs)</li>
<li>file=open(‘2.jpg’,’wb’)</li>
<li>file.write(imgdata)</li>
<li>file.close()</li>
</ol>
</li>
<li><p><span class="exturl"><a class="exturl__link" href="https://www.jianshu.com/p/280c6a6f2594" target="_blank" rel="noopener">参考链接</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</li>
</ul>
</li>
<li><p><strong>文字</strong></p>
<ul>
<li>**粗体文字**：<strong>粗体文字</strong>【对应于HTML的strong标签】</li>
<li>_斜体文字_：_斜体文字_【对应于HTML的em标签】</li>
<li>~~删除线~~：<del>删除线</del>【对应于HTML的del标签】</li>
</ul>
</li>
<li><p><strong>列表</strong></p>
<ul>
<li><p>有序列表</p>
<ul>
<li>对应于HTML中的ol和li标签组合</li>
<li>1.有序列表第1项</li>
<li>2.有序列表第2项</li>
</ul>
<ol>
<li>有序列表第1项</li>
<li>有序列表第2项</li>
</ol>
</li>
<li><p>无序列表</p>
<ul>
<li><p>对应于HTML中的ul、li标签组合</p>
</li>
<li><p>+和-也会在表示任务列表时使用到</p>
<p>- 无序列表第1项</p>
<p>+ 无序列表第2项</p>
<p>+ [ ] 没有完成的任务列表</p>
<p>- [x] 完成的任务列表</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>引用</strong></p>
<ul>
<li>对应于HTML中的blockquote标签</li>
<li>&gt; 引用</li>
<li><blockquote>
<p>引用</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>HTML标签</strong></p>
<ul>
<li>使用HTML标签进行排版以补充Markdown语法的不足之处</li>
<li>&lt;u&gt;下划线&lt;/u&gt;:<u>下划线</u></li>
<li>&lt;sup&gt;上标&lt;/sup&gt;:<sup>上标</sup></li>
<li>&lt;sub&gt;下标&lt;/sub&gt;:<sub>下标</sub></li>
</ul>
</li>
<li><p><strong>超链接</strong></p>
<ul>
<li>对应于HTML的a标签</li>
<li>[显示文字](网址 “鼠标悬停时文字”)</li>
<li><a href="网址" title="鼠标悬停时文字">显示文字</a></li>
</ul>
</li>
<li><p><strong>代码</strong></p>
<ul>
<li>对应于HTML的code标签</li>
<li>行内代码<ul>
<li>`#include &lt;stdio.h&gt;`</li>
<li><code>#include &lt;stdio.h&gt;</code></li>
</ul>
</li>
<li>段间代码<ul>
<li>```c<br>  int a = 1;<br>  char b = ‘a’;<br>```<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">char</span> b = <span class="string">'a'</span>;</span><br></pre></td></tr></table></div></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>脚注</strong></p>
<ul>
<li>《咏鹅》[^脚注名称]是一首诗。</li>
<li>《咏鹅》[^脚注名称]是一首诗。</li>
</ul>
</li>
<li><p><strong>转义</strong></p>
<ul>
<li>\</li>
</ul>
</li>
<li><p><strong>注释</strong></p>
<ul>
<li>&lt;!–注释–&gt;</li>
<li><!--注释--></li>
</ul>
</li>
<li><p><strong><span class="exturl"><a class="exturl__link" href="https://www.jianshu.com/p/4cbff8294250" target="_blank" rel="noopener">参考链接</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></strong></p>
</li>
<li><p><strong>换行</strong></p>
<ul>
<li>段落中换行<br><ul>
<li>一二三四五，&lt;/br /&gt;上山打老虎</li>
<li>一二三四五，<br>上山打老虎</li>
</ul>
</li>
<li>普通句子换行<ul>
<li>使用\，然后接着按Enter<ul>
<li>一二三四五，\<br>上山打老虎</li>
<li>一二三四五，<br>上山打老虎</li>
</ul>
</li>
<li>输入两个空格，然后接着按下Enter<ul>
<li>一二三四五，<br>上山打老虎</li>
<li>一二三四五，<br>上山打老虎</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2021/01/16/My%20first%20blog/">My first blog</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2021-01-16</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2023-05-11</span></span></div></header><div class="post-body"><div class="post-excerpt"><ul>
<li><p>markdown<br>第一次写博客，遇到很多问题。部署不成功，部署成功但博客不显示，编辑博客但仍是空白……</p>
</li>
<li><p>下面写下成功的方法：</p>
<ul>
<li><p>找到博客站点文件夹（我的是G:\hexo\source\_posts），在文件下新建md文件，编辑文件。</p>
</li>
<li><p>编辑完成后，在该文件夹下右键空白处，选择Git Bash Here，输入hexo g(或hexo generate)，生成静态文件。</p>
</li>
<li><p>输入hexo s(或hexo server)，启动服务器，在浏览器中打开代码最后一行所示本地预览网址（大多数都为localhost:4000,若打开过慢可考虑更换端口号，避免冲突），此时可看见刚写的博客。</p>
</li>
<li><p>ctrl+c关闭服务器</p>
</li>
<li><p>输入hexo d(或hexo deploy)，将本地文件发布到github上。</p>
</li>
</ul>
</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/06/10/hello-world/">Hello World</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-06-10</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2020-06-10</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>Welcome to <span class="exturl"><a class="exturl__link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>! This is your very first post. Check <span class="exturl"><a class="exturl__link" href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> for more info. If you get any problems when using Hexo, you can find the answer in <span class="exturl"><a class="exturl__link" href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> or you can ask me on <span class="exturl"><a class="exturl__link" href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>.</p>

        <h2 id="Quick-Start">
          <a href="#Quick-Start" class="heading-link"><i class="fas fa-link"></i></a><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2>
      
        <h3 id="Create-a-new-post">
          <a href="#Create-a-new-post" class="heading-link"><i class="fas fa-link"></i></a><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3>
      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></div></figure>

<p>More info: <span class="exturl"><a class="exturl__link" href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="Run-server">
          <a href="#Run-server" class="heading-link"><i class="fas fa-link"></i></a><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3>
      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></div></figure>

<p>More info: <span class="exturl"><a class="exturl__link" href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="Generate-static-files">
          <a href="#Generate-static-files" class="heading-link"><i class="fas fa-link"></i></a><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3>
      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></div></figure>

<p>More info: <span class="exturl"><a class="exturl__link" href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="Deploy-to-remote-sites">
          <a href="#Deploy-to-remote-sites" class="heading-link"><i class="fas fa-link"></i></a><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3>
      <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></div></figure>

<p>More info: <span class="exturl"><a class="exturl__link" href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><a class="extend prev" rel="prev" href="/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">20</div><div class="sidebar-ov-state-item__name">Archives</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Millionchan</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v4.2.1</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>